(function(){"use strict";const G="Summary Break";function X(E,t=0){typeof TiptapCore!="undefined"&&typeof TiptapStarterKit!="undefined"&&typeof TiptapTable!="undefined"&&typeof TiptapUnderline!="undefined"&&typeof TiptapGitHubAlert!="undefined"&&typeof marked!="undefined"?E():t<50&&setTimeout(()=>X(E,t+1),100)}class le{constructor(){this.blockMap=new Map,this.blockCounter=0}normalizeShortcodeParams(t){if(!t)return"";const e=t.match(/^\s*=\s*["']([^"']+)["']\s*$/),i=t.match(/^\s*=\s*([^\s"']+)\s*$/);if(e||i)return t.trim();const n=/([\w-]+)=("[^"]*"|'[^']*'|\S+)/g;return t.replace(n,(o,s,r)=>r.startsWith('"')||r.startsWith("'")?(r.startsWith("'")&&(r='"'+r.slice(1,-1).replace(/"/g,'\\"')+'"'),`${s}=${r}`):`${s}="${r}"`).replace(/\b(\w+)(?=\s|$)(?!=)/g,"$1")}preserveContent(t){let e=t;return this.blockMap.clear(),this.blockCounter=0,e=this.preserveInlineCode(e),e=this.preserveRawShortcodes(e),e=this.preserveCodeTypeShortcodes(e),e=this.preserveFencedCodeBlocks(e),e=this.preserveHtml(e),e=this.preserveTwig(e),e=this.preserveShortcodes(e),e=this.preserveGravImages(e),{processed:e,blocks:this.blockMap}}preserveRawShortcodes(t){let e=t;const i=/\[raw\]([\s\S]*?)\[\/raw\]/gi;return e=e.replace(i,(n,l)=>{const o=this.generateBlockId();let s=l;const r=/\{\{CODE_INLINE_([^}]+)\}\}/g;s=s.replace(r,(c,d)=>{const h=this.blockMap.get(d);return h&&h.original?(this.blockMap.delete(d),h.original):c});const a=`[raw]${s}[/raw]`;return this.blockMap.set(o,{type:"shortcode",tagName:"raw",shortcodeName:"raw",shortcodeType:"block",params:"",attributes:{},content:s,original:a,isClosing:!0,isSelfClosing:!1,isBlock:!0,isRawShortcode:!0}),`{{SHORTCODE_PLACEHOLDER_${o}}}`}),e}preserveCodeTypeShortcodes(t){let e=t;if(!window.EditorPro||!window.EditorPro.getShortcodeRegistry)return e;const i=window.EditorPro.getShortcodeRegistry();if(!i||!i.shortcodes)return e;typeof i.ensureInitialized=="function"&&i.ensureInitialized();const n=[];if(i.shortcodes.forEach((s,r)=>{s.contentType==="code"&&n.push(r)}),n.length===0)return e;const l=[];i.shortcodes.forEach((s,r)=>{if(s.allowedChildren&&s.allowedChildren.some(a=>n.includes(a))){const a=new RegExp(`\\[${r}([=\\s][^\\]]*)?\\]([\\s\\S]*?)\\[\\/${r}\\]`,"gi");let c;for(;(c=a.exec(e))!==null;)l.push({start:c.index,end:c.index+c[0].length,name:r})}});const o=s=>l.some(r=>s>r.start&&s<r.end);for(const s of n){const r=new RegExp(`\\[${s}([=\\s][^\\]]*)?\\](?!\\()([\\s\\S]*?)\\[\\/${s}\\]`,"gi");e=e.replace(r,(a,c,d,h,p)=>{if(h>0&&p[h-1]==="`"||o(h))return a;const u=this.generateBlockId(),g=(c||"").trim(),m=this.parseShortcodeAttributes(g),w=this.normalizeShortcodeParams(g),y=i.shortcodes.get(s.toLowerCase())||i.shortcodes.get(s),f=h===0||e[h-1]===`
`,k=h+a.length,b=k>=e.length||e[k]===`
`,C=f&&b;let x=d;const v=/\{\{CODE_INLINE_([^}]+)\}\}/g;return x=x.replace(v,(S,$)=>{const M=this.blockMap.get($);return M&&M.original?(this.blockMap.delete($),M.original):S}),this.blockMap.set(u,{type:"shortcode",tagName:s,shortcodeName:s,shortcodeType:"block",params:w,attributes:m,content:x,codeContent:x,contentType:"code",original:a,isClosing:!0,isSelfClosing:!1,isBlock:!0,onOwnLine:C,language:(y==null?void 0:y.language)||m.lang||"javascript"}),`{{SHORTCODE_PLACEHOLDER_${u}}}`})}return e}preserveInlineCode(t){let e=t;const i=/`(?!``)([^`\n]+)`/g;return e=e.replace(i,(n,l)=>{const o=this.generateBlockId();return this.blockMap.set(o,{type:"code_inline",content:l,original:n,isBlock:!1,isInline:!0}),`{{CODE_INLINE_${o}}}`}),e}preserveFencedCodeBlocks(t){let e=t;const i=/```(\w*)\s*\n([\s\S]*?)```/gm;return e=e.replace(i,(n,l,o)=>{const s=this.generateBlockId();return this.blockMap.set(s,{type:"code_block",language:l||"",content:o,original:n,isBlock:!0,isFenced:!0}),`{{CODE_BLOCK_${s}}}`}),e}preserveCodeBlocks(t){let e=this.preserveInlineCode(t);return e=this.preserveFencedCodeBlocks(e),e}preserveGitHubAlerts(t){const e=/^> \[!(NOTE|TIP|IMPORTANT|WARNING|CAUTION)\]\n((?:^>.*\n?)*)/gm;return t.replace(e,(i,n,l)=>{const o=this.generateBlockId(),r=l.split(`
`).filter(a=>a.trim()).map(a=>a.replace(/^>\s?/,"")).join(`
`);return this.blockMap.set(o,{type:"github-alert",alertType:n.toLowerCase(),content:r,original:i,isBlock:!0}),`{{GITHUB_ALERT_${o}}}`})}preserveShortcodes(t){const e=/\[([^\]]*\[[^\]]+\][^\]]*)\]\(([^)]+)\)/g;let i;for(;(i=e.exec(t))!==null;);return t=t.replace(e,(n,l,o)=>`[${this.preserveShortcodesRecursive(l)}](${o})`),this.preserveShortcodesRecursive(t)}preserveShortcodesRecursive(t){let e=t,i=!1;const n=/\[([a-zA-Z][a-zA-Z0-9_-]*)\s*(.*?)\s*\/\]/g;e=e.replace(n,(o,s,r,a,c)=>{if(c.substring(a+o.length).startsWith("(")&&!r.includes("="))return o;i=!0;const h=this.generateBlockId();let p="inline";if(window.EditorPro&&window.EditorPro.getShortcodeRegistry){const f=window.EditorPro.getShortcodeRegistry();if(f){const k=f.get(s);k&&k.type&&(p=k.type)}}const u=this.parseShortcodeAttributes(r),g=this.normalizeShortcodeParams(r.trim()),m=a===0||c[a-1]===`
`,w=a+o.length>=c.length||c[a+o.length]===`
`,y=m&&w;return this.blockMap.set(h,{type:"shortcode",tagName:s,shortcodeName:s,shortcodeType:p,params:g,attributes:u,content:"",original:o,isClosing:!1,isSelfClosing:!0,isBlock:p==="block",onOwnLine:y}),`{{SHORTCODE_PLACEHOLDER_${h}}}`});const l=/\[([a-zA-Z][a-zA-Z0-9_-]*)\s*([^\]]*?)\]([\s\S]*?)\[\/\1\]/g;return e=e.replace(l,(o,s,r,a,c,d)=>{if(d.substring(c+o.length).startsWith("(")&&!r.includes("="))return o;i=!0;const p=this.generateBlockId();let u="block";if(window.EditorPro&&window.EditorPro.getShortcodeRegistry){const S=window.EditorPro.getShortcodeRegistry();if(S){const $=S.get(s);$&&$.type?u=$.type:a.trim()&&o.includes(`
`)&&o.split(`
`).length>2?u="block":u="inline"}}u==="block"&&["mark","highlight","span","kbd","code","em","strong","del","ins","sub","sup","color","fa"].includes(s.toLowerCase())&&(u="inline");const g=this.parseShortcodeAttributes(r),m=c===0||d[c-1]===`
`,w=c+o.length>=d.length||d[c+o.length]===`
`,y=m&&w;let f=!1,k=null;if(window.EditorPro&&window.EditorPro.getShortcodeRegistry){const S=window.EditorPro.getShortcodeRegistry();S&&(k=S.get(s),k&&k.contentType==="code"&&(f=!0))}let b=a,C=null;if(f){let S=a;const $=/\{\{CODE_INLINE_([^}]+)\}\}/g;S=S.replace($,(M,T)=>{const N=this.blockMap.get(T);return N&&N.original?(this.blockMap.delete(T),N.original):M}),C=S,b=S}else{const S=/\{\{CODE_BLOCK_([^}]+)\}\}/g;b=b.replace(S,(M,T)=>{const N=this.blockMap.get(T);return N&&N.original?(this.blockMap.delete(T),N.original):M});const $=/\{\{CODE_INLINE_([^}]+)\}\}/g;b=b.replace($,(M,T)=>{const N=this.blockMap.get(T);return N&&N.original?(this.blockMap.delete(T),N.original):M}),b&&(/\[([a-zA-Z][a-zA-Z0-9_-]*)\s*([^\]]*?)\]([\s\S]*?)\[\/\1\]/.test(b)||/\[([a-zA-Z][a-zA-Z0-9_-]*)\s*([^\/\]]*?)\/\]/.test(b))&&(b=this.preserveShortcodesRecursive(b))}const x=this.normalizeShortcodeParams(r.trim()),v=s.toLowerCase().includes("inject");return this.blockMap.set(p,{type:"shortcode",tagName:s,shortcodeName:s,shortcodeType:u,params:x,attributes:g,content:b,codeContent:C,contentType:f?"code":"blocks",original:o,isClosing:!v,isSelfClosing:v,isBlock:u==="block",onOwnLine:y,isInjectionShortcode:v}),`{{SHORTCODE_PLACEHOLDER_${p}}}`}),i&&(/\[([a-zA-Z][a-zA-Z0-9_-]*)\s*([^\]]*?)\]([\s\S]*?)\[\/\1\]/.test(e)||/\[([a-zA-Z][a-zA-Z0-9_-]*)\s*([^\/\]]*?)\/\]/.test(e))?this.preserveShortcodesRecursive(e):e}parseShortcodeAttributes(t){const e={};if(t){const i=t.match(/^\s*=\s*["']([^"']+)["']\s*$/);if(i)return e.icon=i[1],e;const n=/([\w-]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s]+))/g;let l;for(;(l=n.exec(t))!==null;){const o=l[2]!==void 0?l[2]:l[3]!==void 0?l[3]:l[4];e[l[1]]=o}}return e}preserveHtml(t){let e=t;const i=new Set,n=(c,d)=>{const h=c.lastIndexOf(`
`,d)+1,p=c.indexOf(`
`,d),u=p===-1?c.length:p,g=c.lastIndexOf("`",d),m=c.indexOf("`",d);if(g===-1||m===-1||g<h||m>u)return!1;const w=c.substring(Math.max(0,g-2),g+1),y=c.substring(m,Math.min(c.length,m+3));return!(w==="```"||y==="```")},l=["div","p","section","article","header","footer","main","aside","nav","blockquote","pre","table","form","fieldset","figure","h1","h2","h3","h4","h5","h6","ul","ol","dl"],o=["a","strong","em","code","span","abbr","cite","mark","sub","sup","kbd","samp","var","q","del","ins","dfn","time","meter","progress","small","big","b","i","u","s","strike","tt","label","button","input","select","textarea","output","bdo","bdi","ruby","rt","rp","wbr","data"],s=[],r=/<([a-zA-Z][a-zA-Z0-9]*)\b[^>]*>/g;let a;for(;(a=r.exec(t))!==null;){const c=a[1].toLowerCase(),d=a.index,h=a[0];if(i.has(d)||n(t,d)||h.includes("PRESERVED_BLOCK_")||h.includes("RAW_BLOCK_")||h.includes("data-shortcode=")||h.includes('class="shortcode-content"')||o.includes(c))continue;if(h.endsWith("/>")){s.push({start:d,end:d+h.length,tagName:c,content:h,isSelfClosing:!0}),i.add(d);continue}const p=`</${c}>`;let u=d+h.length,g=1,m=u;for(;g>0&&m<t.length;){const w=t.indexOf(`<${c}`,m),y=t.indexOf(p,m);if(y===-1)break;if(w!==-1&&w<y)g++,m=w+c.length+1;else{if(g--,g===0){const f=y+p.length,k=t.substring(d,f);s.push({start:d,end:f,tagName:c,content:k,isSelfClosing:!1});for(let b=d;b<=f;b++)i.add(b);break}m=y+p.length}}}s.sort((c,d)=>d.start-c.start);for(const c of s){const d=this.generateBlockId(),h=l.includes(c.tagName);this.blockMap.set(d,{type:"html",tagName:c.tagName,content:c.content,original:c.content,isBlock:h}),e=e.substring(0,c.start)+`{{RAW_BLOCK_${d}}}`+e.substring(c.end)}return e}preserveTwig(t){const e=(o,s)=>{const r=o.lastIndexOf(`
`,s)+1,a=o.indexOf(`
`,s),c=a===-1?o.length:a,d=o.lastIndexOf("`",s),h=o.indexOf("`",s);if(d===-1||h===-1||d<r||h>c)return!1;const p=o.substring(Math.max(0,d-2),d+1),u=o.substring(h,Math.min(o.length,h+3));return!(p==="```"||u==="```")},i=["for","if","block","set","macro","sandbox","spaceless","verbatim","cache"];let n=t;for(const o of i){const s=new RegExp(`\\{\\%\\s*${o}[^%]*\\%\\}[\\s\\S]*?\\{\\%\\s*end${o}\\s*\\%\\}`,"gi");n=n.replace(s,(r,a)=>{if(e(t,a)||r.includes("PRESERVED_BLOCK_")||r.includes("RAW_BLOCK_")||r.includes("SHORTCODE_PLACEHOLDER_"))return r;const c=this.generateBlockId();return this.blockMap.set(c,{type:"twig",content:r,original:r,isBlock:!0}),`{{RAW_BLOCK_${c}}}`})}const l=/\{\%\s*([a-zA-Z]+)[^%]*\%\}|\{\{\s*[^}]+\s*\}\}/g;return n=n.replace(l,(o,s,r)=>{if(e(n,r)||o.includes("PRESERVED_BLOCK_")||o.includes("RAW_BLOCK_")||o.includes("SHORTCODE_PLACEHOLDER_")||/^\{\{CODE_(?:INLINE|BLOCK)_[\w_]+\}\}$/.test(o))return o;const c=!o.startsWith("{{")&&s&&i.includes(s),d=this.generateBlockId();return this.blockMap.set(d,{type:"twig",content:o,original:o,isBlock:c}),`{{RAW_BLOCK_${d}}}`}),n}restoreContent(t,e){let i="",n=t,l=0;const o=50;for(;i!==n&&l<o;){i=n,l++;const s=(r,a,c,d)=>{const h=e.get(a);if(!h)return r;const u=(d[c+r.length]||"")===`
`;return h.isBlock&&!(d.substring(c+r.length,c+r.length+2)===`

`)?u?h.original+`
`:h.original+`

`:h.original};n=n.replace(/\{\{GITHUB_ALERT_([\w_]+)\}\}/g,(r,a,c,d)=>{const h=e.get(a);return h?h.original:r}),n=n.replace(/\{\{SHORTCODE_PLACEHOLDER_([\w_]+)\}\}/g,(r,a,c,d)=>{const h=e.get(a);if(!h)return r;if(h.type==="shortcode"){const{shortcodeName:p,params:u,content:g,isBlock:m}=h;let w=m!==!1;if(window.EditorPro&&window.EditorPro.getShortcodeRegistry){const f=window.EditorPro.getShortcodeRegistry();if(f){const k=f.get(p);k&&(w=k.type==="block")}}const y=["section","columns","ui-accordion","ui-accordion-item","column","notice","details","div","figure"];if((!window.EditorPro||!window.EditorPro.getShortcodeRegistry)&&(w=y.some(f=>p.toLowerCase()===f.toLowerCase())),w){let f="";if(g&&g.trim()){const k=g.trim();f=`[${p}${u?` ${u}`:""}]
${k}
[/${p}]
`}else f=`[${p}${u?` ${u}`:""}][/${p}]
`;return f}else return g&&g.trim()?`[${p}${u?` ${u}`:""}]${g.trim()}[/${p}]`:`[${p}${u?` ${u}`:""}][/${p}]`}return h.original}),n=n.replace(/\{\{RAW_BLOCK_([\w_]+)\}\}/g,s),n=n.replace(/\{\{PRESERVED_BLOCK_([\w_]+)\}\}/g,s)}return l>=o,n}preserveGravImages(t){const e=/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/g;return t.replace(e,(i,n,l,o)=>{const[s,r]=l.split("?"),a=r?`?${r}`:"";if(a&&this.hasGravMediaActions(a)){const c=this.generateBlockId(),d=this.parseGravMediaActions(a);return this.blockMap.set(c,{type:"grav-image",alt:n||"",imagePath:s,queryString:a,actions:d,original:i,isBlock:!1}),`{{PRESERVED_BLOCK_${c}}}`}return i})}hasGravMediaActions(t){return["resize","cropResize","crop","quality","format","rotate","flip","brightness","contrast","gamma","sharpen","blur","pixelate","sepia","emboss","smooth","colorize","classes","lightbox","loading","id","title","alt"].some(i=>t.includes(i+"="))}parseGravMediaActions(t){const e={},i=new URLSearchParams(t.substring(1));for(const[n,l]of i)e[n]=l;return e}generateBlockId(){return`block_${++this.blockCounter}_${Date.now()}`}}function P(E){const t=document.createElement("div");return t.textContent=E,t.innerHTML}function F(E,t){switch(E){case"shortcode":const e=t.tagName||t.shortcodeName||"undefined";if(window.EditorPro&&window.EditorPro.getShortcodeRegistry){const o=window.EditorPro.getShortcodeRegistry();if(o){const s=o.generateTitleBar(e,t.attributes||{},t.params||"");if(s)return s}}const i=t.params||"";let n=e.charAt(0).toUpperCase()+e.slice(1);e.toLowerCase()==="section"&&(n="Section");let l="";if(i.trim())if(t.attributes&&Object.keys(t.attributes).length>0)l=` (${Object.entries(t.attributes).map(([s,r])=>`${s}: ${r}`).join(", ")})`;else{const o=i.match(/([\w-]+)=["']?([^"'\s]+)["']?/g);o&&o.length>0?l=` (${o.map(r=>{const[,a,c]=r.match(/([\w-]+)=["']?([^"'\s]+)["']?/)||[];return`${a}: ${c}`}).join(", ")})`:i.trim()&&(l=` (${i.trim()})`)}return`${n}${l}`;case"html":return"Raw Code Embed";case"twig":return"Twig Block";case"grav-image":return"Grav Image";default:return"Preserved Block"}}function V(E,t){if(t.type==="shortcode")if(t.isClosing)try{let e=t.content||"";window.EditorPro&&window.EditorPro.activeEditor&&window.EditorPro.activeEditor.pathMappings&&(e=e.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(a,c,d)=>{var p,u;const h=(u=(p=window.EditorPro.activeEditor.pathMappings)==null?void 0:p.images)==null?void 0:u[d];return h&&h.html?h.html:a}));const i=[];let n=0;const l=/<img[^>]*>/g;let o;for(;(o=l.exec(e))!==null;){if(o.index>n){const a=e.substring(n,o.index).trim();a&&i.push({type:"markdown",content:a})}i.push({type:"html",content:o[0]}),n=o.index+o[0].length}if(n<e.length){const a=e.substring(n).trim();a&&i.push({type:"markdown",content:a})}return i.map(a=>{if(a.type==="html")return a.content;{let c=a.content;const d=[];c=c.replace(/```(\w*)\s*\n([\s\S]*?)```/gm,(p,u,g)=>{const m=d.length;return d.push({language:u.trim(),code:g.replace(/^\n+|\n+$/g,"")}),`<!--FENCED_CODE_${m}-->`});let h=marked.parse(c);return d.forEach((p,u)=>{const g=p.language?` class="language-${p.language}"`:"",m=p.code.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");h=h.replace(`<!--FENCED_CODE_${u}-->`,`<pre><code${g}>${m}</code></pre>`)}),h}}).join(`
`)}catch(e){return t.content||""}else return`[${t.tagName}${t.params||""}]`;return t.original||E}let Q,W,ee,te,J,K,Z;function ce(){var t;const E=TiptapCore.Mark||((t=TiptapCore.default)==null?void 0:t.Mark);return E?E.create({name:"link",priority:1e3,keepOnSplit:!1,addOptions(){return{openOnClick:!1,linkOnPaste:!0,autolink:!0,protocols:[],HTMLAttributes:{},validate:void 0}},addAttributes(){return{href:{default:null,parseHTML:e=>e.getAttribute("href"),renderHTML:e=>e.href?{href:e.href}:{}},target:{default:null,parseHTML:e=>e.getAttribute("target"),renderHTML:e=>e.target?{target:e.target}:{}},"data-href":{default:null,parseHTML:e=>e.getAttribute("data-href"),renderHTML:e=>e["data-href"]?{"data-href":e["data-href"]}:{}}}},parseHTML(){return[{tag:'a[href]:not([href *= "javascript:" i])',getAttrs:e=>({href:e.getAttribute("href"),target:e.getAttribute("target"),"data-href":e.getAttribute("data-href")})}]},renderHTML({HTMLAttributes:e}){return["a",e,0]},addCommands(){return{setLink:e=>({chain:i})=>i().setMark(this.name,e).run(),toggleLink:e=>({chain:i})=>i().toggleMark(this.name,e,{extendEmptyMarkRange:!0}).run(),unsetLink:()=>({chain:e})=>e().unsetMark(this.name,{extendEmptyMarkRange:!0}).run()}}}):null}function de(){var t,e;const E=TiptapCore.Node||((t=TiptapCore.default)==null?void 0:t.Node)||((e=window.TipTap)==null?void 0:e.Node);return E?E.create({name:"summaryDelimiter",group:"block",atom:!0,selectable:!0,draggable:!1,isolating:!0,defining:!0,addAttributes(){return{delimiter:{default:"",parseHTML:i=>i.getAttribute("data-delimiter")||"",renderHTML:i=>i.delimiter?{"data-delimiter":i.delimiter}:{}}}},parseHTML(){return[{tag:"div[data-summary-delimiter]",getAttrs:i=>({delimiter:i.getAttribute("data-delimiter")||""})}]},renderHTML({HTMLAttributes:i}){const n=Object.assign({},i);n["data-summary-delimiter"]="true";const l=n.class||"";return n.class=l?`${l} summary-delimiter`:"summary-delimiter",n.role=n.role||"separator",n["aria-label"]=n["aria-label"]||G,["div",n,["span",{class:"summary-delimiter-label",contenteditable:"false"},G]]},addCommands(){return{insertSummaryDelimiter:(i="")=>({commands:n})=>n.insertContent({type:this.name,attrs:{delimiter:i}})}}}):null}function he(){var t,e;const E=TiptapCore.Node||((t=TiptapCore.default)==null?void 0:t.Node)||((e=window.TipTap)==null?void 0:e.Node);return E?E.create({name:"shortcode",group:"block",content:"block*",defining:!0,isolating:!0,priority:1001,addAttributes(){return{tagName:{default:""},params:{default:""},class:{default:"shortcode-block"}}},parseHTML(){return[{tag:"div[data-shortcode]",getAttrs:i=>{const n=i.getAttribute("data-shortcode"),l=i.getAttribute("data-params")||"";return n?{tagName:n,params:l,class:`shortcode-block ${n}`}:!1},contentElement:i=>i}]},renderHTML({HTMLAttributes:i,node:n}){const{tagName:l,params:o}=n.attrs;return["div",{"data-shortcode":l,"data-params":o,class:`shortcode-block ${l}`},0]},addNodeView(){return({node:i,getPos:n,editor:l})=>{const{tagName:o,params:s}=i.attrs,r=s?s.replace(/&quot;/g,'"'):"",a=document.createElement("div"),c=document.createElement("div");a.className=`shortcode-block ${o}`,a.setAttribute("data-shortcode",o),a.setAttribute("data-params",s);const d=document.createElement("div");return d.className="shortcode-header",d.contentEditable=!1,d.textContent=`${o.toUpperCase()}${r?` ${r}`:""}`,c.className="shortcode-content",a.appendChild(d),a.appendChild(c),{dom:a,contentDOM:c}}}}):null}function pe(){var t,e;const E=TiptapCore.Node||((t=TiptapCore.default)==null?void 0:t.Node)||((e=window.TipTap)==null?void 0:e.Node);return E?E.create({name:"preservedBlock",group:"block",content:"block*",atom:!1,isolating:!0,priority:1001,addAttributes(){return{blockId:{default:null},blockType:{default:"html"},blockContent:{default:""},blockData:{default:{}}}},parseHTML(){return[{tag:"div[data-preserved-block]",getAttrs:i=>{const n=i.getAttribute("data-block-id"),l=i.getAttribute("data-block-type"),o=i.getAttribute("data-block-data");let s={},r="";if(o)try{s=JSON.parse(o),r=s.content||""}catch(a){}return{blockId:n||"",blockType:l||"html",blockContent:r,blockData:s}}}]},renderHTML({HTMLAttributes:i,node:n}){const{blockId:l,blockType:o,blockContent:s,blockData:r}=n.attrs;return["div",{"data-preserved-block":"true","data-block-id":l,"data-block-type":o,class:`preserved-block ${o}`,contenteditable:"false"},["div",{class:"preserved-block-header"},["span",{},F(o,r)],["div",{class:"preserved-block-controls"},["button",{type:"button",onclick:`window.EditorPro.editBlock('${l}')`},"Edit"],["button",{type:"button",onclick:`window.EditorPro.deleteBlock('${l}')`},"Delete"]]],["div",{class:"preserved-block-content","data-block-id":l,"data-block-data":JSON.stringify(r)},0]]},addNodeView(){return({node:i,HTMLAttributes:n,getPos:l,editor:o})=>{var m,w,y,f,k,b,C,x,v,S;const{blockId:s,blockType:r,blockData:a}=i.attrs;let c=!1;if(r==="shortcode"&&a.tagName){const $=(y=(w=(m=window.EditorPro)==null?void 0:m.pluginSystem)==null?void 0:w.shortcodeRegistry)==null?void 0:y.get(a.tagName);c=$&&$.type==="inline"}const d=document.createElement(c?"span":"div");d.setAttribute("data-preserved-block","true"),d.setAttribute("data-block-id",s),d.setAttribute("data-block-type",r),r==="shortcode"&&a.tagName&&d.setAttribute("data-shortcode-name",a.tagName),d.className=c?"preserved-inline shortcode":`preserved-block ${r}`,d.contentEditable="false";const h=F(r,a);let p=V(a.content||"",a);if(c){d.style.display="inline",d.style.padding="2px 6px",d.style.margin="0 2px",d.style.backgroundColor="rgba(76, 175, 80, 0.1)",d.style.border="1px solid #4CAF50",d.style.borderRadius="3px",d.style.fontSize="0.9em",d.style.fontFamily="monospace",d.style.cursor="pointer";const $=(b=(k=(f=window.EditorPro)==null?void 0:f.pluginSystem)==null?void 0:k.shortcodeRegistry)==null?void 0:b.get(a.tagName);let M=`[${a.tagName}`;return $&&$.titleBarAttributes&&$.titleBarAttributes.forEach(T=>{a.attributes&&a.attributes[T]&&(M+=` ${T}="${a.attributes[T]}"`)}),a.content?M+=`]${a.content}[/${a.tagName}]`:M+="]",d.innerHTML=M,d.title=`${($==null?void 0:$.title)||a.tagName} (click to edit)`,d.onclick=()=>window.EditorPro.editBlock(s),{dom:d}}if(r==="shortcode"&&a.tagName&&a.attributes)try{const $=(x=(C=window.EditorPro)==null?void 0:C.pluginSystem)==null?void 0:x.shortcodeRegistry;if($){$.ensureInitialized();const M=$.generateCSS(a.tagName,a.attributes);M&&d.setAttribute("style",M)}}catch($){}const u=document.createElement("div");if(u.className="preserved-block-content",u.setAttribute("data-block-id",s),u.setAttribute("data-block-data",JSON.stringify(a)),u.contentEditable="true",u.spellcheck=!1,r==="shortcode"&&a.content)try{let $=a.content;const M=(S=(v=window.EditorPro)==null?void 0:v.activeEditor)==null?void 0:S.preservedBlocks;if(M&&($=$.replace(/\{\{CODE_INLINE_([\w_]+)\}\}/g,(T,N)=>{const B=M.get(N);return B&&B.original?B.original:T})),typeof marked!="undefined"){const T=[];$=$.replace(/```(\w*)\s*\n([\s\S]*?)```/gm,(N,B,z)=>{const D=T.length;return T.push({language:B.trim(),code:z.replace(/^\n+|\n+$/g,"")}),`<!--FENCED_CODE_${D}-->`}),$=marked.parse($),T.forEach((N,B)=>{const z=N.language?` class="language-${N.language}"`:"",D=N.code.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");$=$.replace(`<!--FENCED_CODE_${B}-->`,`<pre><code${z}>${D}</code></pre>`)}),$=$.replace(/^<p>(.*)<\/p>\s*$/s,"$1")}u.innerHTML=$}catch($){u.innerHTML=a.content||""}else u.innerHTML=p;d.innerHTML=`
                        <div class="preserved-block-header">
                            <span>${h}</span>
                            <div class="preserved-block-controls">
                                <button type="button" onclick="window.EditorPro.editBlock('${s}')">Edit</button>
                                <button type="button" onclick="window.EditorPro.deleteBlock('${s}')">Delete</button>
                            </div>
                        </div>
                    `,d.appendChild(u);const g=(a.tagName||"").toLowerCase();return r==="shortcode"&&g==="doc-step"&&requestAnimationFrame(()=>{const $=d.closest('[data-shortcode-name="doc-steps"], [data-shortcode-name="Doc-steps"]');if($){const M=$.querySelectorAll('[data-shortcode-name="doc-step"], [data-shortcode-name="Doc-step"]'),T=Array.from(M).indexOf(d)+1,N=d.querySelector(".preserved-block-header > span");N&&T>0&&!N.textContent.startsWith("(")&&(N.textContent=`(${T}) ${N.textContent}`)}}),{dom:d,contentDOM:u}}}}):null}function ue(){const E=TiptapShortcodeBlock==null?void 0:TiptapShortcodeBlock.ShortcodeBlock;return E||null}function ke(){var t,e;const E=TiptapCore.Node||((t=TiptapCore.default)==null?void 0:t.Node)||((e=window.TipTap)==null?void 0:e.Node);return E?E.create({name:"rawBlock",group:"block",content:"text*",code:!0,defining:!0,isolating:!0,addAttributes(){return{language:{default:"html"},content:{default:""},blockId:{default:null}}},parseHTML(){return[{tag:'div[data-raw-block="true"]',getAttrs:i=>{const n=i.getAttribute("data-language")||"html",l=i.getAttribute("data-block-id");let o="";const s=i.getAttribute("data-content-base64");if(s)try{o=decodeURIComponent(escape(atob(s)))}catch(r){o=i.textContent||""}else o=i.textContent||"";return{language:n,content:o,blockId:l}}}]},renderHTML({HTMLAttributes:i,node:n}){const{language:l,content:o,blockId:s}=n.attrs,r=btoa(unescape(encodeURIComponent(o||"")));return["div",{"data-raw-block":"true","data-language":l,"data-content-base64":r,"data-block-id":s||`raw_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,class:"raw-block-container"},o||""]},addCommands(){return{insertRawBlock:(i="",n="html")=>({commands:l})=>{const o=`raw_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return l.insertContent({type:"rawBlock",attrs:{content:i,language:n,blockId:o}})}}},addNodeView(){return({node:i,getPos:n,editor:l})=>{const{language:o,content:s,blockId:r}=i.attrs,a=document.createElement("div");a.className="raw-block-container",a.setAttribute("data-raw-block","true"),a.setAttribute("data-language",o),a.setAttribute("data-block-id",r);const c=document.createElement("div");c.className="raw-block-header",c.contentEditable="false",c.innerHTML=`
                        <span class="raw-block-title">Raw ${o.toUpperCase()} Code</span>
                        <button type="button" class="raw-block-edit" onclick="window.EditorPro.editRawBlock('${r}')">Edit</button>
                    `;const d=document.createElement("pre");d.className="raw-block-editor",d.contentEditable="true",d.spellcheck=!1;const h=document.createElement("code");return h.className=`language-${o}`,h.textContent=s||"",d.appendChild(h),d.addEventListener("input",()=>{if(typeof n=="function"){const p=n(),u=l.state.tr.setNodeMarkup(p,void 0,{...i.attrs,content:d.textContent});l.view.dispatch(u)}}),a.appendChild(c),a.appendChild(d),{dom:a,contentDOM:d}}}}):null}function me(){const E=TiptapCore.Node;return E?E.create({name:"preservedInline",group:"inline",content:"",atom:!0,inline:!0,addAttributes(){return{blockId:{default:null},blockType:{default:"shortcode"},blockContent:{default:""},blockData:{default:{}}}},parseHTML(){return[{tag:"span[data-preserved-inline]",getAttrs:t=>{const e=t.getAttribute("data-block-id"),i=t.getAttribute("data-block-type");let n=t.textContent||"",l={};const o=t.getAttribute("data-block-data");if(o)try{l=JSON.parse(o),n=l.content||""}catch(s){}return{blockId:e||"",blockType:i||"shortcode",blockContent:n,blockData:l}}}]},renderHTML({HTMLAttributes:t,node:e}){const{blockId:i,blockType:n,blockContent:l,blockData:o}=e.attrs;return["span",{"data-preserved-inline":"true","data-block-id":i,"data-block-type":n,"data-block-data":JSON.stringify(o),class:"preserved-inline shortcode",contenteditable:"false"},l]},addNodeView(){return({node:t,HTMLAttributes:e,getPos:i,editor:n})=>{var c,d,h,p;const{blockId:l,blockType:o,blockData:s}=t.attrs,r=document.createElement("span");r.setAttribute("data-preserved-inline","true"),r.setAttribute("data-block-id",l),r.setAttribute("data-block-type",o),r.setAttribute("data-block-data",JSON.stringify(s)),r.className="preserved-inline shortcode",r.contentEditable="false",r.style.display="inline",r.style.padding="2px 6px",r.style.margin="0 2px",r.style.backgroundColor="rgba(76, 175, 80, 0.1)",r.style.border="1px solid #4CAF50",r.style.borderRadius="3px",r.style.fontSize="0.9em",r.style.fontFamily="monospace",r.style.cursor="pointer";try{const u=(d=(c=window.EditorPro)==null?void 0:c.pluginSystem)==null?void 0:d.shortcodeRegistry;if(u&&s&&s.attributes&&s.tagName){u.ensureInitialized();const g=u.generateCSS(s.tagName,s.attributes);g&&(r.style.cssText+=`; ${g}`)}}catch(u){}const a=(p=(h=window.EditorPro)==null?void 0:h.pluginSystem)==null?void 0:p.renderShortcodeForEditor(s);return r.innerHTML=a,r.title=`${s.original} (click to edit)`,{dom:r}}}}):null}class ge{constructor(){this.shortcodes=new Map,this.cssTemplates=new Map,this.initialized=!1}ensureInitialized(){this.initialized||(this.initializeFromGlobal(),this.initialized=!0)}initializeFromGlobal(){window.EditorProShortcodes&&Array.isArray(window.EditorProShortcodes)&&window.EditorProShortcodes.forEach(t=>{this.register(t)})}register(t){if(!t.name)return!1;const e=["name","title","type"];for(const n of e)if(!t[n])return!1;const i={name:t.name,title:t.title,description:t.description||"",type:t.type||"block",attributes:t.attributes||{},titleBarAttributes:t.titleBarAttributes||[],hasContent:t.hasContent!==!1,cssTemplate:t.cssTemplate||"",icon:t.icon||"",plugin:t.plugin||"unknown",category:t.category||"other",group:t.group||t.plugin||"Other",customRenderer:this.parseCustomRenderer(t.customRenderer),allowedChildren:t.allowedChildren||[],parentOnly:t.parentOnly||!1,restrictContent:t.restrictContent||!1,contentType:t.contentType||"blocks",language:t.language||"javascript",bbcodeAttribute:t.bbcodeAttribute||null};return this.shortcodes.set(t.name,i),i.cssTemplate&&this.cssTemplates.set(t.name,i.cssTemplate),!0}parseCustomRenderer(t){if(!t)return null;if(typeof t=="function")return t;if(typeof t=="string")try{return new Function("blockData","config",`return (${t})(blockData, config);`)}catch(e){return null}return null}get(t){return this.ensureInitialized(),this.shortcodes.get(t)}getAll(){return this.ensureInitialized(),Array.from(this.shortcodes.values())}getByType(t){return this.ensureInitialized(),this.getAll().filter(e=>e.type===t)}getGrouped(){this.ensureInitialized();const t=new Map;return this.getAll().forEach(e=>{const i=e.group;t.has(i)||t.set(i,{name:i,plugin:e.plugin,shortcodes:[]}),t.get(i).shortcodes.push(e)}),Array.from(t.values()).sort((e,i)=>e.name.localeCompare(i.name))}getByCategory(t){return this.ensureInitialized(),this.getAll().filter(e=>e.category===t)}getCategories(){this.ensureInitialized();const t=new Set;return this.getAll().forEach(e=>t.add(e.category)),Array.from(t).sort()}getCategorized(){this.ensureInitialized();const t=new Map;return this.getAll().forEach(e=>{const i=e.category;t.has(i)||t.set(i,[]),t.get(i).push(e)}),Object.fromEntries(t)}generateCSS(t,e){this.ensureInitialized();const i=this.cssTemplates.get(t);if(!i)return"";const n=this.get(t);if(!n)return"";let l=i;const o={};return Object.entries(n.attributes||{}).forEach(([s,r])=>{o[s]=e[s]||r.default||""}),Object.entries(o).forEach(([s,r])=>{if(r){const a=new RegExp(`\\{\\{${s}\\}\\}`,"g");l=l.replace(a,r)}}),l=l.replace(/\{\{[^}]+\}\}/g,""),l=l.replace(/[^;]+:\s*;/g,"").trim(),l}generateTitleBar(t,e,i=""){const n=this.get(t);if(!n)return t;if(n.plugin==="codesh"){let s=e.lang;if(!s&&i){const c=i.trim();c.startsWith("=")?s=c.substring(1).trim():c&&!c.includes("=")&&(s=c)}const r=[];e.title&&r.push(e.title),s&&r.push(s),e.theme&&r.push(`theme: ${e.theme}`),e.highlight&&r.push(`lines: ${e.highlight}`),e.focus&&r.push(`focus: ${e.focus}`),(e["line-numbers"]===!0||e["line-numbers"]==="true")&&r.push("numbered"),(e.diff===!0||e.diff==="true")&&r.push("diff");const a=r.length>0?r.join(" - "):"";return a?`${n.title}: ${a}`:n.title}if(n.titleBarAttributes.length===0)return n.title;const l=n.titleBarAttributes.map(s=>{const r=e[s];return r?`${s}: <strong>${r}</strong>`:null}).filter(Boolean),o=l.length>0?l.join(", "):"";return o?`${n.title.toUpperCase()} ${o}`:n.title}canHaveChildren(t){const e=this.get(t);return e&&e.allowedChildren.length>0}getAllowedChildren(t){const e=this.get(t);return e?e.allowedChildren:[]}isChildOnly(t){const e=this.get(t);return e&&e.parentOnly}hasRestrictedContent(t){const e=this.get(t);return e&&e.restrictContent}isChildAllowed(t,e){const i=this.get(t);return i?i.allowedChildren.includes(e):!1}getChildShortcodes(t){return this.getAllowedChildren(t).map(i=>this.get(i)).filter(Boolean)}getTopLevelShortcodes(){return this.ensureInitialized(),this.getAll().filter(t=>!t.parentOnly)}getAllSortedLogically(){this.ensureInitialized();const t=this.getAll(),e=new Map,i=[];t.forEach(o=>{if(o.parentOnly){const s=[o.name.replace("-item",""),o.name.replace("-tab","-tabs"),o.name.split("-").slice(0,-1).join("-")],r=t.find(a=>{var c;return s.includes(a.name)&&((c=a.allowedChildren)==null?void 0:c.includes(o.name))});r&&(e.has(r.name)||e.set(r.name,[]),e.get(r.name).push(o))}else i.push(o)});const n=["formatting","layout","content","media","ui","testing"];i.sort((o,s)=>{const r=n.indexOf(o.category)!==-1?n.indexOf(o.category):999,a=n.indexOf(s.category)!==-1?n.indexOf(s.category):999;if(r!==a)return r-a;if(o.group&&s.group&&o.group!==s.group)return o.group.localeCompare(s.group);const c=["left","center","right","justify"],d=c.indexOf(o.name),h=c.indexOf(s.name);return d!==-1&&h!==-1?d-h:d!==-1?-1:h!==-1?1:o.name.match(/^h[1-6]$/)&&s.name.match(/^h[1-6]$/)?o.name.localeCompare(s.name):o.name.match(/^h[1-6]$/)?-1:s.name.match(/^h[1-6]$/)?1:o.name.localeCompare(s.name)});const l=[];return i.forEach(o=>{l.push(o);const s=e.get(o.name);s&&(s.sort((r,a)=>r.name.localeCompare(a.name)),l.push(...s))}),l}validateAttributes(t,e){const i=this.get(t);if(!i)return{valid:!1,errors:["Unknown shortcode"]};const n=[];return Object.entries(i.attributes).forEach(([l,o])=>{const s=e[l];if(o.required&&!s&&n.push(`Required attribute '${l}' is missing`),s!==void 0)switch(o.type){case"number":isNaN(s)&&n.push(`Attribute '${l}' must be a number`),o.min!==void 0&&s<o.min&&n.push(`Attribute '${l}' must be >= ${o.min}`),o.max!==void 0&&s>o.max&&n.push(`Attribute '${l}' must be <= ${o.max}`);break;case"select":o.options&&!o.options.includes(s)&&n.push(`Attribute '${l}' must be one of: ${o.options.join(", ")}`);break}}),{valid:n.length===0,errors:n}}}class fe{constructor(){this.plugins=new Map,this.shortcodeRegistry=new ge}register(t){t.name&&this.plugins.set(t.name,t)}registerShortcode(t){return this.shortcodeRegistry.register(t)}registerShortcodeRenderer(t,e){const i=this.shortcodeRegistry.get(t);return i?(i.customRenderer=e,!0):!1}getShortcodeRegistry(){return this.shortcodeRegistry}renderShortcodeForEditor(t){var i;const e=(i=this.shortcodeRegistry)==null?void 0:i.get(t.tagName);if(e&&e.customRenderer&&typeof e.customRenderer=="function")try{return e.customRenderer(t,e)}catch(n){}return this.renderShortcodeDefault(t)}renderShortcodeDefault(t){if(t.content)try{if(typeof marked!="undefined"){let e=t.content;const i=[];e=e.replace(/```(\w*)\s*\n([\s\S]*?)```/gm,(l,o,s)=>{const r=i.length;return i.push({language:o.trim(),code:s.replace(/^\n+|\n+$/g,"")}),`<!--FENCED_CODE_${r}-->`});let n=marked.parse(e);return i.forEach((l,o)=>{const s=l.language?` class="language-${l.language}"`:"",r=l.code.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");n=n.replace(`<!--FENCED_CODE_${o}-->`,`<pre><code${s}>${r}</code></pre>`)}),n=n.replace(/<\/?p[^>]*>/g,"").trim(),n}else return t.content}catch(e){return t.content}return t.tagName}initialize(t){t.shortcodeRegistry=this.shortcodeRegistry,this.plugins.forEach(e=>{if(typeof e.init=="function")try{e.init(t)}catch(i){}})}}class be{constructor(t){this.textarea=t,this.preserver=new le,this.preservedBlocks=new Map,this.editor=null,this.isUpdatingTextarea=!1,this.dragHandlesVisible=!1,this.summaryDelimiter="===",this.summaryDelimiterTrimmed="===",this.summaryDelimiterLabel=G;const e=localStorage.getItem("editor-pro-typography");this.typographyEnabled=e!=="false",this.rawMarkdownMode=null,this.isMarkdownMode=!1,this.init()}init(){this.setupFieldStyling(),this.initializeTheme(),this.loadPathMappings(),this.createToolbar(),this.initializeEditor(),this.setupEventListeners(),setTimeout(()=>{this.setupStickyToolbar(),this.fixOverflowForSticky()},500),window.EditorPro.pluginSystem&&window.EditorPro.pluginSystem.initialize(this)}loadPathMappings(){var e,i,n;const t=this.textarea.closest(".editor-pro-wrapper");if(this.pathMappings={images:{},links:{}},t){try{const o=t.getAttribute("data-path-mappings");o&&(this.pathMappings=JSON.parse(o))}catch(o){}const l=t.getAttribute("data-summary-delimiter");l&&l.length?this.summaryDelimiter=l:this.summaryDelimiter="===",this.adminRoute=t.getAttribute("data-admin-route"),this.adminNonce=t.getAttribute("data-admin-nonce"),this.pageRoute=t.getAttribute("data-page-route"),(!this.adminRoute||!this.adminNonce)&&((e=window.GravAdmin)!=null&&e.config)&&(this.adminRoute=this.adminRoute||((i=window.GravAdmin.config.current_url)==null?void 0:i.replace(/\/pages.*$/,"")),this.adminNonce=this.adminNonce||window.GravAdmin.config.admin_nonce,this.pageRoute=this.pageRoute||window.GravAdmin.config.route),(n=window.GravAdmin)!=null&&n.config}else this.summaryDelimiter=this.summaryDelimiter||"===";this.summaryDelimiterTrimmed=(this.summaryDelimiter||"===").trim()||"==="}setupFieldStyling(){const t=this.textarea.closest(".form-field");t&&(t.style.display="block",t.style.width="100%");const e=this.textarea.parentNode;e&&e.classList.contains("editor-pro-wrapper")&&(e.style.width="100%",e.style.display="block")}getIcon(t){return{undo:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-back-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 14l-4 -4l4 -4" /><path d="M5 10h11a4 4 0 1 1 0 8h-1" /></svg>',redo:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-forward-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 14l4 -4l-4 -4" /><path d="M19 10h-11a4 4 0 1 0 0 8h1" /></svg>',removeformat:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-ballpen-off"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 6l7 7l-2 2" /><path d="M10 10l-4.172 4.172a2.828 2.828 0 1 0 4 4l4.172 -4.172" /><path d="M16 12l4.414 -4.414a2 2 0 0 0 0 -2.829l-1.171 -1.171a2 2 0 0 0 -2.829 0l-4.414 4.414" /><path d="M4 20l1.768 -1.768" /><path d="M3 3l18 18" /></svg>',heading:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 12h12"/><path d="M6 20V4"/><path d="M18 20V4"/></svg>',h1:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 18v-8l-2 2" /><path d="M4 6v12" /><path d="M12 6v12" /><path d="M11 18h2" /><path d="M3 18h2" /><path d="M4 12h8" /><path d="M3 6h2" /><path d="M11 6h2" /></svg>',h2:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M17 12a2 2 0 1 1 4 0c0 .591 -.417 1.318 -.816 1.858l-3.184 4.143l4 0" /><path d="M4 6v12" /><path d="M12 6v12" /><path d="M11 18h2" /><path d="M3 18h2" /><path d="M4 12h8" /><path d="M3 6h2" /><path d="M11 6h2" /></svg>',h3:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 14a2 2 0 1 0 -2 -2" /><path d="M17 16a2 2 0 1 0 2 -2" /><path d="M4 6v12" /><path d="M12 6v12" /><path d="M11 18h2" /><path d="M3 18h2" /><path d="M4 12h8" /><path d="M3 6h2" /><path d="M11 6h2" /></svg>',h4:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20 18v-8l-4 6h5" /><path d="M4 6v12" /><path d="M12 6v12" /><path d="M11 18h2" /><path d="M3 18h2" /><path d="M4 12h8" /><path d="M3 6h2" /><path d="M11 6h2" /></svg>',h5:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M17 18h2a2 2 0 1 0 0 -4h-2v-4h4" /><path d="M4 6v12" /><path d="M12 6v12" /><path d="M11 18h2" /><path d="M3 18h2" /><path d="M4 12h8" /><path d="M3 6h2" /><path d="M11 6h2" /></svg>',h6:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 14a2 2 0 1 0 0 4a2 2 0 0 0 0 -4z" /><path d="M21 12a2 2 0 1 0 -4 0v4" /><path d="M4 6v12" /><path d="M12 6v12" /><path d="M11 18h2" /><path d="M3 18h2" /><path d="M4 12h8" /><path d="M3 6h2" /><path d="M11 6h2" /></svg>',bold:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 12a4 4 0 0 0 0-8H6v8"/><path d="M15 20a4 4 0 0 0 0-8H6v8Z"/></svg>',italic:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="4" x2="10" y2="4"/><line x1="14" y1="20" x2="5" y2="20"/><line x1="15" y1="4" x2="9" y2="20"/></svg>',underline:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 4v6a6 6 0 0 0 12 0V4"/><line x1="4" y1="20" x2="20" y2="20"/></svg>',strikethrough:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4H9a3 3 0 0 0-2.83 4"/><path d="M14 12a4 4 0 0 1 0 8H6"/><line x1="4" y1="12" x2="20" y2="12"/></svg>',link:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>',image:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>',blockquote:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-blockquote"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 15h15" /><path d="M21 19h-15" /><path d="M15 11h6" /><path d="M21 7h-6" /><path d="M9 9h1a1 1 0 1 1 -1 1v-2.5a2 2 0 0 1 2 -2" /><path d="M3 9h1a1 1 0 1 1 -1 1v-2.5a2 2 0 0 1 2 -2" /></svg>',bulletList:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>',orderedList:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="10" y1="6" x2="21" y2="6"/><line x1="10" y1="12" x2="21" y2="12"/><line x1="10" y1="18" x2="21" y2="18"/><path d="M4 6h1v4"/><path d="M4 10h2"/><path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>',codeBlock:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16,18 22,12 16,6"/><polyline points="8,6 2,12 8,18"/></svg>',table:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18"/></svg>',tableRowAbove:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v6m0 0l3-3m-3 3l-3-3M3 10h18M3 14h18M3 18h18M3 22h18"/></svg>',tableRowBelow:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 2h18M3 6h18M3 10h18M3 14h18m-9 8v-6m0 6l3-3m-3 3l-3-3"/></svg>',tableRowDelete:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18M3 10h18M3 14h18M3 18h18M5 12h14"/></svg>',tableColumnBefore:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h6m0 0l-3-3m3 3l-3 3M10 3v18M14 3v18M18 3v18M22 3v18"/></svg>',tableColumnAfter:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3v18M6 3v18M10 3v18M14 3v18m8 9h-6m6 0l-3-3m3 3l-3 3"/></svg>',tableColumnDelete:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3v18M6 3v18M10 3v18M14 3v18M18 3v18M22 3v18M12 5v14"/></svg>',tableHeaderRow:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18" stroke-width="3"/><path d="M3 10h18" stroke-width="2"/><path d="M3 14h18" stroke-width="2"/><path d="M3 18h18" stroke-width="2"/></svg>',tableHeaderColumn:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v18" stroke-width="3"/><path d="M10 3v18" stroke-width="2"/><path d="M14 3v18" stroke-width="2"/><path d="M18 3v18" stroke-width="2"/></svg>',tableDelete:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18"/><path d="M15 2L9 22" stroke="red"/><path d="M9 2l6 20" stroke="red"/></svg>',htmlBlock:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m18 16 4-4-4-4"/><path d="m6 8-4 4 4 4"/><path d="m14.5 4-5 16"/></svg>',shortcodeBlock:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-bolt"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 3l0 7l6 0l-8 11l0 -7l-6 0l8 -11" /></svg>',githubAlert:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-info-circle"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" /><path d="M12 9h.01" /><path d="M11 12h1v4h1" /></svg>',githubAlertNote:'<svg class="octicon octicon-info" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>',githubAlertTip:'<svg class="octicon octicon-light-bulb" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>',githubAlertImportant:'<svg class="octicon octicon-report" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>',githubAlertWarning:'<svg class="octicon octicon-alert" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>',githubAlertCaution:'<svg class="octicon octicon-stop" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M4.47.22A.749.749 0 0 1 5 0h6c.199 0 .389.079.53.22l4.25 4.25c.141.14.22.331.22.53v6a.749.749 0 0 1-.22.53l-4.25 4.25A.749.749 0 0 1 11 16H5a.749.749 0 0 1-.53-.22L.22 11.53A.749.749 0 0 1 0 11V5c0-.199.079-.389.22-.53Zm.84 1.28L1.5 5.31v5.38l3.81 3.81h5.38l3.81-3.81V5.31L10.69 1.5ZM8 4a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 8 4Zm0 8a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>',summaryDelimiter:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16"/><path d="M8 12h8"/><path d="M4 17h16"/></svg>',sun:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>',moon:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>',hardbreak:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-corner-down-left-double"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 5v6a3 3 0 0 1 -3 3h-7" /><path d="M13 10l-4 4l4 4m-5 -8l-4 4l4 4" /></svg>',horizontalRule:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-separator"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12l0 .01" /><path d="M7 12l10 0" /><path d="M21 12l0 .01" /></svg>',dragHandle:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-grip-vertical"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M9 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M9 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M15 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M15 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M15 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /></svg>',search:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-search"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" /><path d="M21 21l-6 -6" /></svg>',typography:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mood-smile"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0" /><path d="M9 10l.01 0" /><path d="M15 10l.01 0" /><path d="M9.5 15a3.5 3.5 0 0 0 5 0" /></svg>',typographyOff:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mood-off"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5.634 5.638a9 9 0 0 0 12.732 12.724m1.679 -2.322a9 9 0 0 0 -12.08 -12.086" /><path d="M9 10h.01" /><path d="M15 10h.01" /><path d="M9.5 15a3.5 3.5 0 0 0 5 0" /><path d="M3 3l18 18" /></svg>',inlineHtml:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 4h14"/><path d="M5 8h5"/><path d="M5 12h9"/><path d="M5 16h7"/><path d="M5 20h10"/><circle cx="12" cy="8" r="1" fill="currentColor"/><circle cx="16" cy="12" r="1" fill="currentColor"/><circle cx="14" cy="16" r="1" fill="currentColor"/><circle cx="17" cy="20" r="1" fill="currentColor"/></svg>',breaks:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7h16"/><path d="M8 12h8"/><path d="M4 17h16"/></svg>',text:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7V4h16v3"/><path d="M9 20h6"/><path d="M12 4v16"/></svg>',chevronUp:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 15l6 -6l6 6" /></svg>',chevronDown:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-down"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg>',x:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg>',markdown:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-markdown"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 5m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z" /><path d="M7 15v-6l2 2l2 -2v6" /><path d="M14 13l2 2l2 -2m-2 2v-6" /></svg>'}[t]||""}createToolbar(){const t=document.createElement("div");t.className="editor-pro-toolbar";let e=0;const i=50,n=()=>{var d,h,p,u;e++,window.EditorProPluginStatus&&window.EditorProPluginStatus.shortcodeCore?((u=(p=(h=(d=window.EditorPro)==null?void 0:d.pluginSystem)==null?void 0:h.shortcodeRegistry)==null?void 0:p.shortcodes)==null?void 0:u.size)>0?(this.addShortcodeButton(),this.addGitHubAlertButton()):e<i&&setTimeout(n,100):this.addGitHubAlertButton()};setTimeout(n,100),setTimeout(()=>{this.toolbar.querySelector('[data-toolbar-item="shortcodeBlock"]')||this.addGitHubAlertButton()},600);const l=[{name:"undo",title:"Undo",icon:"undo",action:()=>this.editor.commands.undo()},{name:"redo",title:"Redo",icon:"redo",action:()=>this.editor.commands.redo()},{type:"separator"},{name:"removeformat",title:"Remove Format",icon:"removeformat",action:()=>this.editor.chain().focus().clearNodes().unsetAllMarks().run()},{type:"separator"},{name:"heading",title:"Heading",icon:"heading",type:"dropdown",items:[{name:"h1",title:"Heading 1",icon:"h1",action:()=>this.setHeading(1)},{name:"h2",title:"Heading 2",icon:"h2",action:()=>this.setHeading(2)},{name:"h3",title:"Heading 3",icon:"h3",action:()=>this.setHeading(3)},{name:"h4",title:"Heading 4",icon:"h4",action:()=>this.setHeading(4)},{name:"h5",title:"Heading 5",icon:"h5",action:()=>this.setHeading(5)},{name:"h6",title:"Heading 6",icon:"h6",action:()=>this.setHeading(6)}]},{name:"bold",title:"Bold",icon:"bold",action:()=>this.editor.commands.toggleBold()},{name:"italic",title:"Italic",icon:"italic",action:()=>this.editor.commands.toggleItalic()},{name:"underline",title:"Underline",icon:"underline",action:()=>this.editor.commands.toggleUnderline()},{name:"strikethrough",title:"Strikethrough",icon:"strikethrough",action:()=>this.editor.commands.toggleStrike()},{name:"inlineHtml",title:"Inline HTML",icon:"inlineHtml",type:"dropdown",items:[{name:"abbr",title:"Abbreviation",icon:"text",action:()=>this.toggleInlineHtml("abbr")},{name:"cite",title:"Citation",icon:"text",action:()=>this.toggleInlineHtml("cite")},{name:"kbd",title:"Keyboard",icon:"text",action:()=>this.toggleInlineHtml("kbd")},{name:"mark",title:"Highlight",icon:"text",action:()=>this.toggleInlineHtml("mark")},{type:"separator"},{name:"sup",title:"Superscript",icon:"text",action:()=>this.toggleInlineHtml("sup")},{name:"sub",title:"Subscript",icon:"text",action:()=>this.toggleInlineHtml("sub")},{type:"separator"},{name:"var",title:"Variable",icon:"text",action:()=>this.toggleInlineHtml("var")},{name:"time",title:"Time",icon:"text",action:()=>this.toggleInlineHtml("time")},{name:"dfn",title:"Definition",icon:"text",action:()=>this.toggleInlineHtml("dfn")},{name:"q",title:"Quote",icon:"text",action:()=>this.toggleInlineHtml("q")}]},{type:"separator"},{name:"link",title:"Link",icon:"link",action:()=>this.insertLink()},{name:"image",title:"Image",icon:"image",action:()=>this.insertImage()},{name:"tableGroup",title:"Table",icon:"table",type:"dropdown",items:[{name:"insertTable",title:"Insert Table",icon:"table",action:()=>this.insertTable()},{type:"separator"},{name:"addRowBefore",title:"Add Row Above",icon:"tableRowAbove",action:()=>this.addRowBefore()},{name:"addRowAfter",title:"Add Row Below",icon:"tableRowBelow",action:()=>this.addRowAfter()},{name:"deleteRow",title:"Delete Row",icon:"tableRowDelete",action:()=>this.deleteRow()},{type:"separator"},{name:"addColumnBefore",title:"Add Column Before",icon:"tableColumnBefore",action:()=>this.addColumnBefore()},{name:"addColumnAfter",title:"Add Column After",icon:"tableColumnAfter",action:()=>this.addColumnAfter()},{name:"deleteColumn",title:"Delete Column",icon:"tableColumnDelete",action:()=>this.deleteColumn()},{type:"separator"},{name:"deleteTable",title:"Delete Table",icon:"tableDelete",action:()=>this.deleteTable()}]},{type:"separator"},{name:"blockquote",title:"Blockquote",icon:"blockquote",action:()=>this.editor.commands.toggleBlockquote()},{name:"breaks",title:"Breaks",icon:"breaks",type:"dropdown",items:[{name:"lineBreak",title:"Line Break",icon:"hardbreak",action:()=>this.editor.commands.setHardBreak()},{name:"horizontalRule",title:"Horizontal Rule",icon:"horizontalRule",action:()=>this.editor.commands.setHorizontalRule()},{name:"summaryDelimiter",title:"Summary Break",icon:"summaryDelimiter",action:()=>this.insertSummaryDelimiter()}]},{name:"list",title:"List",icon:"bulletList",type:"dropdown",items:[{name:"bulletList",title:"Bullet List",icon:"bulletList",action:()=>this.editor.commands.toggleBulletList()},{name:"orderedList",title:"Numbered List",icon:"orderedList",action:()=>this.editor.commands.toggleOrderedList()}]},{type:"separator"},{name:"codeBlock",title:"Code Block",icon:"codeBlock",action:()=>this.editor.commands.toggleCodeBlock()},{name:"htmlBlock",title:"Raw Code Embed",icon:"htmlBlock",action:()=>this.insertHtmlBlock()},{name:"shortcodeBlock",title:"Shortcode",icon:"shortcodeBlock",action:()=>this.insertShortcodeBlock()},{type:"separator"},{name:"dragHandle",title:"Toggle Drag Handles",icon:"dragHandle",action:()=>this.toggleDragHandle()},{name:"search",title:"Find & Replace",icon:"search",action:()=>this.showFindReplace()},{name:"typography",title:"Toggle Typography Shortcuts",icon:"typography",action:()=>this.toggleTypography()}],o=document.createElement("div");o.className="toolbar-section toolbar-left",l.forEach(d=>{if(!(d.name==="shortcodeBlock"&&(!window.EditorProPluginStatus||!window.EditorProPluginStatus.shortcodeCore)))if(d.type==="separator"){const h=document.createElement("div");h.className="separator",o.appendChild(h)}else if(d.type==="dropdown"||d.items){const h=this.createDropdown(d);o.appendChild(h)}else{const h=document.createElement("button");h.type="button",h.setAttribute("data-tooltip",d.title),h.innerHTML=this.getIcon(d.icon),h.onmousedown=p=>{p.preventDefault()},h.onclick=p=>{d.action(),this.editor.commands.focus()},h.dataset.toolbarItem=d.name,o.appendChild(h)}});const s=document.createElement("div");s.className="toolbar-section toolbar-right";const r=document.createElement("button");r.type="button",r.setAttribute("data-tooltip","Toggle Markdown Mode"),r.innerHTML=this.getIcon("markdown"),r.dataset.toolbarItem="markdown-toggle",r.onclick=()=>this.toggleMarkdownMode(),s.appendChild(r);const a=document.createElement("button");a.type="button",a.setAttribute("data-tooltip","Toggle Theme"),a.innerHTML=this.getIcon("sun"),a.dataset.toolbarItem="theme-toggle",a.onclick=()=>this.toggleTheme(),s.appendChild(a),t.appendChild(o),t.appendChild(s);const c=document.createElement("div");c.className="editor-pro-toolbar-wrapper",this.textarea.parentNode.insertBefore(c,this.textarea),c.appendChild(t),this.toolbar=t}setupStickyToolbar(){let t=document.querySelector(".editor-pro-toolbar-wrapper");if(t||(t=document.querySelector(".editor-pro-toolbar")),!t)return;let e=document.querySelector('main [role="region"]');e||(e=document.querySelector(".content-wrapper")||document.querySelector(".admin-content")||document.querySelector("main"));const n=(d=>{let h=d.parentElement;for(;h;){const p=window.getComputedStyle(h);if(p.overflow==="auto"||p.overflow==="scroll"||p.overflowY==="auto"||p.overflowY==="scroll")return h;h=h.parentElement}return null})(t);if(n&&(e=n),!e){this.enableCSSSticky(t);return}const l=t.offsetHeight,o=document.createElement("div");o.style.height=l+"px",o.style.display="none",o.className="editor-pro-toolbar-placeholder",t.parentNode.insertBefore(o,t);let s=!1,r=null;const a=()=>{r=null;const d=e.scrollTop,h=e.getBoundingClientRect(),p=s?o.getBoundingClientRect():t.getBoundingClientRect(),u=p.top<=h.top;u&&!s?(s=!0,o.style.display="block",o.style.height=t.offsetHeight+"px",t.style.position="fixed",t.style.top=h.top+"px",t.style.left=p.left+"px",t.style.width=p.width+"px",t.style.zIndex="1001",t.classList.add("is-sticky")):!u&&s&&(s=!1,o.style.display="none",t.style.position="",t.style.top="",t.style.left="",t.style.width="",t.style.zIndex="",t.classList.remove("is-sticky")),s&&(t.style.top=h.top+"px",t.style.left=o.getBoundingClientRect().left+"px",t.style.width=o.getBoundingClientRect().width+"px",this.searchBar&&this.searchBar.classList.contains("active")&&(o.style.height=t.offsetHeight+"px"))},c=()=>{r||(r=requestAnimationFrame(a))};e.addEventListener("scroll",c,{passive:!0}),window.addEventListener("resize",c,{passive:!0}),a(),this.cleanupStickyToolbar=()=>{e.removeEventListener("scroll",c),window.removeEventListener("resize",c),r&&cancelAnimationFrame(r),o.parentNode&&o.remove()}}enableCSSSticky(t){t.style.position="sticky",t.style.top="0",t.style.zIndex="1001";const e=t.closest(".editor-pro-wrapper");e&&(e.style.position="relative")}setupWindowStickyToolbar(t){const e=document.createElement("div");e.style.height=t.offsetHeight+"px",e.style.display="none",t.parentNode.insertBefore(e,t);let i=!1;const n=t.getBoundingClientRect().top+window.scrollY,l=()=>{const s=window.scrollY>n;s&&!i?(i=!0,e.style.display="block",t.style.position="fixed",t.style.top="0",t.style.left=e.getBoundingClientRect().left+"px",t.style.width=e.getBoundingClientRect().width+"px",t.style.zIndex="1001",t.classList.add("is-sticky")):!s&&i&&(i=!1,e.style.display="none",t.style.position="",t.style.top="",t.style.left="",t.style.width="",t.style.zIndex="",t.classList.remove("is-sticky"))};window.addEventListener("scroll",l,{passive:!0}),window.addEventListener("resize",l,{passive:!0}),l()}fixOverflowForSticky(){const t=this.textarea.closest(".editor-pro-wrapper"),e=document.querySelector(".editor-pro-toolbar");if(!t||!e)return;let i=t;const n=[];for(;i&&i!==document.body;){const l=window.getComputedStyle(i);if(l.overflow==="hidden"||l.overflowX==="hidden"||l.overflowY==="hidden"){const o={element:i,overflow:i.style.overflow,overflowX:i.style.overflowX,overflowY:i.style.overflowY};n.push(o),i.style.overflow="visible",i.style.overflowX="visible",i.style.overflowY="visible"}i=i.parentElement}this.fixedOverflowElements=n}addShortcodeButton(){if(!window.EditorProPluginStatus||!window.EditorProPluginStatus.shortcodeCore||this.toolbar.querySelector('[data-toolbar-item="shortcodeBlock"]'))return;const t=this.toolbar.querySelector('[data-toolbar-item="htmlBlock"]');if(!t)return;const e=document.createElement("button");e.type="button",e.setAttribute("data-tooltip","Insert Shortcode"),e.innerHTML=this.getIcon("shortcodeBlock"),e.onclick=()=>this.showShortcodeSelector(),e.dataset.toolbarItem="shortcodeBlock",t.parentNode.insertBefore(e,t.nextSibling)}addGitHubAlertButton(){const t=this.toolbar.querySelector('[data-toolbar-item="githubAlert"]');if(t){const e=this.toolbar.querySelector(".toolbar-left"),i=e==null?void 0:e.querySelector('[data-toolbar-item="shortcodeBlock"]'),n=e==null?void 0:e.querySelector('[data-toolbar-item="htmlBlock"]'),l=i||n;if(l&&e){const o=t.cloneNode(!0);t.remove(),l.parentNode.insertBefore(o,l.nextSibling),o.innerHTML=this.getIcon("githubAlert"),o.setAttribute("data-tooltip","Markdown Alert"),o.onclick=s=>{s.preventDefault(),s.stopPropagation(),this.showGitHubAlertSelector()}}}else{const e=this.toolbar.querySelector(".toolbar-left"),i=e==null?void 0:e.querySelector('[data-toolbar-item="shortcodeBlock"]'),n=e==null?void 0:e.querySelector('[data-toolbar-item="htmlBlock"]'),l=i||n;if(l){const o=document.createElement("button");o.type="button",o.setAttribute("data-tooltip","Markdown Alert"),o.innerHTML=this.getIcon("githubAlert"),o.onclick=s=>{s.preventDefault(),s.stopPropagation(),this.showGitHubAlertSelector()},o.dataset.toolbarItem="githubAlert",l.parentNode.insertBefore(o,l.nextSibling)}}}showGitHubAlertSelector(){document.querySelectorAll('.editor-pro-modal, .github-alert-selector, [class*="github-alert"], [class*="alert-selector"]').forEach(n=>n.remove()),document.querySelectorAll(".modal-backdrop, .modal-overlay").forEach(n=>{const l=n.parentElement;l&&l.querySelector(".alert-type-btn, .alert-types, h3:first-child")&&l.remove()});const i=document.createElement("div");i.className="editor-pro-modal github-alert-selector",i.innerHTML=`
                <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Insert GitHub Alert</h3>
                        <button class="close-button" onclick="this.closest('.editor-pro-modal').remove()">\xD7</button>
                    </div>
                    <div class="modal-body">
                        <p class="modal-description">Choose an alert type to insert into your content.</p>
                        <div class="alert-preview-list">
                            <div class="alert-preview-item" data-type="note">
                                <div class="alert-preview note-alert">
                                    <span class="alert-icon">${this.getIcon("githubAlertNote")}</span>
                                    <div class="alert-content">
                                        <strong>Note</strong>
                                        <p>Useful information that users should know</p>
                                    </div>
                                </div>
                            </div>
                            <div class="alert-preview-item" data-type="tip">
                                <div class="alert-preview tip-alert">
                                    <span class="alert-icon">${this.getIcon("githubAlertTip")}</span>
                                    <div class="alert-content">
                                        <strong>Tip</strong>
                                        <p>Helpful advice for doing things better or more easily</p>
                                    </div>
                                </div>
                            </div>
                            <div class="alert-preview-item" data-type="important">
                                <div class="alert-preview important-alert">
                                    <span class="alert-icon">${this.getIcon("githubAlertImportant")}</span>
                                    <div class="alert-content">
                                        <strong>Important</strong>
                                        <p>Key information users need to know to achieve their goal</p>
                                    </div>
                                </div>
                            </div>
                            <div class="alert-preview-item" data-type="warning">
                                <div class="alert-preview warning-alert">
                                    <span class="alert-icon">${this.getIcon("githubAlertWarning")}</span>
                                    <div class="alert-content">
                                        <strong>Warning</strong>
                                        <p>Urgent info that needs immediate user attention to avoid problems</p>
                                    </div>
                                </div>
                            </div>
                            <div class="alert-preview-item" data-type="caution">
                                <div class="alert-preview caution-alert">
                                    <span class="alert-icon">${this.getIcon("githubAlertCaution")}</span>
                                    <div class="alert-content">
                                        <strong>Caution</strong>
                                        <p>Advises about risks or negative outcomes of certain actions</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn cancel-btn" onclick="this.closest('.editor-pro-modal').remove()">Cancel</button>
                    </div>
                </div>
            `,i.querySelectorAll(".alert-preview-item").forEach(n=>{n.onclick=l=>{l.preventDefault(),l.stopPropagation();const o=n.getAttribute("data-type");return this.insertGitHubAlert(o),i&&i.parentNode&&i.remove(),document.querySelectorAll(".github-alert-selector").forEach(s=>s.remove()),document.querySelectorAll(".editor-pro-modal").forEach(s=>{s.querySelector(".alert-preview-item")&&s.remove()}),document.querySelectorAll(".modal-overlay").forEach(s=>{const r=s.parentElement;r&&r.classList.contains("github-alert-selector")&&r.remove()}),!1}}),document.body.appendChild(i)}insertGitHubAlert(t){if(!this.editor)return;const{from:e,to:i}=this.editor.state.selection,n=this.editor.state.doc.textBetween(e,i," ");if(this.editor.commands.insertGitHubAlert)this.editor.commands.insertGitHubAlert(t,n||"Alert content here...");else{const l=`<div data-github-alert="true" data-alert-type="${t}" class="markdown-alert markdown-alert-${t}"><div class="markdown-alert-content"><p>${n||"Alert content here..."}</p></div></div>`;this.editor.commands.insertContent(l)}setTimeout(()=>{this.editor.focus()},50)}initializeEditor(){window.EditorPro=window.EditorPro||{},window.EditorPro.instances=window.EditorPro.instances||[],window.EditorPro.instances.push(this),window.EditorPro.activeEditor=this,window.EditorPro.editBlock=this.editBlock.bind(this),window.EditorPro.deleteBlock=this.deleteBlock.bind(this),window.EditorPro.editRawBlock=this.editRawBlock.bind(this),window.EditorPro.editGravImage=this.editGravImage.bind(this),window.EditorPro.editShortcodeBlock=this.editShortcodeBlock.bind(this),window.EditorPro.editInlineShortcode=this.editInlineShortcode.bind(this),window.EditorPro.addChildShortcodeBlock=this.addChildShortcodeBlock.bind(this),window.EditorPro.findNext=this.findNext.bind(this),window.EditorPro.replaceNext=this.replaceNext.bind(this),window.EditorPro.replaceAll=this.replaceAll.bind(this),window.EditorPro.updateDocStepNumbers=()=>{document.querySelectorAll('[data-shortcode-name="doc-steps"]').forEach(c=>{c.querySelectorAll('[data-shortcode-name="doc-step"]').forEach((h,p)=>{const u=h.querySelector(".preserved-block-header > span");if(u){const g=u.textContent.replace(/^\(\d+\)\s*/,"");u.textContent=`(${p+1}) ${g}`}})})},window.EditorPro.debugEditorContent=()=>{if(this.editor){const a=this.editor.getHTML(),c=document.createElement("div");return c.innerHTML=a,c.querySelectorAll('div[data-github-alert="true"]').forEach((h,p)=>{}),a}return"Editor not initialized"};const t=this.textarea.parentNode.querySelector(".editor-pro-container");if(!t)return;const{processed:e,blocks:i}=this.preserver.preserveContent(this.textarea.value);this.preservedBlocks=i,this.originalMarkdown=this.textarea.value;const n=[TiptapStarterKit.StarterKit.configure({history:{depth:100},paragraph:!1,document:!1,codeBlock:!1,strike:{HTMLAttributes:{}}}),TiptapCustomCodeBlock.CustomCodeBlock,TiptapUnderline.Underline,TiptapTable.Table.configure({resizable:!0}),TiptapTableRow.TableRow,TiptapTableHeader.TableHeader.extend({content:"paragraph+",addAttributes(){var a;return((a=this.parent)==null?void 0:a.call(this))||{}},onCreate(){this.options.content="paragraph+"}}),TiptapTableCell.TableCell.extend({content:"paragraph+",addAttributes(){var a;return((a=this.parent)==null?void 0:a.call(this))||{}},onCreate(){this.options.content="paragraph+"}})];if(TiptapDragHandle&&TiptapDragHandle.DragHandle){const a=localStorage.getItem("editor-pro-drag-handles");this.dragHandlesVisible=a==="true",n.push(TiptapDragHandle.DragHandle.configure({render:()=>{const c=document.createElement("div");return c.className="drag-handle",c.innerHTML="\u22EE\u22EE",c.style.cursor="move",c},threshold:.5,dragHandleWidth:20}))}if(TiptapCharacterCount&&TiptapCharacterCount.CharacterCount&&n.push(TiptapCharacterCount.CharacterCount.configure({mode:"textSize"})),TiptapTypography&&TiptapTypography.Typography&&this.typographyEnabled&&window.EditorProExtraTypography&&window.EditorProExtraTypography.enabled&&n.push(TiptapTypography.Typography),TiptapExtraTypography&&TiptapExtraTypography.ExtraTypography&&window.EditorProExtraTypography){const a=window.EditorProExtraTypography;if(a.custom&&this.typographyEnabled){const c=Object.entries(a.custom).map(([d,h])=>({pattern:d,replacement:h,enabled:!0}));this.extraTypographyExtension=TiptapExtraTypography.ExtraTypography.configure({transforms:c,enabled:this.typographyEnabled}),n.push(this.extraTypographyExtension)}}typeof TiptapCore!="undefined"&&TiptapCore.Mark&&["abbr","cite","kbd","sup","sub","var","mark","time","samp","dfn","q","small","ins","del","bdi","bdo"].forEach(c=>{if(c==="del"||c==="ins")return;const d=TiptapCore.Mark.create({name:c,parseHTML(){return[{tag:c}]},renderHTML({HTMLAttributes:h}){return[c,h,0]}});n.push(d)});const l=TiptapCore.Node.create({name:"doc",topNode:!0,content:"(paragraph | heading | blockquote | horizontalRule | orderedList | bulletList | codeBlock | table | shortcode | shortcodeBlock | preservedBlock | rawBlock | githubAlert | summaryDelimiter)+"});n.push(l);const o=TiptapCore.Node.create({name:"paragraph",priority:1e3,group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:a}){return["p",a,0]},addCommands(){return{setParagraph:()=>({commands:a})=>a.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}});if(n.push(o),J){const a=TiptapCore.Extension.create({name:"linkShortcut",addKeyboardShortcuts(){return{"Mod-k":()=>(window.EditorPro&&window.EditorPro.activeEditor&&window.EditorPro.activeEditor.insertLink(),!0)}}});n.push(J.configure({openOnClick:!1,autolink:!0,linkOnPaste:!0,HTMLAttributes:{target:"_blank",rel:"noopener noreferrer"}})),n.push(a)}else typeof TiptapLink!="undefined"&&TiptapLink.Link&&n.push(TiptapLink.Link.configure({openOnClick:!1,autolink:!0,linkOnPaste:!0,HTMLAttributes:{target:"_blank",rel:"noopener noreferrer"}}));typeof TiptapImage!="undefined"&&TiptapImage.Image&&n.push(TiptapImage.Image.configure({inline:!0,allowBase64:!0,HTMLAttributes:{class:"editor-image"}}).extend({addAttributes(){var a;return{...(a=this.parent)==null?void 0:a.call(this),"data-src":{default:null},class:{default:null},style:{default:null},loading:{default:null},title:{default:null}}},addCommands(){var a;return{...(a=this.parent)==null?void 0:a.call(this),setImage:c=>({tr:d,dispatch:h})=>{const{selection:p}=d,u=this.type.create(c);return h&&d.replaceRangeWith(p.from,p.to,u),!0}}}})),typeof TiptapMarkdownShortcuts!="undefined"&&TiptapMarkdownShortcuts.MarkdownShortcuts&&n.push(TiptapMarkdownShortcuts.MarkdownShortcuts.configure({enabled:!0})),Q&&n.push(Q),ee&&n.push(ee),W&&n.push(W),te&&n.push(te),Z&&n.push(Z),K&&n.push(K),typeof TiptapGitHubAlert!="undefined"&&TiptapGitHubAlert.GitHubAlert?n.push(TiptapGitHubAlert.GitHubAlert):typeof window.GitHubAlert!="undefined"&&n.push(window.GitHubAlert);const s=document.createElement("div");s.className="editor-pro-table-context-menu",s.style.display="none",s.innerHTML=`
                <div class="table-menu-group">
                    <div class="table-menu-label">Row</div>
                    <button class="table-menu-item" data-action="addRowBefore">
                        <i class="fa fa-arrow-up"></i> Insert Above
                    </button>
                    <button class="table-menu-item" data-action="addRowAfter">
                        <i class="fa fa-arrow-down"></i> Insert Below
                    </button>
                    <button class="table-menu-item" data-action="deleteRow">
                        <i class="fa fa-trash"></i> Delete Row
                    </button>
                </div>
                <div class="table-menu-separator"></div>
                <div class="table-menu-group">
                    <div class="table-menu-label">Column</div>
                    <button class="table-menu-item" data-action="addColumnBefore">
                        <i class="fa fa-arrow-left"></i> Insert Before
                    </button>
                    <button class="table-menu-item" data-action="addColumnAfter">
                        <i class="fa fa-arrow-right"></i> Insert After
                    </button>
                    <button class="table-menu-item" data-action="deleteColumn">
                        <i class="fa fa-trash"></i> Delete Column
                    </button>
                </div>
                <div class="table-menu-separator"></div>
                <button class="table-menu-item danger" data-action="deleteTable">
                    <i class="fa fa-trash"></i> Delete Table
                </button>
            `,document.body.appendChild(s),this.tableContextMenu=s,s.addEventListener("click",a=>{const c=a.target.closest(".table-menu-item");if(c){const d=c.getAttribute("data-action");d&&this[d]&&(this[d](),s.style.display="none")}}),document.addEventListener("click",a=>{s.contains(a.target)||(s.style.display="none")}),this.searchExtension=this.createSearchHighlightExtension(),n.push(this.searchExtension);const r=this.basicMarkdownToHtml(e||"");this.editor=new TiptapCore.Editor({element:t,extensions:n,content:r,onBeforeCreate:({editor:a})=>{},onCreate:({editor:a})=>{this.editorElement=a.view.dom,this.setupInlineShortcodeEventDelegation(),this.applyAllShortcodeCSS(),new MutationObserver(()=>{var h;(h=window.EditorPro)!=null&&h.updateDocStepNumbers&&window.EditorPro.updateDocStepNumbers()}).observe(this.editorElement,{childList:!0,subtree:!0}),setTimeout(()=>{var h;(h=window.EditorPro)!=null&&h.updateDocStepNumbers&&window.EditorPro.updateDocStepNumbers()},100),this.createCodeMirrorCompatibility();const d=a.extensionManager.extensions.find(h=>h.name==="dragHandle");setTimeout(()=>{if(this.dragHandlesVisible){const h=this.textarea.closest(".editor-pro-wrapper");h&&h.classList.add("show-drag-handles");const p=this.toolbar.querySelector('[data-toolbar-item="dragHandle"]');p&&p.classList.add("is-active")}this.normalizeSummaryDelimiterNodes()},100),a.view.dom.addEventListener("contextmenu",h=>{const p=a.view.posAtCoords({left:h.clientX,top:h.clientY});if(!p)return;const u=a.state.doc.resolve(p.pos);let g=!1;for(let m=u.depth;m>0;m--)if(u.node(m).type.name==="table"){g=!0;break}g&&(h.preventDefault(),this.tableContextMenu.style.left=h.clientX+"px",this.tableContextMenu.style.top=h.clientY+"px",this.tableContextMenu.style.display="block",a.commands.setTextSelection(p.pos))})},onUpdate:({editor:a})=>{a.state.doc.descendants((c,d)=>{if(c.type.name==="rawBlock"&&c.attrs.blockId){const h=c.attrs.blockId,p=c.attrs.content||"";this.preservedBlocks.set(h,{type:c.attrs.language||"html",content:p,original:p,isBlock:!0})}}),this.updateTextarea()},onSelectionUpdate:({editor:a})=>{this.updateToolbarState()},editorProps:{attributes:{spellcheck:"true"},handleDrop:(a,c,d,h)=>{const p=c.dataTransfer.getData("text"),u=/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/;if(p&&u.test(p)){c.preventDefault();const g=a.posAtCoords({left:c.clientX,top:c.clientY});if(!g)return!1;const m=p.match(u);if(m){const[w,y,f,k]=m;return this.editor.commands.setTextSelection(g.pos),this.resolveImageUrl(f).then(b=>{const v=new DOMParser().parseFromString(b,"text/html").querySelector("img"),S=v?v.getAttribute("src"):f;this.pathMappings.images||(this.pathMappings.images={}),this.pathMappings.images[f]={resolved:S,original:f,data_src:f,html:b},this.editor.chain().focus().setTextSelection(g.pos).setImage({src:S,alt:y||"","data-src":f,title:k||""}).run(),this.updateTextarea()}).catch(b=>{this.editor.chain().focus().setTextSelection(g.pos).setImage({src:f,alt:y||"","data-src":f,title:k||""}).run(),this.updateTextarea()}),!0}}return!1},handleClickOn:(a,c,d,h,p,u)=>{if(p.target.tagName==="IMG")return p.preventDefault(),this.editImage(p.target),!0;if(p.target.tagName==="A"||p.target.closest("a")){p.preventDefault();const g=p.target.tagName==="A"?p.target:p.target.closest("a");return this.editLink(g),!0}return!1},handleKeyDown:(a,c)=>(c.ctrlKey||c.metaKey)&&c.key==="f"?(c.preventDefault(),this.showFindReplace(),!0):c.key==="Escape"&&this.searchBar&&this.searchBar.classList.contains("active")?(c.preventDefault(),this.hideFindReplace(),!0):!1}})}convertSummaryDelimitersToHtml(t){if(!t||typeof t!="string")return t;const e=this.summaryDelimiterTrimmed;if(!e)return t;const i=this.summaryDelimiter||e,n=t.split(/\r?\n/);let l=!1,o="";return n.map(r=>{const a=r.trim(),c=a.match(/^([`~]{3,})(.*)$/);if(c){const d=c[1];return l?o&&d.startsWith(o[0])&&(l=!1,o=""):(l=!0,o=d),r}if(l)return r;if(a===e){const d=P(i),h=P(this.summaryDelimiterLabel||G);return`
<div data-summary-delimiter="true" data-delimiter="${d}" class="summary-delimiter" role="separator" aria-label="${h}"></div>
`}return r}).join(`
`)}normalizeListIndentation(t){const e=t.split(`
`),i=[],n=/^(\s*)((\d+\.)|[-*+])\s/;for(const l of e){const o=l.match(n);if(o){const s=o[1],r=l.slice(s.length),a=s.length;if(a>0){const c=Math.ceil(a/4),d="    ".repeat(c);i.push(d+r)}else i.push(l)}else i.push(l)}return i.join(`
`)}prepareMarkdownForMarked(t){let e=this.normalizeListIndentation(t);return e=e.replace(/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/g,(i,n,l,o)=>{const s=l.trim(),r=o?` "${o}"`:"";return s.includes(" ")&&!s.startsWith("<")?`![${n}](<${s}>${r})`:i}),e=e.replace(/(?<!\!)\[([^\]]+)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/g,(i,n,l,o)=>{const s=l.trim(),r=o?` "${o}"`:"";return s.includes(" ")&&!s.startsWith("<")?`[${n}](<${s}>${r})`:i}),e}basicMarkdownToHtml(t){if(typeof marked=="undefined")return`<p>${t.replace(/\n/g,"<br>")}</p>`;try{let e=t.replace(/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/g,(o,s,r,a)=>{const c=this.resolveImagePath(r),d=c.resolved.includes(" ")?`<${c.resolved}>`:c.resolved,h=a?` "${a}"`:"";return`![${s}](${d}${h})`});e=e.replace(/(?<!\!)\[([^\]]+)\]\(([^)]+)\)/g,(o,s,r)=>{const a=this.resolveLinkPath(r),c=a.resolved.includes(" ")?`<${a.resolved}>`:a.resolved;return`[${s}](${c})`});let i={};e=e.replace(/\{\{RAW_BLOCK_([\w_]+)\}\}/g,(o,s,r,a)=>{const c=this.preservedBlocks.get(s);if(c&&(c.type==="html"||c.type==="twig")){if(c.isBlock===!1)return`<code class="raw-inline" data-raw-content="${encodeURIComponent(c.content)}">${P(c.content)}</code>`;const d=`<!--RAW_BLOCK_PLACEHOLDER_${s}-->`,h=btoa(unescape(encodeURIComponent(c.content)));i[s]=`<div data-raw-block="true" data-content-base64="${h}" data-language="${c.type}" data-block-id="${s}" class="raw-block-container">${P(c.content)}</div>`;const p=r>0?a.charAt(r-1):"",u=r+o.length<a.length?a.charAt(r+o.length):"";let g="",m="";return p&&p!==`
`&&(g=`

`),u&&u!==`
`&&(m=`

`),g+d+m}return o}),e=e.replace(/\{\{CODE_BLOCK_([\w_]+)\}\}/g,(o,s)=>{const r=this.preservedBlocks.get(s);return r&&(r.type==="code_block"||r.type==="code")&&r.isFenced?r.original:o}),e=e.replace(/\{\{CODE_INLINE_([\w_]+)\}\}/g,(o,s)=>{const r=this.preservedBlocks.get(s);return r&&(r.type==="code_inline"||r.type==="code")&&r.isInline?r.original:o}),e=e.replace(/\[(\{\{SHORTCODE_PLACEHOLDER_[\w_]+\}\}[^\]]*)\]\(([^)]+)\)/g,(o,s,r)=>{const a=`MDLINK_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return this.tempMarkdownLinks||(this.tempMarkdownLinks={}),this.tempMarkdownLinks[a]={linkText:s,url:r},`{{${a}}}`}),e=e.replace(/(\{\{SHORTCODE_PLACEHOLDER_[\w_]+\}\})\n+(\{\{SHORTCODE_PLACEHOLDER_[\w_]+\}\})/g,`$1

$2`);let n={};e=e.replace(/\{\{SHORTCODE_PLACEHOLDER_([\w_]+)\}\}/g,(o,s,r,a)=>{var d,h;const c=this.preservedBlocks.get(s);if(c&&c.type==="shortcode"){const p=`<!--SHORTCODE_PLACEHOLDER_${s}-->`;n[s]=!0;let u=c.isBlock!==!1;if(!this.shortcodeRegistry&&((h=(d=window.EditorPro)==null?void 0:d.pluginSystem)!=null&&h.shortcodeRegistry)&&(this.shortcodeRegistry=window.EditorPro.pluginSystem.shortcodeRegistry),this.shortcodeRegistry){const m=this.shortcodeRegistry.get(c.tagName||c.shortcodeName);m&&(u=m.type==="block")}const g=["section","columns","ui-accordion","ui-accordion-item","column","notice","details","div","figure"];if(this.shortcodeRegistry||(u=g.some(m=>(c.tagName||c.shortcodeName||"").toLowerCase()===m.toLowerCase())),u){const m=r>0?a.charAt(r-1):"",w=r+o.length<a.length?a.charAt(r+o.length):"";let y="",f="";return m&&m!==`
`&&(y=`

`),w&&w!==`
`&&(f=`

`),y+p+f}else if(c.onOwnLine)return`

<div class="inline-on-own-line" data-block-id="${s}">{{SHORTCODE_PLACEHOLDER_${s}}}</div>

`;return o}return o}),e=e.replace(/(<!--SHORTCODE_PLACEHOLDER_[\w_]+-->)\s*\[([^\]]+)\]\(([^)]+)\)/g,(o,s,r,a)=>`${s}<a href="${a}">${r}</a>`),e=this.convertSummaryDelimitersToHtml(e),e=this.prepareMarkdownForMarked(e);let l=marked.parse(e);return l=this.fixSummaryDelimiterBlockquotes(l),this.tempMarkdownLinks&&(l=l.replace(/<(h[1-6]|p)>\{\{(MDLINK_[\w_]+)\}\}<\/\1>|\{\{(MDLINK_[\w_]+)\}\}/g,(o,s,r,a)=>{const c=r||a,d=this.tempMarkdownLinks[c];if(d){const h=this.resolveLinkPath(d.url),p=d.linkText.replace(/<!--SHORTCODE_PLACEHOLDER_([\w_]+)-->/g,"{{SHORTCODE_PLACEHOLDER_$1}}"),u=`<a href="${h.resolved}" data-href="${d.url}">${p}</a>`;return s?`<${s}>${u}</${s}>`:u}return o}),delete this.tempMarkdownLinks),l=l.replace(/<pre><code([^>]*)>([\s\S]*?)<\/code><\/pre>/g,(o,s,r)=>{const a=r.replace(/\n$/,"");return`<pre><code${s}>${a}</code></pre>`}),typeof TiptapMarkdownParser!="undefined"&&TiptapMarkdownParser.MarkdownParser&&(l=new TiptapMarkdownParser.MarkdownParser(this.editor).processAlertHTML(l)),l=l.replace(/<!--RAW_BLOCK_PLACEHOLDER_([\w_]+)-->/g,(o,s)=>i[s]||o),l=l.replace(/<!--SHORTCODE_PLACEHOLDER_([\w_]+)-->/g,(o,s)=>`{{SHORTCODE_PLACEHOLDER_${s}}}`),l=l.replace(/<div class="inline-on-own-line"[^>]*>([^<]+)<\/div>/g,(o,s)=>`<p>${s}</p>`),l=l.replace(/<img([^>]*?)src="([^"]+)"([^>]*?)>/g,(o,s,r,a)=>{var c;for(const[d,h]of Object.entries(((c=this.pathMappings)==null?void 0:c.images)||{}))if(h.resolved===r){if(h.html){const g=new DOMParser().parseFromString(h.html,"text/html").querySelector("img");if(g){const m=o.match(/alt="([^"]*)"/);m&&m[1]&&g.setAttribute("alt",m[1]);const w=o.match(/title="([^"]*)"/);return w&&w[1]&&g.setAttribute("title",w[1]),g.setAttribute("data-src",d),g.outerHTML}}return`<img${s}src="${r}" data-src="${d}"${a}>`}return`<img${s}src="${r}" data-src="${r}"${a}>`}),l=l.replace(/<a([^>]*?)href="([^"]+)"([^>]*?)>(.*?)<\/a>/g,(o,s,r,a,c)=>{var d;for(const[h,p]of Object.entries(((d=this.pathMappings)==null?void 0:d.links)||{}))if(p.resolved===r){if(p.html){const m=new DOMParser().parseFromString(p.html,"text/html").querySelector("a");if(m)return m.innerHTML=c,m.setAttribute("data-href",h),m.outerHTML}return`<a${s}href="${r}" data-href="${h}"${a}>${c}</a>`}return`<a${s}href="${r}" data-href="${r}"${a}>${c}</a>`}),l=l.replace(/\{\{GITHUB_ALERT_([\w_]+)\}\}/g,(o,s)=>{const r=this.preservedBlocks.get(s);if(r&&r.type==="github-alert"){const a=r.alertType,c=this.safeMarkdownParse(r.content);return`<div data-github-alert="true" data-alert-type="${a}" class="markdown-alert markdown-alert-${a}"><div class="markdown-alert-content">${c}</div></div>`}return o}),l=l.replace(/\{\{(PRESERVED_BLOCK_|SHORTCODE_PLACEHOLDER_)([\w_]+)\}\}/g,(o,s,r)=>{var c,d,h,p;const a=this.preservedBlocks.get(r);if(a){if(a.type==="shortcode"&&(!this.shortcodeRegistry&&((d=(c=window.EditorPro)==null?void 0:c.pluginSystem)!=null&&d.shortcodeRegistry)&&(this.shortcodeRegistry=window.EditorPro.pluginSystem.shortcodeRegistry),this.shortcodeRegistry)){const u=this.shortcodeRegistry.get(a.tagName);u&&(a.shortcodeType=u.type||"block",a.isBlock=a.shortcodeType==="block")}if(a.isBlock===!1||a.shortcodeType==="inline"){if(a.type==="grav-image"){const u=this.resolveImagePath(a.imagePath+(a.queryString||"")),g=a.alt||"";return`<img ${`src="${P(u.resolved)}" alt="${P(g)}" data-src="${P(u.original)}"`}>`}else if(a.type==="shortcode"){if(!a.shortcodeConfig&&this.shortcodeRegistry){const u=this.shortcodeRegistry.get(a.tagName);u&&(a.shortcodeConfig=u,a.shortcodeType=u.type||"block",a.isBlock=a.shortcodeType==="block")}if(a.shortcodeType==="inline"){let u="";try{const w=(p=(h=window.EditorPro)==null?void 0:h.pluginSystem)==null?void 0:p.shortcodeRegistry;w&&a.attributes&&(w.ensureInitialized(),u=w.generateCSS(a.tagName,a.attributes))}catch(w){}const g=u?` style="${P(u)}"`:"";return`<span data-preserved-inline="true" data-block-id="${r}" data-block-type="shortcode" data-block-data='${JSON.stringify(a)}' class="preserved-inline shortcode" contenteditable="false" title="${P(a.original)} (click to edit)"${g}>${P(a.original)}</span>`}}return`<span data-preserved-inline="true" data-block-id="${r}" data-block-type="${a.type}" data-block-data='${JSON.stringify(a)}' class="preserved-inline ${a.type}">${P(a.original)}</span>`}if(a.type==="shortcode"&&a.isBlock){const u=a.contentType==="code";let g="";if(u)g="";else if(a.content){let f=a.content;f=f.replace(/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/g,(C,x,v,S)=>{var T,N;const $=(N=(T=this.pathMappings)==null?void 0:T.images)==null?void 0:N[v],M=S?` "${S}"`:"";if($&&$.html){const D=new DOMParser().parseFromString($.html,"text/html").querySelector("img");return D?(x&&D.setAttribute("alt",x),S&&D.setAttribute("title",S),D.outerHTML):$.html}return $&&$.resolved?`![${x}](${$.resolved}${M})`:C}),f=this.processNestedShortcodePlaceholders(f,a,1),f=f.replace(/\{\{CODE_BLOCK_([\w_]+)\}\}/g,(C,x)=>{const v=this.preservedBlocks.get(x);return v&&v.original?v.original:C});const k=[];f=f.replace(/```(\w*)\s*\n([\s\S]*?)```/gm,(C,x,v)=>{const S=k.length;return k.push({language:x.trim(),code:v.replace(/^\n+|\n+$/g,"")}),`<!--FENCED_CODE_${S}-->`});try{g=marked.parse(f)}catch(C){g=`<p>${f}</p>`}const b=C=>{const x=C.language?` data-language="${C.language}"`:"";return`<pre data-code-content="${btoa(unescape(encodeURIComponent(C.code)))}"${x}><code>${C.code.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code></pre>`};k.forEach((C,x)=>{const v=new RegExp(`<p>\\s*<!--FENCED_CODE_${x}-->\\s*</p>`,"g");g=g.replace(v,b(C))}),k.forEach((C,x)=>{g=g.replace(`<!--FENCED_CODE_${x}-->`,b(C))})}const m=this.preserver.normalizeShortcodeParams(a.params||""),w=btoa(unescape(encodeURIComponent(m)));let y=`data-shortcode-block="true" data-shortcode-name="${a.tagName}" data-params-base64="${w}" data-attributes='${JSON.stringify(a.attributes||{})}' data-placeholder-id="${r}" data-content-type="${u?"code":"blocks"}"`;if(u&&a.codeContent){const f=btoa(unescape(encodeURIComponent(a.codeContent)));y+=` data-code-content="${f}"`}return`<div ${y} class="shortcode-block ${a.tagName}">${g}</div>`}else return`<div data-preserved-block="true" data-block-id="${r}" data-block-type="${a.type}" data-block-data='${JSON.stringify(a)}' class="preserved-block ${a.type}"></div>`}return o}),l=l.replace(/<p>\{\{PRESERVED_BLOCK_([\w_]+)\}\}<\/p>/g,(o,s)=>{const r=this.preservedBlocks.get(s);if(r){const a=F(r.type,r);let c=V(r.content||"",r);if(r.type==="shortcode"&&r.isClosing&&r.content&&!r.isInjectionShortcode)try{let h=r.content;h=h.replace(/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/g,(p,u,g,m)=>{const w=this.resolveImagePath(g),y=m?` "${m}"`:"";return`![${u}](${w.resolved}${y})`}),c=this.safeMarkdownParse(h),c=c.replace(/^<p>(.*)<\/p>\s*$/s,"$1"),c=this.processShortcodePlaceholders(c)}catch(h){}const d=r.type==="shortcode"&&r.tagName?` data-shortcode-name="${r.tagName}"`:"";return`<div data-preserved-block="true" data-block-id="${s}" data-block-type="${r.type}"${d} data-block-data='${JSON.stringify(r)}' class="preserved-block ${r.type}">
                            <div class="preserved-block-header">
                                <span>${a}</span>
                                <div class="preserved-block-controls">
                                    <button type="button" onclick="window.EditorPro.editBlock('${s}')">Edit</button>
                                    <button type="button" onclick="window.EditorPro.deleteBlock('${s}')">Delete</button>
                                </div>
                            </div>
                            ${!r.isInjectionShortcode&&r.isClosing?`<div class="preserved-block-content" contenteditable="true" spellcheck="false">${r.type==="shortcode"&&r.isClosing?c:P(c)}</div>`:""}
                        </div>`}return o}),l=l.replace(/<strong>\{\{PRESERVED_BLOCK_([\w_]+)\}\}<\/strong>/g,(o,s)=>{const r=this.preservedBlocks.get(s);if(r){if(r.isBlock===!1){if(r.type==="grav-image"){const h=this.resolveImagePath(r.imagePath+(r.queryString||"")),p=r.alt||"";return`<img src="${P(h.resolved)}" alt="${P(p)}" data-src="${P(h.original)}">`}return`<span data-preserved-inline="true" data-block-id="${s}" data-block-type="${r.type}" class="preserved-inline ${r.type}">${P(r.original)}</span>`}const a=F(r.type,r);let c=V(r.content||"",r);if(r.type==="shortcode"&&r.isClosing&&r.content&&!r.isInjectionShortcode)try{let h=r.content;h=h.replace(/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/g,(p,u,g,m)=>{const w=this.resolveImagePath(g),y=m?` "${m}"`:"";return`![${u}](${w.resolved}${y})`}),c=this.safeMarkdownParse(h),c=c.replace(/^<p>(.*)<\/p>\s*$/s,"$1"),c=this.processShortcodePlaceholders(c)}catch(h){}const d=r.type==="shortcode"&&r.tagName?` data-shortcode-name="${r.tagName}"`:"";return`<div data-preserved-block="true" data-block-id="${s}" data-block-type="${r.type}"${d} data-block-data='${JSON.stringify(r)}' class="preserved-block ${r.type}">
                            <div class="preserved-block-header">
                                <span>${a}</span>
                                <div class="preserved-block-controls">
                                    <button type="button" onclick="window.EditorPro.editBlock('${s}')">Edit</button>
                                    <button type="button" onclick="window.EditorPro.deleteBlock('${s}')">Delete</button>
                                </div>
                            </div>
                            ${!r.isInjectionShortcode&&r.isClosing?`<div class="preserved-block-content" contenteditable="true" spellcheck="false">${r.type==="shortcode"&&r.isClosing?c:P(c)}</div>`:""}
                        </div>`}return o}),l=l.replace(/<p><strong>\{\{PRESERVED_BLOCK_([\w_]+)\}\}<\/strong><\/p>/g,(o,s)=>{const r=this.preservedBlocks.get(s);if(r){const a=F(r.type,r);let c=V(r.content||"",r);if(r.type==="shortcode"&&r.isClosing&&r.content&&!r.isInjectionShortcode)try{let h=r.content;h=h.replace(/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/g,(p,u,g,m)=>{const w=this.resolveImagePath(g),y=m?` "${m}"`:"";return`![${u}](${w.resolved}${y})`}),c=this.safeMarkdownParse(h),c=c.replace(/^<p>(.*)<\/p>\s*$/s,"$1"),c=this.processShortcodePlaceholders(c)}catch(h){}const d=r.type==="shortcode"&&r.tagName?` data-shortcode-name="${r.tagName}"`:"";return`<div data-preserved-block="true" data-block-id="${s}" data-block-type="${r.type}"${d} data-block-data='${JSON.stringify(r)}' class="preserved-block ${r.type}">
                            <div class="preserved-block-header">
                                <span>${a}</span>
                                <div class="preserved-block-controls">
                                    <button type="button" onclick="window.EditorPro.editBlock('${s}')">Edit</button>
                                    <button type="button" onclick="window.EditorPro.deleteBlock('${s}')">Delete</button>
                                </div>
                            </div>
                            ${!r.isInjectionShortcode&&r.isClosing?`<div class="preserved-block-content" contenteditable="true" spellcheck="false">${r.type==="shortcode"&&r.isClosing?c:P(c)}</div>`:""}
                        </div>`}return o}),l=this.processShortcodePlaceholders(l),l=this.cleanBlockWrapping(l),l=this.fixEmptyTableCells(l),l=this.fixSummaryDelimiterBlockquotes(l),l}catch(e){return`<p>${t.replace(/\n/g,"<br>")}</p>`}}processShortcodePlaceholders(t){return t=t.replace(/<p>\s*\{\{SHORTCODE_PLACEHOLDER_([^}]+)\}\}\s*<\/p>/g,(e,i)=>this.processShortcodePlaceholder(i)),t=t.replace(/\{\{SHORTCODE_PLACEHOLDER_([^}]+)\}\}/g,(e,i)=>this.processShortcodePlaceholder(i)),t=t.replace(/\{\{INLINE_SHORTCODE_PLACEHOLDER_([^}]+)\}\}/g,(e,i)=>{var l,o;const n=this.preservedBlocks.get(i);if(n&&n.type==="shortcode"&&(n.shortcodeType==="inline"||n.isBlock===!1)){const s=JSON.stringify(n).replace(/"/g,"&quot;");let r="";try{const c=(o=(l=window.EditorPro)==null?void 0:l.pluginSystem)==null?void 0:o.shortcodeRegistry;c&&n.attributes&&(c.ensureInitialized(),r=c.generateCSS(n.tagName,n.attributes))}catch(c){}const a=r?` style="${P(r)}"`:"";return`<span data-preserved-inline="true" data-block-id="${i}" data-block-type="shortcode" data-block-data="${s}" class="preserved-inline shortcode" contenteditable="false" title="${P(n.original)} (click to edit)"${a}>${P(n.original)}</span>`}return e}),t}safeMarkdownParse(t){if(!t||typeof marked=="undefined")return t||"";let e=t.replace(/<samp>([\s\S]*?)<\/samp>/gi,(o,s)=>"```\n"+s.split(/\s{2}\n|\s{2}$/).join(`
`).replace(/\s+$/,"")+"\n```");const i=[];e=e.replace(/```(\w*)\s*\n([\s\S]*?)```/gm,(o,s,r)=>{const a=i.length;return i.push({language:s.trim(),code:r.replace(/^\n+|\n+$/g,"")}),`<!--FENCED_CODE_${a}-->`});let n;try{n=marked.parse(e)}catch(o){n=`<p>${e}</p>`}const l=o=>{const s=o.language?` data-language="${o.language}"`:"";return`<pre data-code-content="${btoa(unescape(encodeURIComponent(o.code)))}"${s}><code>${o.code.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</code></pre>`};return i.forEach((o,s)=>{const r=new RegExp(`<p>\\s*<!--FENCED_CODE_${s}-->\\s*</p>`,"g");n=n.replace(r,l(o))}),i.forEach((o,s)=>{n=n.replace(`<!--FENCED_CODE_${s}-->`,l(o))}),n}processNestedShortcodePlaceholders(t,e=null,i=0){return i>10?t:t.replace(/\{\{SHORTCODE_PLACEHOLDER_([\w_]+)\}\}/g,(n,l)=>{var m,w;const o=this.preservedBlocks.get(l);if(!o||o.type!=="shortcode")return n;const s=(w=(m=window.EditorPro)==null?void 0:m.pluginSystem)==null?void 0:w.shortcodeRegistry,r=e?s==null?void 0:s.get(e.tagName):null,a=s==null?void 0:s.get(o.tagName),c=r&&r.allowedChildren&&r.allowedChildren.length>0;if(o.shortcodeType==="inline"||o.isBlock===!1)return`{{INLINE_SHORTCODE_PLACEHOLDER_${l}}}`;const d=o.contentType==="code"||(a==null?void 0:a.contentType)==="code";let h="";if(!d&&o.content){let y=this.processNestedShortcodePlaceholders(o.content,o,i+1);y=y.replace(/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/g,(f,k,b,C)=>{const x=this.resolveImagePath(b),v=C?` "${C}"`:"";return`![${k}](${x.resolved}${v})`}),y=y.replace(/(?<!\!)\[([^\]]+)\]\(([^)]+)\)/g,(f,k,b)=>{const C=this.resolveLinkPath(b);return`[${k}](${C.resolved})`}),h=this.safeMarkdownParse(y)}const p=this.preserver.normalizeShortcodeParams(o.params||""),u=btoa(unescape(encodeURIComponent(p)));let g=`data-shortcode-block="true" data-shortcode-name="${o.tagName}" data-params-base64="${u}" data-attributes='${JSON.stringify(o.attributes||{})}' data-placeholder-id="${l}" data-content-type="${d?"code":"blocks"}"`;if(d&&(o.codeContent||o.content)){const y=o.codeContent||o.content,f=btoa(unescape(encodeURIComponent(y)));g+=` data-code-content="${f}"`}return`<div ${g} class="shortcode-block ${o.tagName}">${h}</div>`})}processShortcodePlaceholder(t){const e=this.preservedBlocks.get(t);if(!e||e.type!=="shortcode")return`{{SHORTCODE_PLACEHOLDER_${t}}}`;if(e.isSelfClosing){const s=(e.params||"").replace(/"/g,"&quot;"),r=e.params?btoa(unescape(encodeURIComponent(e.params))):"";return e.shortcodeType==="inline"||e.isBlock===!1?`<span data-shortcode-inline="true" data-shortcode-name="${e.tagName}" data-params="${s}" data-params-base64="${r}" data-attributes='${JSON.stringify(e.attributes||{})}' data-placeholder-id="${t}" class="shortcode-inline ${e.tagName}">[${e.tagName}${e.params?" "+e.params:""} /]</span>`:`<div data-shortcode-block="true" data-shortcode-name="${e.tagName}" data-params="${s}" data-params-base64="${r}" data-attributes='${JSON.stringify(e.attributes||{})}' data-placeholder-id="${t}" class="shortcode-block ${e.tagName}"></div>`}let i=e.content;const n=/\{\{SHORTCODE_PLACEHOLDER_[^}]+\}\}/.test(i);if(typeof marked!="undefined"&&i)try{if(n){const s=[];let r=0;const a=/\{\{SHORTCODE_PLACEHOLDER_([^}]+)\}\}/g;let c;for(;(c=a.exec(i))!==null;){if(c.index>r){const d=i.substring(r,c.index);if(d.trim()){let h=d;h=h.replace(/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/g,(p,u,g,m)=>{const w=this.resolveImagePath(g),y=m?` "${m}"`:"";return`![${u}](${w.resolved}${y})`}),h=h.replace(/(?<!\!)\[([^\]]+)\]\(([^)]+)\)/g,(p,u,g)=>{const m=this.resolveLinkPath(g);return`[${u}](${m.resolved})`}),h=this.safeMarkdownParse(h),s.push(h)}}s.push(c[0]),r=c.index+c[0].length}if(r<i.length){const d=i.substring(r);if(d.trim()){let h=d;h=h.replace(/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/g,(p,u,g,m)=>{const w=this.resolveImagePath(g),y=m?` "${m}"`:"";return`![${u}](${w.resolved}${y})`}),h=h.replace(/(?<!\!)\[([^\]]+)\]\(([^)]+)\)/g,(p,u,g)=>{const m=this.resolveLinkPath(g);return`[${u}](${m.resolved})`}),h=this.safeMarkdownParse(h),s.push(h)}}i=s.join(""),i=this.processShortcodePlaceholders(i)}else i=i.replace(/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/g,(s,r,a,c)=>{const d=this.resolveImagePath(a),h=c?` "${c}"`:"";return`![${r}](${d.resolved}${h})`}),i=i.replace(/(?<!\!)\[([^\]]+)\]\(([^)]+)\)/g,(s,r,a)=>{const c=this.resolveLinkPath(a);return`[${r}](${c.resolved})`}),i=this.safeMarkdownParse(i);i=i.replace(/<img([^>]*?)src="([^"]+)"([^>]*?)>/g,(s,r,a,c)=>{var d;for(const[h,p]of Object.entries(((d=this.pathMappings)==null?void 0:d.images)||{}))if(p.resolved===a)return`<img${r}src="${a}" data-src="${h}"${c}>`;return`<img${r}src="${a}" data-src="${a}"${c}>`}),i=this.removeUnnecessaryParagraphs(i)}catch(s){}const l=e.params.replace(/"/g,"&quot;"),o={};if(e.params){const s=/([\w-]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s]+))/g;let r;for(;(r=s.exec(e.params))!==null;){const a=r[2]!==void 0?r[2]:r[3]!==void 0?r[3]:r[4];o[r[1]]=a}}return`<div data-shortcode-block="true" data-shortcode-name="${e.tagName}" data-params="${l}" data-attributes='${JSON.stringify(o)}' data-placeholder-id="${t}" class="shortcode-block ${e.tagName}">${i}</div>`}fixSummaryDelimiterBlockquotes(t){if(!t||typeof t!="string")return t;try{const i=new DOMParser().parseFromString(t,"text/html");return Array.from(i.querySelectorAll("blockquote div[data-summary-delimiter]")).forEach(l=>{const o=l.closest("blockquote");if(!o||!o.parentNode)return;const s=o.parentNode,r=[];let a=l;for(;a;){const d=a.nextSibling;r.push(a),a=d}r.forEach(d=>{s.insertBefore(d,o.nextSibling)}),Array.from(o.childNodes).some(d=>d.nodeType===Node.ELEMENT_NODE||d.nodeType===Node.TEXT_NODE&&d.textContent.trim().length>0)||s.removeChild(o)}),i.body.innerHTML}catch(e){return t}}cleanBlockWrapping(t){const e=["div[data-shortcode-block]","div[data-github-alert]","div[data-raw-block]","div[data-preserved-block]","div[data-summary-delimiter]","div[data-shortcode]","div.shortcode-block","div.markdown-alert","div.raw-block","div.preserved-block","div.summary-delimiter"],n=new DOMParser().parseFromString(t,"text/html");return n.querySelectorAll("p").forEach(o=>{const s=Array.from(o.childNodes).filter(r=>r.nodeType===Node.TEXT_NODE?r.textContent.trim().length>0:!0);if(s.length===1&&s[0].nodeType===Node.ELEMENT_NODE){const r=s[0];e.some(c=>{try{return r.matches(c)}catch(d){return!1}})&&o.parentNode.replaceChild(r,o)}}),n.body.innerHTML}markdownToEditor(t){return this.basicMarkdownToHtml(t)}updateTextarea(){this.isUpdatingTextarea=!0;const t=this.editor.getHTML(),e=(t.match(/data-preserved-inline="true"/g)||[]).length,i=this.editorToMarkdown(),n=this.preserver.restoreContent(i,this.preservedBlocks),l=[/\[mark[^\]]*\][^\[]*\[\/mark\]/g,/\[highlight[^\]]*\][^\[]*\[\/highlight\]/g,/\[span[^\]]*\][^\[]*\[\/span\]/g,/\[kbd[^\]]*\][^\[]*\[\/kbd\]/g,/\[code[^\]]*\][^\[]*\[\/code\]/g,/\[em[^\]]*\][^\[]*\[\/em\]/g,/\[strong[^\]]*\][^\[]*\[\/strong\]/g,/\[del[^\]]*\][^\[]*\[\/del\]/g,/\[ins[^\]]*\][^\[]*\[\/ins\]/g,/\[sub[^\]]*\][^\[]*\[\/sub\]/g,/\[sup[^\]]*\][^\[]*\[\/sup\]/g];let o=0;l.forEach(s=>{const r=n.match(s)||[];o+=r.length,r.length>0}),n.includes("[mark")||n.includes("[section"),this.textarea.value=n,this.lastTextareaValue=n;try{const{processed:s,blocks:r}=this.preserver.preserveContent(n),a=new Map(this.preservedBlocks);r.forEach((p,u)=>{a.set(u,p)});const c=/data-block-id="([^"]+)"/g;let d;const h=new Set;for(;(d=c.exec(t))!==null;){const p=d[1];if(h.add(p),!r.has(p)&&this.preservedBlocks.has(p))a.set(p,this.preservedBlocks.get(p));else if(!r.has(p)&&!this.preservedBlocks.has(p)){const u=document.querySelector(`[data-block-id="${p}"]`);if(u){const g=u.getAttribute("data-block-data");if(g)try{const m=JSON.parse(g);a.set(p,m)}catch(m){}}}}this.preservedBlocks=a,this.originalMarkdown=n}catch(s){}this.textarea.dispatchEvent(new Event("input",{bubbles:!0})),this.isUpdatingTextarea=!1}editorToMarkdown(){let t=this.editor.getHTML();t=this.cleanupTrailingBreakParagraphs(t);const e=document.createElement("div");e.innerHTML=t;const i=Array.from(e.querySelectorAll('span[data-preserved-inline="true"], span[data-shortcode-inline="true"]')),n=[];return i.forEach((o,s)=>{var d,h,p;const r=o.getAttribute("data-block-data"),a=o.getAttribute("data-block-id")||o.getAttribute("data-placeholder-id");let c="";if(r)try{c=JSON.parse(r).original||""}catch(u){}if(!c&&a){const u=(d=this.preservedBlocks)==null?void 0:d.get(a);u&&u.original&&(c=u.original)}if(!c&&a){const u=(p=(h=this.preserver)==null?void 0:h.blockMap)==null?void 0:p.get(a);u&&u.original&&(c=u.original)}if(c)n.push({span:o,text:c});else if(o.hasAttribute("data-shortcode-inline")){const u=o.getAttribute("data-shortcode-name"),g=o.getAttribute("data-params-base64"),m=o.getAttribute("data-params"),w=o.getAttribute("data-attributes"),y=o.getAttribute("data-content")||"";let f="",k="";if(g)try{k=decodeURIComponent(escape(atob(g)))}catch(b){k=m||""}else k=m||"";if(!k&&w)try{const b=JSON.parse(w),C=[];for(const[x,v]of Object.entries(b))v!=null&&v!==""&&C.push(`${x}="${v}"`);k=C.join(" ")}catch(b){}if(u)y?f=`[${u}${k?` ${k}`:""}]${y}[/${u}]`:f=`[${u}${k?` ${k}`:""} /]`,n.push({span:o,text:f});else{const b=o.textContent||"";n.push({span:o,text:b})}}else{const u=o.textContent||"";n.push({span:o,text:u})}}),n.reverse().forEach(({span:o,text:s})=>{const r=document.createTextNode(s);o.parentNode.replaceChild(r,o)}),e.querySelectorAll('div[data-shortcode-block="true"]').forEach(o=>{const s=o.getAttribute("data-shortcode-name"),r=o.getAttribute("data-attributes")||"{}",a=o.getAttribute("data-placeholder-id");let c={};try{c=JSON.parse(r)}catch(v){c={}}const d=Array.from(o.querySelectorAll('span[data-preserved-inline="true"], span[data-shortcode-inline="true"]'));d.length>0;const h=[];d.forEach(v=>{var N;const S=v.getAttribute("data-block-data"),$=v.getAttribute("data-block-id")||v.getAttribute("data-placeholder-id"),M=v.getAttribute("data-block-type")||"shortcode";let T="";if(S)try{T=JSON.parse(S).original||""}catch(B){}if(!T&&$){const B=(N=this.preservedBlocks)==null?void 0:N.get($);B&&B.original&&(T=B.original)}if(!T){const B=v.getAttribute("title");B&&B.includes("[")&&B.includes("]")&&(T=B.replace("(click to edit)","").trim())}if(!T&&M==="shortcode"){const B=v.textContent||"";if(B.includes("[")&&B.includes("]")&&B.includes("[/"))T=B;else{const z=v.className||"";z.includes("highlight")?T=`[highlight]${B}[/highlight]`:z.includes("mark")?T=`[mark]${B}[/mark]`:T=B}}T&&h.push({span:v,text:T})}),h.reverse().forEach(({span:v,text:S})=>{const $=document.createTextNode(S);v.parentNode.replaceChild($,v)});const p=o.getAttribute("data-content-type")||"blocks";let u;if(p==="code"){const v=o.getAttribute("data-code-content");if(v)try{u=decodeURIComponent(escape(atob(v)))}catch(S){u=""}else u=""}else u=this.htmlToMarkdown(o.innerHTML);const g=/\[(mark|highlight|span|kbd|code|em|strong|del|ins|sub|sup)[^\]]*\][^\[]*\[\/\1\]/.test(u);let m="";const w=o.getAttribute("data-params-base64");if(w)try{m=decodeURIComponent(escape(atob(w)))}catch(v){m=o.getAttribute("data-params")||""}else m=o.getAttribute("data-params")||"";if(m&&!w&&(m=m.replace(/&quot;/g,'"')),!m)if(c&&Object.keys(c).length>0){const v=[];for(const[S,$]of Object.entries(c))$&&($.includes(" ")||$.includes('"')||$.includes("'"))?v.push(`${S}="${$.replace(/"/g,'\\"')}"`):$===""||$===null||$===void 0?v.push(`${S}=""`):v.push(`${S}=${$}`);m=v.join(" ")}else m="";let y=!0;if(window.EditorPro&&window.EditorPro.getShortcodeRegistry){const v=window.EditorPro.getShortcodeRegistry();if(v){const S=v.get(s);S&&(y=S.type==="block")}}const f=["mark","highlight","span","kbd","code","em","strong","del","ins","sub","sup"],k=["section","columns","ui-accordion","ui-accordion-item","column","notice","details","div","figure","ui-tabs","ui-tab"];f.includes(s.toLowerCase())?y=!1:k.includes(s.toLowerCase())?y=!0:(!window.EditorPro||!window.EditorPro.getShortcodeRegistry)&&(y=k.some(v=>s.toLowerCase()===v.toLowerCase()));let b=!1;if(a&&this.preservedBlocks&&this.preservedBlocks.has(a)&&(b=this.preservedBlocks.get(a).isSelfClosing||!1),!b&&window.EditorPro&&window.EditorPro.getShortcodeRegistry){const v=window.EditorPro.getShortcodeRegistry();if(v){const S=v.get(s);S&&S.hasContent===!1&&(b=!0)}}let C;if(b)y?C=`[${s}${m?` ${m}`:""} /]
`:C=`[${s}${m?` ${m}`:""} /]`;else if(y&&u.trim()){const v=u.trim();C=`[${s}${m?` ${m}`:""}]
${v}
[/${s}]
`}else y?C=`[${s}${m?` ${m}`:""}][/${s}]
`:u.trim()?C=`[${s}${m?` ${m}`:""}]${u.trim()}[/${s}]`:C=`[${s}${m?` ${m}`:""}][/${s}]`;if(a&&this.preservedBlocks){const v=this.preservedBlocks.get(a)||{},S=m?m.trim():"",$=b?"":u.trim(),M={...v,type:"shortcode",tagName:s,shortcodeName:s,shortcodeType:y?"block":"inline",params:S,attributes:c,content:$,original:C.trim(),isSelfClosing:b,isClosing:!b,isBlock:y};this.preservedBlocks.set(a,M)}const x=document.createTextNode(C);o.parentNode.replaceChild(x,o)}),e.querySelectorAll("div[data-shortcode]").forEach(o=>{const s=o.getAttribute("data-shortcode"),r=o.getAttribute("data-params")||"",a=this.htmlToMarkdown(o.innerHTML),c=r.replace(/&quot;/g,'"');let d=!0;if(window.EditorPro&&window.EditorPro.getShortcodeRegistry){const m=window.EditorPro.getShortcodeRegistry();if(m){const w=m.get(s);w&&(d=w.type==="block")}}const h=["mark","highlight","span","kbd","code","em","strong","del","ins","sub","sup"],p=["section","columns","ui-accordion","ui-accordion-item","column","notice","details","div","figure","ui-tabs","ui-tab"];h.includes(s.toLowerCase())?d=!1:p.includes(s.toLowerCase())?d=!0:(!window.EditorPro||!window.EditorPro.getShortcodeRegistry)&&(d=p.some(m=>s.toLowerCase()===m.toLowerCase()));let u;if(d&&a.trim()){const m=a.trim();u=`[${s}${c?` ${c}`:""}]
${m}
[/${s}]`}else a.trim()?u=`[${s}${c?` ${c}`:""}]${a.trim()}[/${s}]`:u=`[${s}${c?` ${c}`:""}][/${s}]`;const g=document.createTextNode(u);o.parentNode.replaceChild(g,o)}),e.querySelectorAll('div[data-raw-block="true"]').forEach(o=>{const s=o.getAttribute("data-block-id"),r=o.getAttribute("data-language")||"html";let a="";if(this.editor&&s){let d=null,h=!1;this.editor.state.doc.descendants((p,u)=>{if(p.type.name==="rawBlock"&&p.attrs.blockId===s)return d=p.attrs.content||p.textContent||p.text,h=!0,!1}),h&&d&&(a=d)}if(!a){const d=o.getAttribute("data-content-base64");if(d)try{a=decodeURIComponent(escape(atob(d)))}catch(h){const p=o.querySelector(".cm-content"),u=o.querySelector("pre.raw-block-content, .raw-block-editor");p?a=p.textContent||"":u?a=u.textContent||"":a=o.textContent||""}else{const h=o.querySelector(".cm-content"),p=o.querySelector("pre.raw-block-content, .raw-block-editor");h?a=h.textContent||"":p?a=p.textContent||"":a=o.textContent||""}}this.preservedBlocks.set(s,{type:r,content:a,original:a,isBlock:!0});const c=document.createTextNode(`{{RAW_BLOCK_${s}}}`);o.parentNode.replaceChild(c,o)}),e.querySelectorAll("code.raw-inline[data-raw-content]").forEach(o=>{let s="";try{s=decodeURIComponent(o.getAttribute("data-raw-content")||"")}catch(a){s=o.textContent||""}const r=document.createTextNode(s);o.parentNode.replaceChild(r,o)}),e.querySelectorAll('div[data-preserved-block="true"]').forEach(o=>{const s=o.getAttribute("data-block-id"),r=document.createTextNode(`{{PRESERVED_BLOCK_${s}}}`);o.parentNode.replaceChild(r,o)}),e.querySelectorAll('div[data-github-alert="true"]').forEach(o=>{const s=o.getAttribute("data-alert-type")||"note",r=o.querySelector(".markdown-alert-content");if(r){const c=this.htmlToMarkdown(r.innerHTML).trim().split(`
`),d=`> [!${s.toUpperCase()}]
${c.map(p=>`> ${p}`).join(`
`)}`,h=document.createTextNode(d+`

`);o.parentNode.replaceChild(h,o)}}),t=e.innerHTML,this.htmlToMarkdown(t)}normalizeInlineFormatting(t){const e=["em","i","strong","b","s","strike","u"];for(const i of e){let n=!0;for(;n;){n=!1;const l=Array.from(t.getElementsByTagName(i));for(const o of l){const s=o.nextSibling;if(!s||s.nodeType!==Node.ELEMENT_NODE)continue;const r=s.tagName.toLowerCase();if(!e.includes(r)||r===i)continue;const a=s.querySelector(i);if(!a)continue;const c=s.nextSibling;if(!(!c||c.nodeType!==Node.ELEMENT_NODE)&&c.tagName.toLowerCase()===i){for(;a.firstChild;)a.parentNode.insertBefore(a.firstChild,a);for(a.parentNode.removeChild(a),o.appendChild(s);c.firstChild;)o.appendChild(c.firstChild);c.parentNode.removeChild(c),n=!0;break}}}}for(const i of e){let n=!0;for(;n;){n=!1;const l=Array.from(t.getElementsByTagName(i));for(const o of l){const s=o.nextSibling;if(s&&s.nodeType===Node.ELEMENT_NODE&&s.tagName.toLowerCase()===i){for(;s.firstChild;)o.appendChild(s.firstChild);s.parentNode.removeChild(s),n=!0;break}}}}}htmlToMarkdown(t){const e=document.createElement("div");e.innerHTML=t,console.log("htmlToMarkdown input:",e.innerHTML),this.normalizeInlineFormatting(e);const i=(l,o={inList:!1,listDepth:0})=>{var a,c,d;if(l.nodeType===Node.TEXT_NODE){let h=l.textContent;return this.preservedBlocks&&h.includes("{{")&&(h=this.preserver.restoreContent(h,this.preservedBlocks)),h}if(l.nodeType!==Node.ELEMENT_NODE)return"";const s=l.tagName.toLowerCase(),r=Array.from(l.childNodes).map(h=>i(h,o)).join("");switch(s){case"div":if(l.getAttribute("data-summary-delimiter")==="true"){const A=l.getAttribute("data-delimiter"),L=this.summaryDelimiter||this.summaryDelimiterTrimmed||"===";return`${A&&A.length?A:L}

`}if(l.getAttribute("data-preserved-block")==="true"){const A=l.getAttribute("data-block-id"),L=l.getAttribute("data-block-type");if(A&&this.preservedBlocks){const I=this.preservedBlocks.get(A);if(I&&I.original)return I.original+`
`}const H=l.getAttribute("data-block-data");if(H)try{const I=JSON.parse(H);if(I.original)return I.original+`
`}catch(I){}}if(l.getAttribute("data-raw-block")==="true"){const A=l.getAttribute("data-block-id");if(A&&this.preservedBlocks){const L=this.preservedBlocks.get(A);if(L&&L.original)return L.original+`

`}return`{{RAW_BLOCK_${A}}}

`}if(l.getAttribute("data-github-alert")==="true"){const A=l.getAttribute("data-alert-type"),L=l.querySelector(".markdown-alert-content");if(L){let H=Array.from(L.childNodes).map(i).join("").trim();this.preservedBlocks&&(H=this.preserver.restoreContent(H,this.preservedBlocks));const R=H.split(`
`).map(_=>_.trim()?`${_}`:"").filter(_=>_!==""),j=`> [!${A.toUpperCase()}]`,O=R.map(_=>`> ${_}`).join(`
`);return`${j}
${O}

`}}if(l.getAttribute("data-shortcode-block")==="true"){const A=l.getAttribute("data-placeholder-id");if(A&&this.preservedBlocks&&this.preservedBlocks.has(A))return`{{SHORTCODE_PLACEHOLDER_${A}}}`;const L=l.getAttribute("data-shortcode-name"),H=l.getAttribute("data-params-base64");let I="";if(H)try{I=decodeURIComponent(escape(atob(H)))}catch(q){}else I=l.getAttribute("data-params")||"";let R="";Array.from(l.childNodes).forEach((q,se)=>{const U=i(q);if(U)if(q.nodeType===Node.ELEMENT_NODE){const ye=q.tagName.toLowerCase();["p","h1","h2","h3","h4","h5","h6","div","blockquote","ul","ol","pre"].includes(ye)?(R&&!R.endsWith(`

`)&&(R+=`
`,R.endsWith(`

`)||(R+=`
`)),R+=U,U.endsWith(`
`)||(R+=`
`)):R+=U}else R+=U});let O=!0;if(window.EditorPro&&window.EditorPro.getShortcodeRegistry){const q=window.EditorPro.getShortcodeRegistry();if(q){const se=q.get(L);se&&(O=se.type==="block")}}const _=["section","columns","ui-accordion","ui-accordion-item","column","notice","details","div","figure"];if((!window.EditorPro||!window.EditorPro.getShortcodeRegistry)&&(O=_.some(q=>L.toLowerCase()===q.toLowerCase())),R=R.replace(/\n+$/,`
`),O)if(R.trim()){const q=R.trim();return`[${L}${I?` ${I}`:""}]
${q}
[/${L}]
`}else return`[${L}${I?` ${I}`:""}][/${L}]
`;else return R.trim()?`[${L}${I?` ${I}`:""}]${R.trim()}[/${L}]`:`[${L}${I?` ${I}`:""}][/${L}]`}return this.preservedBlocks&&r.includes("{{")?this.preserver.restoreContent(r,this.preservedBlocks):r;case"img":const h=l.getAttribute("src")||"",p=l.getAttribute("alt")||"",u=l.getAttribute("title")||"",g=l.getAttribute("data-src"),m=u?` "${u}"`:"";if(g)return`![${p}](${g}${m})`;for(const[A,L]of Object.entries(((a=this.pathMappings)==null?void 0:a.images)||{}))if(L.resolved===h)return`![${p}](${A}${m})`;return`![${p}](${h}${m})`;case"a":const w=l.getAttribute("href")||"",y=l.getAttribute("data-href"),f=r;if(!w)return f;if(y)return`[${f}](${y})`;for(const[A,L]of Object.entries(((c=this.pathMappings)==null?void 0:c.links)||{}))if(L.resolved===w)return`[${f}](${A})`;return`[${f}](${w})`;case"strong":case"b":return`**${r}**`;case"em":case"i":return`_${r}_`;case"s":case"strike":return`~~${r}~~`;case"u":return`<u>${r}</u>`;case"abbr":const k=l.getAttribute("title");return k?`<abbr title="${k}">${r}</abbr>`:`<abbr>${r}</abbr>`;case"cite":return`<cite>${r}</cite>`;case"kbd":return`<kbd>${r}</kbd>`;case"sup":return`<sup>${r}</sup>`;case"sub":return`<sub>${r}</sub>`;case"var":return`<var>${r}</var>`;case"mark":return`<mark>${r}</mark>`;case"time":const b=l.getAttribute("datetime");return b?`<time datetime="${b}">${r}</time>`:`<time>${r}</time>`;case"samp":return`<samp>${r}</samp>`;case"dfn":return`<dfn>${r}</dfn>`;case"q":const C=l.getAttribute("cite");return C?`<q cite="${C}">${r}</q>`:`<q>${r}</q>`;case"small":return`<small>${r}</small>`;case"ins":const x=l.getAttribute("datetime"),v=l.getAttribute("cite");let S="<ins";return x&&(S+=` datetime="${x}"`),v&&(S+=` cite="${v}"`),S+=`>${r}</ins>`,S;case"del":const $=l.getAttribute("datetime"),M=l.getAttribute("cite");let T="<del";return $&&(T+=` datetime="${$}"`),M&&(T+=` cite="${M}"`),T+=`>${r}</del>`,T;case"code":return`\`${r.replace(/`/g,"\\`")}\``;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":const N=parseInt(s.charAt(1));return`${"#".repeat(N)} ${r}

`;case"p":return r.trim()?o.inList?r:`${r}

`:"";case"br":return`  
`;case"ul":case"ol":const B=o.listDepth||0,z="    ".repeat(B),D=Array.from(l.children).filter(A=>A.tagName==="LI").map((A,L)=>{const H=s==="ul"?"- ":`${L+1}. `;let I="",R="";Array.from(A.childNodes).forEach(O=>{if(O.nodeType===Node.ELEMENT_NODE){const _=O.tagName.toLowerCase();_==="ul"||_==="ol"?R+=i(O,{inList:!0,listDepth:B+1}):I+=i(O,{inList:!0,listDepth:B})}else I+=i(O,{inList:!0,listDepth:B})});let j=z+H+I.trim();return R&&(j+=`
`+R.replace(/^\n+/,"").trimEnd()),j}).join(`
`);return B===0?D+`

`:D;case"li":return"";case"blockquote":const re=r.trim().match(/^\[!(NOTE|TIP|IMPORTANT|WARNING|CAUTION)\]\s*(.*)/s);if(re){const A=re[1],L=re[2]||"",H=`> [!${A}]`;if(L.trim()){const R=L.trim().split(`
`).map(j=>j.trim()?`> ${j.trim()}`:">").join(`
`);return`${H}
${R}

`}else return`${H}

`}return`${r.trim().split(`
`).map(A=>`> ${A}`).join(`
`)}

`;case"pre":const oe=l.querySelector("code");if(oe){const A=((d=oe.className.match(/language-(\w+)/))==null?void 0:d[1])||"",L=oe.textContent.replace(/\n$/,"");return`\`\`\`${A}
${L}
\`\`\`

`}return`\`\`\`
${r.replace(/\n$/,"")}
\`\`\`

`;case"hr":return`---

`;case"table":const ne=Array.from(l.querySelectorAll("tr"));if(ne.length===0)return"";let Y="",ae=!1;return ne.forEach((A,L)=>{const H=Array.from(A.querySelectorAll("td, th")),I=H.map(R=>Array.from(R.childNodes).map(i).join("").trim().replace(/\n+/g,"<br>").replace(/\|/g,"\\|"));if(Y+="| "+I.join(" | ")+` |
`,L===0&&A.querySelector("th")){ae=!0;const R=H.map(()=>"---").join(" | ");Y+="| "+R+` |
`}else if(L===0&&!ae){const R=H.map(()=>"---").join(" | ");Y+="| "+R+` |
`}}),Y+`
`;case"thead":case"tbody":case"tr":case"td":case"th":return"";case"span":if(l.getAttribute("data-preserved-inline")==="true"){const A=l.getAttribute("data-block-data");if(A)try{return JSON.parse(A).original||r}catch(L){return r}}return r;default:return r}};let n=Array.from(e.childNodes).map(i).join("");return n=n.replace(/(> \[!(?:NOTE|TIP|IMPORTANT|WARNING|CAUTION)\][^\n]*(?:\n> [^\n]*)*)\n+(> \[!)/g,`$1

$2`).replace(/\n{3,}/g,`

`).replace(/^\n+|\n+$/g,"").trim(),n}updateCharacterCount(){if(!this.editor||!this.characterCountDisplay)return;const t=this.editor.storage.characterCount;if(t){const e=t.characters(),i=t.words(),n=this.characterCountDisplay.querySelector(".count-chars"),l=this.characterCountDisplay.querySelector(".count-words");n&&(n.textContent=e),l&&(l.textContent=i)}}updateToolbarState(){this.toolbar.querySelectorAll("button[data-toolbar-item]").forEach(e=>{const i=e.dataset.toolbarItem;switch(i!=="dragHandle"&&e.classList.remove("is-active"),i){case"bold":this.editor.isActive("bold")&&e.classList.add("is-active");break;case"italic":this.editor.isActive("italic")&&e.classList.add("is-active");break;case"underline":this.editor.isActive("underline")&&e.classList.add("is-active");break;case"strikethrough":this.editor.isActive("strike")&&e.classList.add("is-active");break;case"heading":this.editor.isActive("heading")&&e.classList.add("is-active");break;case"blockquote":this.editor.isActive("blockquote")&&e.classList.add("is-active");break;case"bulletList":this.editor.isActive("bulletList")&&e.classList.add("is-active");break;case"orderedList":this.editor.isActive("orderedList")&&e.classList.add("is-active");break;case"codeBlock":this.editor.isActive("codeBlock")&&e.classList.add("is-active");break;case"link":this.editor.isActive("link")&&e.classList.add("is-active");break;case"theme-toggle":const n=document.documentElement.classList.contains("dark-theme");e.innerHTML=this.getIcon(n?"moon":"sun");break}})}toggleTheme(){const t=document.documentElement;t.classList.contains("dark-theme")?(t.classList.remove("dark-theme"),localStorage.setItem("editor-pro-theme","light")):(t.classList.add("dark-theme"),localStorage.setItem("editor-pro-theme","dark")),this.updateToolbarState()}initializeTheme(){const t=localStorage.getItem("editor-pro-theme"),e=window.matchMedia("(prefers-color-scheme: dark)").matches;(t==="dark"||!t&&e)&&document.documentElement.classList.add("dark-theme")}setupEventListeners(){const t=this.textarea.closest("form");t&&t.addEventListener("submit",()=>{this.updateTextarea()}),document.addEventListener("keydown",n=>{if(!(!this.editor||!this.editor.view.hasFocus())&&(n.metaKey||n.ctrlKey)&&n.key==="s"){n.preventDefault(),this.updateTextarea();const l=document.querySelector('button[name="task"][value="save"], button[type="submit"]');if(l)l.click();else if(t){const o=new Event("submit",{cancelable:!0});t.dispatchEvent(o)}}}),this.lastTextareaValue=this.textarea.value;const e=n=>{var o,s;const l=this.textarea.value;if(l!==this.lastTextareaValue&&!this.isUpdatingTextarea){const r=l.includes(this.lastTextareaValue),a=/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/;if(r&&a.test(l)){const p=[];let u;const g=new RegExp(a,"g");for(;(u=g.exec(l))!==null;){const[f,k,b,C]=u;(s=(o=this.pathMappings)==null?void 0:o.images)!=null&&s[b]||p.push({src:b,alt:k,title:C})}if(p.length>0){Promise.all(p.map(f=>this.resolveImageUrl(f.src).then(k=>{const x=new DOMParser().parseFromString(k,"text/html").querySelector("img"),v=x?x.getAttribute("src"):f.src;return this.pathMappings.images||(this.pathMappings.images={}),this.pathMappings.images[f.src]={resolved:v,original:f.src,data_src:f.src,html:k},{src:f.src,resolved:v}}).catch(k=>({src:f.src,resolved:f.src})))).then(()=>{const{processed:f,blocks:k}=this.preserver.preserveContent(l);this.preservedBlocks=k;const b=this.basicMarkdownToHtml(f);this.editor.commands.setContent(b),this.lastTextareaValue=l});return}const{processed:m,blocks:w}=this.preserver.preserveContent(l);this.preservedBlocks=w;const y=this.basicMarkdownToHtml(m);this.editor.commands.setContent(y),this.lastTextareaValue=l;return}const{processed:c,blocks:d}=this.preserver.preserveContent(l);this.preservedBlocks=d;const h=this.basicMarkdownToHtml(c);this.editor.commands.setContent(h),this.lastTextareaValue=l}};this.textarea.addEventListener("input",e),this.textarea.addEventListener("change",e);const i=this.textarea.parentNode.querySelector(".editor-pro-container");i&&i.addEventListener("input",n=>{const l=n.target;if(l.classList.contains("preserved-block-content")){const o=l.closest("[data-block-id]");if(o){const s=o.getAttribute("data-block-id"),r=this.preservedBlocks.get(s);if(r){if(r.type==="shortcode"&&r.isClosing){let a=l.innerHTML,c=this.htmlToMarkdown(a);c=c.replace(/!\[([^\]]*)\]\(([^)]+)\)/g,(h,p,u)=>{var g;for(const[m,w]of Object.entries(((g=this.pathMappings)==null?void 0:g.images)||{}))if(w.resolved===u)return`![${p}](${m})`;return h}),r.content=c;const d=r.params?` ${r.params}`:"";r.original=`[${r.tagName}${d}]${r.content}[/${r.tagName}]`}else r.content=l.textContent,r.original=l.textContent;o.setAttribute("data-block-data",JSON.stringify(r)),clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(()=>{this.updateTextarea()},300)}}}})}createDropdown(t){const e=document.createElement("div");e.className="editor-pro-dropdown",e.dataset.toolbarItem=t.name;const i=document.createElement("button");i.type="button",i.className="editor-pro-dropdown-toggle",i.setAttribute("data-tooltip",t.title),i.innerHTML=this.getIcon(t.icon)+'<span class="dropdown-arrow">\u25BC</span>';const n=document.createElement("div");return n.className="editor-pro-dropdown-menu",t.items.forEach(l=>{if(l.type==="separator"){const o=document.createElement("div");o.className="editor-pro-dropdown-separator",n.appendChild(o)}else{const o=document.createElement("button");o.type="button",o.className="editor-pro-dropdown-item",o.innerHTML=`
                        <span class="dropdown-item-icon">${this.getIcon(l.icon)}</span>
                        <span class="dropdown-item-text">${l.title}</span>
                    `,o.onmousedown=s=>{s.preventDefault(),s.stopPropagation()},o.onclick=s=>{s.stopPropagation(),l.action(),this.closeDropdown(e),this.editor.commands.focus()},n.appendChild(o)}}),i.onmousedown=l=>{l.preventDefault()},i.onclick=l=>{l.stopPropagation(),this.toggleDropdown(e)},e.appendChild(i),e.appendChild(n),e}toggleDropdown(t){const e=t.classList.contains("is-open");if(document.querySelectorAll(".editor-pro-dropdown.is-open").forEach(i=>{i!==t&&i.classList.remove("is-open")}),e)t.classList.remove("is-open");else{t.classList.add("is-open");const i=n=>{t.contains(n.target)||(t.classList.remove("is-open"),document.removeEventListener("click",i))};setTimeout(()=>{document.addEventListener("click",i)},0)}}closeDropdown(t){t.classList.remove("is-open")}toggleHeading(){this.editor.isActive("heading")?this.editor.commands.setParagraph():this.editor.commands.toggleHeading({level:2})}setHeading(t){this.editor.commands.setHeading({level:t})}toggleInlineHtml(t){if(!this.editor)return;this.editor.isActive(t)?this.editor.chain().focus().unsetMark(t).run():this.editor.chain().focus().toggleMark(t).run()}createModal(t,e,i,n=null,l=null){const o=document.querySelector(".editor-pro-modal");o&&o.remove();let s;l&&Array.isArray(l)?s=l.map((d,h)=>{const u=(d.style||"secondary")==="primary"?"modal-confirm":"modal-cancel";return`<button type="button" class="custom-btn-${h} ${u}" data-button-index="${h}">${d.text}</button>`}).join(""):s=`
                    <button type="button" class="modal-cancel">Cancel</button>
                    <button type="button" class="modal-confirm">OK</button>
                `;const r=document.createElement("div");r.className="editor-pro-modal",r.innerHTML=`
                <div class="modal-overlay"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>${t}</h3>
                        <button type="button" class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        ${e}
                    </div>
                    <div class="modal-footer">
                        ${s}
                    </div>
                </div>
            `,document.body.appendChild(r),r.querySelectorAll('input[type="checkbox"][checked]').forEach(d=>{d.checked=!0}),r.querySelectorAll(".editor-pro-toggle").forEach(d=>{d.addEventListener("click",h=>{const p=d.querySelector('input[type="checkbox"]'),u=d.querySelector(".toggle-track"),g=d.querySelector(".toggle-thumb");if(p){p.checked=!p.checked;const m=p.checked;u.style.backgroundColor=m?"#4a7dff":"#ccc",g.style.left=m?"22px":"2px",d.dataset.checked=m}})});const a=()=>{r.remove(),n&&n()},c=r.querySelector(".modal-content");if(["keydown","keypress","keyup"].forEach(d=>{c.addEventListener(d,h=>{h.stopPropagation(),d==="keydown"&&h.key==="Escape"&&a()},!0)}),c.addEventListener("input",d=>{c.contains(d.target)||d.stopPropagation()},!0),r.querySelector(".modal-close").onclick=a,r.querySelector(".modal-overlay").onclick=a,l&&Array.isArray(l))l.forEach((d,h)=>{const p=r.querySelector(`.custom-btn-${h}`);p&&d.callback&&(p.onclick=()=>{if(d.callback){const u=r;d.style==="primary"&&r.remove(),d.callback(u),d.style!=="primary"&&r.remove()}})});else{const d=r.querySelector(".modal-cancel"),h=r.querySelector(".modal-confirm");d&&(d.onclick=a),h&&(h.onclick=()=>{const p=r;r.remove(),i&&i(p)})}return i&&typeof i=="function"&&(!l||l.length===0)?setTimeout(()=>{r.parentNode&&i(r)},10):i&&typeof i=="function"&&setTimeout(()=>{r.parentNode&&i(r)},10),r}insertSummaryDelimiter(){if(!this.editor)return;const t=this.summaryDelimiter||this.summaryDelimiterTrimmed||"===",e=[{type:"summaryDelimiter",attrs:{delimiter:t}},{type:"paragraph"}];let i=this.editor.chain().focus().insertContent(e).run();i||(i=this.editor.chain().focus().insertContent({type:"summaryDelimiter",attrs:{delimiter:t}}).run()),i&&this.ensureSummaryInsertionContext()}ensureSummaryInsertionContext(){this.editor.commands.focus(),this.editor.isActive("listItem")&&this.editor.commands.liftListItem("listItem"),this.editor.isActive("blockquote")&&this.editor.commands.lift(),this.editor.isActive("blockquote")&&this.editor.commands.clearNodes(),this.editor.commands.clearNodes(),this.normalizeSummaryDelimiterNodes()}normalizeSummaryDelimiterNodes(){if(this.unwrapSummaryBlockquotes(),!this.editor)return;const t=this.editor.getHTML(),e=this.fixSummaryDelimiterBlockquotes(t);if(e!==t){const i=this.editor.state.selection,n=i?i.from:null,l=i?i.to:null;if(this.editor.commands.setContent(e,!0),n!==null&&l!==null){const o=this.editor.state.doc.content.size,s=Math.min(n,o),r=Math.min(l,o);this.editor.commands.setTextSelection({from:s,to:r})}this.updateTextarea()}}unwrapSummaryBlockquotes(){if(!this.editor)return;const{state:t,view:e}=this.editor,i=[];if(t.doc.descendants((l,o)=>{if(l.type.name==="blockquote"&&l.childCount===1&&l.firstChild.type.name==="summaryDelimiter")return i.push({pos:o,size:l.nodeSize,content:l.content}),!1}),!i.length)return;let n=t.tr;i.reverse().forEach(({pos:l,size:o,content:s})=>{n=n.replaceWith(l,l+o,s)}),e.dispatch(n),this.updateTextarea()}insertLink(){const t=this.editor.isActive("link"),e=t?this.editor.getAttributes("link"):{},i=e["data-href"]||e.href||"",n=t?"":this.editor.state.doc.textBetween(this.editor.state.selection.from,this.editor.state.selection.to),l=`
                <div class="form-group">
                    <label for="link-url">URL</label>
                    <input type="url" id="link-url" value="${i}" placeholder="https://example.com" />
                </div>
                <div class="form-group">
                    <label for="link-text">Link Text</label>
                    <input type="text" id="link-text" value="${n}" placeholder="Link text" />
                </div>
                ${t?'<div class="form-group"><label><input type="checkbox" id="remove-link" /> Remove link</label></div>':""}
            `;this.createModal(t?"Edit Link":"Insert Link",l,o=>{var c;const s=o.querySelector("#link-url").value.trim(),r=o.querySelector("#link-text").value.trim();((c=o.querySelector("#remove-link"))==null?void 0:c.checked)||!s?this.editor.commands.unsetLink():this.resolveLinkUrl(s).then(d=>{const u=new DOMParser().parseFromString(d,"text/html").querySelector("a");if(u){let g=u.getAttribute("href")||s;try{const w=s.indexOf("?");if(w!==-1){const y=s.substring(w);g.indexOf("?")===-1&&(g=g+y)}}catch(w){}const m={href:g,"data-href":s};if(Array.from(u.attributes).forEach(w=>{["href"].includes(w.name)||(m[w.name]=w.value)}),!t&&r){const w=Object.entries(m).map(([y,f])=>`${y}="${f}"`).join(" ");this.editor.commands.insertContent(`<a ${w}>${r}</a>`)}else this.editor.commands.setLink(m)}else!t&&r?this.editor.commands.insertContent(`<a href="${s}" data-href="${s}">${r}</a>`):this.editor.commands.setLink({href:s,"data-href":s})}).catch(d=>{!t&&r?this.editor.commands.insertContent(`<a href="${s}" data-href="${s}">${r}</a>`):this.editor.commands.setLink({href:s,"data-href":s})})})}insertImage(){this.createModal("Insert Image",`
                <div class="form-group">
                    <label for="image-src">Image URL</label>
                    <input type="url" id="image-src" placeholder="https://example.com/image.jpg" />
                </div>
                <div class="form-group">
                    <label for="image-alt">Alt Text</label>
                    <input type="text" id="image-alt" placeholder="Describe the image" />
                </div>
                <div class="form-group">
                    <label for="image-title">Title</label>
                    <input type="text" id="image-title" placeholder="Image title (tooltip)" />
                </div>
            `,e=>{const i=e.querySelector("#image-src").value.trim(),n=e.querySelector("#image-alt").value.trim(),l=e.querySelector("#image-title").value.trim();i&&this.resolveImageUrl(i).then(o=>{const a=new DOMParser().parseFromString(o,"text/html").querySelector("img");if(a){const c={src:a.getAttribute("src")||i,alt:n||a.getAttribute("alt")||"","data-src":a.getAttribute("data-src")||i};l&&(c.title=l),Array.from(a.attributes).forEach(d=>{["src","alt","title"].includes(d.name)||(c[d.name]=d.value)}),this.editor.commands.setImage(c)}else{const c={src:i,alt:n};l&&(c.title=l),this.editor.commands.setImage(c)}}).catch(o=>{const s={src:i,alt:n};l&&(s.title=l),this.editor.commands.setImage(s)})})}editImage(t){const e=this.editor.view;let i;try{i=e.posAtDOM(t,0)}catch(c){return}const n=e.state.doc.nodeAt(i);if(!n||n.type.name!=="image")return;const l=n.attrs.src||"",o=n.attrs.alt||"",s=n.attrs.title||"",a=`
                <div class="form-group">
                    <label for="image-src">Image URL</label>
                    <input type="url" id="image-src" value="${n.attrs["data-src"]||l}" placeholder="https://example.com/image.jpg" />
                </div>
                <div class="form-group">
                    <label for="image-alt">Alt Text</label>
                    <input type="text" id="image-alt" value="${o}" placeholder="Describe the image" />
                </div>
                <div class="form-group">
                    <label for="image-title">Title</label>
                    <input type="text" id="image-title" value="${s}" placeholder="Image title (tooltip)" />
                </div>
                <div class="form-group">
                    <label><input type="checkbox" id="remove-image" /> Remove image</label>
                </div>
            `;this.createModal("Edit Image",a,async c=>{const d=c.querySelector("#image-src").value.trim(),h=c.querySelector("#image-alt").value.trim(),p=c.querySelector("#image-title").value.trim(),u=c.querySelector("#remove-image").checked;if(this.editor.commands.setNodeSelection(i),u)this.editor.commands.deleteSelection();else if(d)try{const g=await this.resolveImageUrl(d),y=new DOMParser().parseFromString(g,"text/html").querySelector("img");if(y){const f={src:y.getAttribute("src")||d,alt:h||y.getAttribute("alt")||"",title:p||null,"data-src":d};Array.from(y.attributes).forEach(b=>{["src","alt","title"].includes(b.name)||(f[b.name]=b.value)});const k=e.state.tr;k.setNodeMarkup(i,null,f),e.dispatch(k)}else{const f=e.state.tr;f.setNodeMarkup(i,null,{...n.attrs,src:d,alt:h,title:p||null,"data-src":d}),e.dispatch(f)}}catch(g){const m=e.state.tr;m.setNodeMarkup(i,null,{...n.attrs,src:d,alt:h,title:p||null,"data-src":d}),e.dispatch(m)}else if(h!==o||p!==s){const g=e.state.tr;g.setNodeMarkup(i,null,{...n.attrs,alt:h,title:p||null}),e.dispatch(g)}})}editLink(t){const e=this.editor.view;let i;try{t.firstChild&&t.firstChild.nodeType===Node.TEXT_NODE?i=e.posAtDOM(t.firstChild,0):i=e.posAtDOM(t,0)}catch(u){return}let n=null,l=i,o=i;if(n=e.state.doc.resolve(i).marks().find(u=>u.type.name==="link"),!n){const{from:u,to:g}=e.state.selection;e.state.doc.nodesBetween(Math.max(0,i-10),Math.min(e.state.doc.content.size,i+10),(m,w)=>{if(n)return!1;if(m.marks.some(y=>y.type.name==="link")){const y=m.marks.find(f=>f.type.name==="link");if(y)return n=y,l=w,o=w+m.nodeSize,!1}})}if(!n)return;const a=n.attrs.href||"",c=n.attrs.target||"",d=n.attrs["data-href"]||a,h=t.textContent||"",p=`
                <div class="form-group">
                    <label for="link-url">URL</label>
                    <input type="url" id="link-url" value="${d}" placeholder="https://example.com" />
                </div>
                <div class="form-group">
                    <label for="link-text">Link Text</label>
                    <input type="text" id="link-text" value="${h}" placeholder="Link text" />
                </div>
                <div class="form-group">
                    <label for="link-target">Target</label>
                    <select id="link-target">
                        <option value="">Same window</option>
                        <option value="_blank" ${c==="_blank"?"selected":""}>New window</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><input type="checkbox" id="remove-link" /> Remove link</label>
                </div>
            `;this.createModal("Edit Link",p,async u=>{const g=u.querySelector("#link-url").value.trim(),m=u.querySelector("#link-text").value.trim(),w=u.querySelector("#link-target").value,y=u.querySelector("#remove-link").checked;let f=l!==void 0?l:i,k=o!==void 0?o:i;if(f===k){const b=e.state.doc;for(f=i;f>0&&b.resolve(f-1).marks().some(x=>x.type.name==="link"&&x.eq(n));)f--;for(k=i;k<b.content.size&&b.resolve(k).marks().some(x=>x.type.name==="link"&&x.eq(n));)k++}if(this.editor.commands.setTextSelection({from:f,to:k}),y)this.editor.commands.unsetLink();else if(g){m&&m!==h&&(this.editor.commands.insertContent(m),this.editor.commands.setTextSelection({from:f,to:f+m.length}));try{const b=await this.resolveLinkUrl(g),v=new DOMParser().parseFromString(b,"text/html").querySelector("a");if(v){let S=v.getAttribute("href")||g;try{const M=g.indexOf("?");if(M!==-1){const T=g.substring(M);S.indexOf("?")===-1&&(S=S+T)}}catch(M){}const $={href:S,"data-href":g,target:w||null};Array.from(v.attributes).forEach(M=>{["href","target"].includes(M.name)||($[M.name]=M.value)}),this.editor.commands.setLink($)}else this.editor.commands.setLink({href:g,"data-href":g,target:w||null})}catch(b){this.editor.commands.setLink({href:g,"data-href":g,target:w||null})}}})}insertTable(){const{state:t,dispatch:e}=this.editor.view,{$from:i}=t.selection,n=t.schema.nodes.paragraph,l=t.schema.nodes.tableCell,o=t.schema.nodes.tableHeader,s=t.schema.nodes.tableRow,r=t.schema.nodes.table,a=u=>(u?o:l).createAndFill(null,n.create()),c=s.create(null,[a(!0),a(!0),a(!0)]),d=[s.create(null,[a(!1),a(!1),a(!1)]),s.create(null,[a(!1),a(!1),a(!1)])],h=r.create(null,[c,...d]),p=t.tr.replaceSelectionWith(h);e(p)}addRowBefore(){this.editor.commands.addRowBefore(),requestAnimationFrame(()=>{this.fixEmptyTableCellsInEditor()})}addRowAfter(){this.editor.commands.addRowAfter(),requestAnimationFrame(()=>{this.fixEmptyTableCellsInEditor()})}deleteRow(){this.editor.commands.deleteRow()}addColumnBefore(){this.editor.commands.addColumnBefore(),requestAnimationFrame(()=>{this.fixEmptyTableCellsInEditor()})}addColumnAfter(){this.editor.commands.addColumnAfter(),requestAnimationFrame(()=>{this.fixEmptyTableCellsInEditor()})}deleteColumn(){this.editor.commands.deleteColumn()}deleteTable(){this.editor.commands.deleteTable()}toggleHeaderRow(){this.editor.commands.toggleHeaderRow()}toggleHeaderColumn(){this.editor.commands.toggleHeaderColumn()}toggleHeaderCell(){this.editor.commands.toggleHeaderCell()}insertHtmlBlock(){this.editor.commands.insertRawBlock&&this.editor.commands.insertRawBlock("","html")}insertShortcodeBlock(){this.shortcodeRegistry&&this.showShortcodeSelector()}toggleDragHandle(){if(!this.editor)return;this.dragHandlesVisible=!this.dragHandlesVisible;const t=this.toolbar.querySelector('[data-toolbar-item="dragHandle"]');t&&(this.dragHandlesVisible?t.classList.add("is-active"):t.classList.remove("is-active"));const e=this.textarea.closest(".editor-pro-wrapper");e&&(this.dragHandlesVisible?e.classList.add("show-drag-handles"):e.classList.remove("show-drag-handles")),localStorage.setItem("editor-pro-drag-handles",this.dragHandlesVisible?"true":"false")}toggleTypography(){if(!this.editor)return;this.typographyEnabled=!this.typographyEnabled;const t=this.toolbar.querySelector('[data-toolbar-item="typography"]');if(t&&(this.typographyEnabled?(t.classList.remove("is-active"),t.innerHTML=this.getIcon("typography"),t.setAttribute("data-tooltip","Disable Typography Shortcuts")):(t.classList.add("is-active"),t.innerHTML=this.getIcon("typographyOff"),t.setAttribute("data-tooltip","Enable Typography Shortcuts"))),this.extraTypographyExtension){this.editor.extensionManager.extensions.forEach(i=>{i.name==="extraTypography"&&(i.options.enabled=this.typographyEnabled)});const e=this.editor.getHTML();this.editor.destroy(),this.initializeEditor(),this.editor.commands.setContent(e)}localStorage.setItem("editor-pro-typography",this.typographyEnabled?"true":"false")}async toggleMarkdownMode(){if(this.editor)if(this.isMarkdownMode){if(this.rawMarkdownMode&&await this.rawMarkdownMode.exit()){this.isMarkdownMode=!1;const e=this.toolbar.querySelector('[data-toolbar-item="markdown-toggle"]');e&&e.classList.remove("is-active")}}else try{if(!this.rawMarkdownMode)if(window.RawMarkdownMode)this.rawMarkdownMode=new window.RawMarkdownMode(this);else{console.error("RawMarkdownMode not loaded in bundle");return}await this.rawMarkdownMode.enter(),this.isMarkdownMode=!0;const t=this.toolbar.querySelector('[data-toolbar-item="markdown-toggle"]');t&&t.classList.add("is-active")}catch(t){console.error("Failed to enter markdown mode:",t)}}showFindReplace(){this.searchBar&&this.searchBar.classList.contains("active")?this.hideFindReplace():this.createSearchBar()}createSearchBar(){if(!this.searchBar){const t=document.createElement("div");t.className="editor-pro-search-bar",t.innerHTML=`
                    <div class="search-bar-content">
                        <div class="search-input-group">
                            <input type="text" class="search-input" id="find-text" placeholder="Find..." />
                            <span class="search-results-count">0 of 0</span>
                        </div>
                        <div class="replace-input-group">
                            <input type="text" class="replace-input" id="replace-text" placeholder="Replace with..." />
                        </div>
                        <div class="search-actions">
                            <button type="button" class="search-btn" data-action="prev" title="Previous match (Shift+Enter)">
                                ${this.getIcon("chevronUp")}
                            </button>
                            <button type="button" class="search-btn" data-action="next" title="Next match (Enter)">
                                ${this.getIcon("chevronDown")}
                            </button>
                            <button type="button" class="search-btn" data-action="replace" title="Replace">
                                Replace
                            </button>
                            <button type="button" class="search-btn" data-action="replace-all" title="Replace All">
                                Replace All
                            </button>
                            <button type="button" class="search-btn close-search" data-action="close" title="Close (Esc)">
                                ${this.getIcon("x")}
                            </button>
                        </div>
                    </div>
                `;const e=this.toolbar.closest(".editor-pro-toolbar-wrapper");if(e)e.appendChild(t);else{const i=document.createElement("div");i.className="editor-pro-toolbar-wrapper",this.toolbar.parentNode.insertBefore(i,this.toolbar),i.appendChild(this.toolbar),i.appendChild(t)}this.searchBar=t,this.setupSearchBarHandlers()}requestAnimationFrame(()=>{this.searchBar.classList.add("active"),this.searchBar.querySelector("#find-text").focus(),this.updateStickyHeight()}),this.initializeSearch()}hideFindReplace(){this.searchBar&&(this.searchBar.classList.remove("active"),this.clearSearchHighlights(),this.searchResults=[],this.currentSearchIndex=-1,this.findText="",this.replaceText="",setTimeout(()=>this.updateStickyHeight(),300))}updateStickyHeight(){const t=document.querySelector(".editor-pro-toolbar-wrapper"),e=document.querySelector(".editor-pro-toolbar-placeholder");t&&e&&t.classList.contains("is-sticky")&&(e.style.height=t.offsetHeight+"px")}setupSearchBarHandlers(){const t=this.searchBar.querySelector("#find-text"),e=this.searchBar.querySelector("#replace-text");this.findText="",this.replaceText="",this.searchResults=[],this.currentSearchIndex=-1;let i;t.addEventListener("input",n=>{this.findText=n.target.value,clearTimeout(i),i=setTimeout(()=>this.performSearch(),150)}),e.addEventListener("input",n=>{this.replaceText=n.target.value}),t.addEventListener("keydown",n=>{n.key==="Enter"?(n.preventDefault(),n.shiftKey?this.findPrevious():this.findNext()):n.key==="Escape"&&(n.preventDefault(),this.hideFindReplace())}),e.addEventListener("keydown",n=>{n.key==="Enter"?(n.preventDefault(),this.replaceNext()):n.key==="Escape"&&(n.preventDefault(),this.hideFindReplace())}),this.searchBar.querySelectorAll(".search-btn").forEach(n=>{n.addEventListener("click",()=>{switch(n.dataset.action){case"prev":this.findPrevious();break;case"next":this.findNext();break;case"replace":this.replaceNext();break;case"replace-all":this.replaceAll();break;case"close":this.hideFindReplace();break}})}),this.editor&&this.editor.view&&this.editor.view.dom.addEventListener("mousedown",n=>{this.searchBar&&this.searchBar.classList.contains("active")&&setTimeout(()=>{this.editor.commands.focus()},10)},{once:!1})}initializeSearch(){this.findText&&this.performSearch()}performSearch(){if(this.clearSearchHighlights(),this.searchResults=[],this.currentSearchIndex=-1,!this.findText){this.updateSearchCount();return}const{state:t}=this.editor,e=this.findText.toLowerCase();let i=[];t.doc.descendants((n,l)=>{if(n.isText&&n.text){const o=n.text.toLowerCase();let s=0;for(;(s=o.indexOf(e,s))!==-1;)i.push({from:l+s,to:l+s+e.length}),s+=e.length}}),this.searchResults=i,this.highlightSearchResults(),i.length>0&&(this.currentSearchIndex=0,this.selectSearchResult(0)),this.updateSearchCount()}highlightSearchResults(){!this.editor||!this.searchExtension||(this.searchExtension.storage.searchResults=this.searchResults,this.searchExtension.storage.currentIndex=this.currentSearchIndex,this.editor.view.dispatch(this.editor.state.tr))}clearSearchHighlights(){!this.editor||!this.searchExtension||(this.searchExtension.storage.searchResults=[],this.searchExtension.storage.currentIndex=-1,this.editor.view.dispatch(this.editor.state.tr))}createSearchHighlightExtension(){const t=this;return TiptapCore.Extension.create({name:"searchHighlight",addStorage(){return{searchResults:[],currentIndex:-1}},addProseMirrorPlugins(){if(!window.TiptapPM||!window.TiptapPMView)return[];const{Plugin:e,PluginKey:i}=window.TiptapPM,{Decoration:n,DecorationSet:l}=window.TiptapPMView;return[new e({key:new i("searchHighlight"),props:{decorations:o=>{try{const s=this.storage,r=[];return s&&s.searchResults&&s.searchResults.forEach((a,c)=>{const h=c===s.currentIndex?"search-result search-result-current":"search-result",p=n.inline(a.from,a.to,{class:h});r.push(p)}),l.create(o.doc,r)}catch(s){return l.empty}}}})]}})}selectSearchResult(t,e=!1){if(t>=0&&t<this.searchResults.length){const i=this.searchResults[t];this.currentSearchIndex=t,this.editor.commands.setTextSelection({from:i.from,to:i.to});const{state:n,view:l}=this.editor;try{const o=l.domAtPos(i.from);if(o&&o.node){const s=o.node.nodeType===Node.TEXT_NODE?o.node.parentElement:o.node;s&&s.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}}catch(o){const s=n.tr.scrollIntoView();l.dispatch(s)}setTimeout(()=>{try{const o=l.coordsAtPos(i.from),s=l.dom.getBoundingClientRect();let r=l.dom.closest(".editor-pro-container");if(!r)for(r=l.dom.parentElement;r&&r!==document.body;){const a=window.getComputedStyle(r);if(a.overflowY==="auto"||a.overflowY==="scroll")break;r=r.parentElement}if(r){const a=r.getBoundingClientRect(),c=o.top-a.top+r.scrollTop,d=o.top<a.top+100,h=o.bottom>a.bottom-100;if(d||h){const p=c-a.height/2;r.scrollTo({top:p,behavior:"smooth"})}}}catch(o){}},100),this.updateSearchCount(),this.searchExtension&&(this.searchExtension.storage.currentIndex=t,this.editor.view.dispatch(this.editor.state.tr)),e&&this.editor.commands.focus()}}findPrevious(){if(this.searchResults.length===0)return;let t=this.currentSearchIndex-1;t<0&&(t=this.searchResults.length-1),this.selectSearchResult(t)}updateSearchCount(){const t=this.searchBar.querySelector(".search-results-count");this.searchResults.length===0?t.textContent="0 of 0":t.textContent=`${this.currentSearchIndex+1} of ${this.searchResults.length}`}findNext(){if(this.searchResults.length===0){this.findText&&this.performSearch();return}let t=this.currentSearchIndex+1;t>=this.searchResults.length&&(t=0),this.selectSearchResult(t)}replaceNext(){if(!this.findText||this.replaceText===void 0)return;const t=this.searchBar.querySelector("#find-text"),e=this.searchBar.querySelector("#replace-text"),i=document.activeElement===t||document.activeElement===e;if(this.currentSearchIndex>=0&&this.currentSearchIndex<this.searchResults.length){const n=this.searchResults[this.currentSearchIndex],{state:l}=this.editor,{from:o,to:s}=l.selection;o===n.from&&s===n.to?(this.editor.chain().insertContent(this.replaceText).run(),setTimeout(()=>{this.performSearch(),this.currentSearchIndex<this.searchResults.length?this.selectSearchResult(this.currentSearchIndex,!1):this.searchResults.length>0&&this.selectSearchResult(0,!1),i&&e.focus()},10)):this.findNext()}else this.findNext()}replaceAll(){if(!this.findText||this.replaceText===void 0)return;const{state:t}=this.editor,{from:e}=t.selection,i=this.editor.getHTML(),n=new RegExp(this.findText.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),l=i.replace(n,this.replaceText);this.editor.commands.setContent(l),this.searchResults=[],this.currentSearchIndex=-1,this.updateSearchCount();try{this.editor.commands.setTextSelection({from:Math.min(e,this.editor.state.doc.content.size-1)})}catch(o){}}showShortcodeSelector(){const t=this.shortcodeRegistry.getAllSortedLogically();if(t.length===0){this.createModal("No Shortcodes Available","<p>No shortcodes are currently registered. Please check your plugin configuration.</p>",null,()=>{});return}const e=`
                <div class="shortcode-selector">
                    <div class="shortcode-search-wrapper">
                        <input type="text" 
                               id="shortcode-search" 
                               class="shortcode-search"
                               placeholder="Search shortcodes...">
                    </div>
                    <div class="shortcode-list">
                        ${t.map(i=>{const n=i.parentOnly;return`
                            <div class="shortcode-option ${n?"parent-only":""}" 
                                 data-shortcode="${i.name}" 
                                 data-search-terms="${i.name.toLowerCase()} ${i.title.toLowerCase()} ${(i.description||"").toLowerCase()}"
                                 ${n?'data-parent-only="true"':""}>
                                ${i.icon?`<div class="shortcode-icon">${i.icon}</div>`:'<div class="shortcode-icon"></div>'}
                                <div class="shortcode-info">
                                    <div class="shortcode-info-header">
                                        <span class="shortcode-title">${i.title}</span>
                                        <span class="shortcode-type-badge">${i.type}</span>
                                        ${n?'<span class="shortcode-parent-badge">parent-only</span>':""}
                                    </div>
                                    ${i.description?`<div class="shortcode-description">${i.description}</div>`:""}
                                </div>
                            </div>
                        `}).join("")}
                    </div>
                </div>
            `;this.createModal("Insert Shortcode",e,i=>{const n=i.querySelector("#shortcode-search"),l=i.querySelectorAll(".shortcode-option");if(!n||l.length===0)return;const o=s=>{const r=s.toLowerCase().trim();let a=0;l.forEach(d=>{const h=d.dataset.searchTerms||"";r&&d.dataset.shortcode;const p=!r||h.includes(r);d.style.display=p?"flex":"none",p&&a++});let c=i.querySelector(".no-results-message");a===0&&r?(c||(c=document.createElement("div"),c.className="no-results-message",c.textContent="No shortcodes found matching your search.",i.querySelector(".shortcode-list").appendChild(c)),c.style.display="block"):c&&(c.style.display="none")};n.addEventListener("input",s=>{o(s.target.value)},!1),n.addEventListener("keypress",s=>{s.stopPropagation()}),n.addEventListener("keyup",s=>{s.stopPropagation()}),n.addEventListener("keydown",s=>{s.stopPropagation();const r=Array.from(l).filter(c=>c.style.display!=="none");let a=r.findIndex(c=>c.classList.contains("highlighted"));if(s.key==="ArrowDown")s.preventDefault(),a<r.length-1&&(a>=0&&r[a].classList.remove("highlighted"),a++,r[a].classList.add("highlighted"),r[a].scrollIntoView({block:"nearest"}));else if(s.key==="ArrowUp")s.preventDefault(),a>0&&(r[a].classList.remove("highlighted"),a--,r[a].classList.add("highlighted"),r[a].scrollIntoView({block:"nearest"}));else if(s.key==="Enter"&&(s.preventDefault(),a>=0)){const c=r[a].dataset.shortcode;this.showShortcodeForm(c)}}),l.forEach(s=>{s.addEventListener("mouseenter",()=>{l.forEach(r=>r.classList.remove("highlighted")),s.classList.add("highlighted"),s.style.backgroundColor="#f8f9fa"}),s.addEventListener("mouseleave",()=>{s.classList.remove("highlighted"),s.style.backgroundColor=""}),s.addEventListener("click",()=>{if(s.dataset.parentOnly==="true")return;const r=s.dataset.shortcode;this.showShortcodeForm(r)})}),setTimeout(()=>{n.focus()},50)},()=>{})}showShortcodeForm(t){const e=this.shortcodeRegistry.get(t);if(!e)return;const{from:i,to:n}=this.editor.state.selection,l=this.editor.state.doc.textBetween(i,n," "),o=Object.entries(e.attributes),s=o.length>0,r=e.hasContent&&e.type!=="block";if(!s&&!r){const c=`shortcode_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=e.hasContent&&e.type==="inline"&&l?l:"";if(e.type==="block"&&this.editor.commands.insertShortcodeBlock)this.editor.commands.insertShortcodeBlock(t,"",{},d,c);else if(e.type==="inline"){const h=e.hasContent?`[${t}]${d||"Default content"}[/${t}]`:`[${t}/]`;this.insertShortcode(e,h,{},d)}else{const h=e.hasContent?`[${t}]${d||"Default content"}[/${t}]`:`[${t}/]`;this.editor.commands.insertContent(h)}this.editor.focus();return}const a=`
                <div class="shortcode-form-container">
                    <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                        <h3 class="shortcode-modal-title" style="margin: 0 0 8px; color: #333; display: flex; align-items: center; gap: 10px;">
                            ${e.icon?`<span class="shortcode-modal-icon">${e.icon}</span>`:""}
                            ${e.title}
                        </h3>
                        <p style="margin: 0; color: #666; font-size: 14px;">${e.description}</p>
                        <p style="margin: 5px 0 0; color: #888; font-size: 12px;">Type: ${e.type}</p>
                    </div>
                    
                    <form class="shortcode-form" style="margin-bottom: 20px;">
                        ${s?o.map(([c,d])=>`
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #333; font-size: 14px;">
                                    ${d.title||c.charAt(0).toUpperCase()+c.slice(1)}
                                    ${d.required?'<span style="color: #e74c3c;">*</span>':'<span style="color: #888; font-weight: normal;">(optional)</span>'}
                                </label>
                                ${this.renderShortcodeFormField(c,d)}
                                ${d.description?`<small style="color: #666; font-size: 12px; margin-top: 4px; display: block;">${d.description}</small>`:""}
                            </div>
                        `).join(""):'<p style="color: #666; font-style: italic;">This shortcode has no configurable attributes.</p>'}
                        
                        ${r?`
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #333; font-size: 14px;">Content</label>
                                <textarea name="content" placeholder="Enter content..." style="
                                    width: 100%;
                                    min-height: 80px;
                                    padding: 8px;
                                    border: 1px solid #ddd;
                                    border-radius: 4px;
                                    font-family: inherit;
                                    resize: vertical;
                                ">${l||""}</textarea>
                            </div>
                        `:""}
                    </form>
                </div>
            `;this.createModal("Configure Shortcode",a,c=>{const d=c.querySelector("input, textarea, select");d&&d.focus(),c.querySelectorAll(".page-picker-btn").forEach(u=>{u.addEventListener("click",g=>{g.preventDefault();const m=u.dataset.attributeName,w=c.querySelector(`.page-picker-field[data-attribute-name="${m}"]`),y=w.querySelector(`input[name="${m}"]`),f=w.querySelector(".page-picker-display");if(window.EditorProPagePicker)window.EditorProPagePicker.show(y.value,k=>{y.value=k,f.value=k,fetch(`${window.GravAdmin.config.base_url_relative}/task:pageInjectData`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`admin-nonce=${window.GravAdmin.config.admin_nonce}&routes[]=${encodeURIComponent(k)}`}).then(b=>b.json()).then(b=>{if(b.data&&b.data[0]&&b.data[0].status==="success"){const C=b.data[0].data;f.value=`${C.title} (${C.route})`,y.setAttribute("data-title",C.title)}}).catch(b=>{f.value=k})});else{const k=prompt("Enter page route (e.g. /home, /typography):",y.value||"/");k&&(y.value=k,f.value=k,fetch(`${window.GravAdmin.config.base_url_relative}/task:pageInjectData`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`admin-nonce=${window.GravAdmin.config.admin_nonce}&routes[]=${encodeURIComponent(k)}`}).then(b=>b.json()).then(b=>{if(b.data&&b.data[0]&&b.data[0].status==="success"){const C=b.data[0].data;f.value=`${C.title} (${C.route})`,y.setAttribute("data-title",C.title)}}).catch(b=>{}))}})}),c.querySelectorAll(".page-picker-display").forEach(u=>{u.addEventListener("click",g=>{const w=g.target.closest(".page-picker-field").querySelector(".page-picker-btn");w&&w.click()})})},()=>{},[{text:"Back",style:"secondary",callback:()=>{this.showShortcodeSelector()}},{text:"Insert Shortcode",style:"primary",callback:c=>{this.insertConfiguredShortcode(e,c)}}])}renderShortcodeFormField(t,e){const i=`
                width: 100%;
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-family: inherit;
                font-size: 14px;
            `;switch(e.type){case"select":return`
                        <select name="${t}" style="${i}">
                            ${e.options?e.options.map(n=>`
                                <option value="${n}" ${n===e.default?"selected":""}>${n}</option>
                            `).join(""):""}
                        </select>
                    `;case"color":return`
                        <input type="color" name="${t}" value="${e.default||"#000000"}" style="${i} height: 40px;">
                    `;case"number":return`
                        <input type="number" name="${t}" value="${e.default||""}" 
                               ${e.min!==void 0?`min="${e.min}"`:""} 
                               ${e.max!==void 0?`max="${e.max}"`:""} 
                               ${e.step!==void 0?`step="${e.step}"`:""}
                               style="${i}">
                    `;case"checkbox":return`
                        <label style="display: flex; align-items: center; cursor: pointer; padding: 8px;">
                            <input type="checkbox" name="${t}" ${e.default?"checked":""} 
                                   style="margin-right: 8px;">
                            ${e.label||"Enable"}
                        </label>
                    `;case"textarea":return`
                        <textarea name="${t}" placeholder="${e.placeholder||""}" style="
                            ${i}
                            min-height: 60px;
                            resize: vertical;
                        ">${e.default||""}</textarea>
                    `;case"page":return`
                        <div class="page-picker-field" data-attribute-name="${t}">
                            <input type="hidden" name="${t}" value="${e.default||""}" />
                            <input type="text" 
                                   class="page-picker-display" 
                                   value="${e.default||""}" 
                                   placeholder="${e.placeholder||"Click to select a page"}" 
                                   readonly
                                   style="${i} cursor: pointer; background-color: #f5f5f5;">
                            <button type="button" 
                                    class="btn btn-sm page-picker-btn" 
                                    data-attribute-name="${t}"
                                    style="margin-top: 8px;">
                                Select Page
                            </button>
                        </div>
                    `;default:return`
                        <input type="text" name="${t}" value="${e.default||""}" 
                               placeholder="${e.placeholder||""}" style="${i}">
                    `}}insertConfiguredShortcode(t,e){const i=e.querySelector(".shortcode-form"),n=new FormData(i),l=this.validateShortcodeForm(t,n);if(!l.valid){alert(`Please correct the following errors:
`+l.errors.join(`
`));return}const o={};Object.entries(t.attributes).forEach(([a,c])=>{const d=n.get(a);if(d!==null&&d!=="")if(c.type==="checkbox")o[a]=i.querySelector(`[name="${a}"]`).checked;else if(c.type==="page"){const h=i.querySelector(`input[name="${a}"]`);o[a]=d;const p=h.getAttribute("data-title");p&&!c.skipTitleAttribute&&(o.title=p)}else o[a]=d});const s=t.hasContent&&n.get("content")||"",r=this.buildShortcodeString(t,o,s);this.insertShortcode(t,r,o,s)}validateShortcodeForm(t,e){const i=[];return Object.entries(t.attributes).forEach(([n,l])=>{const o=e.get(n);if(l.required&&(!o||o.trim()==="")&&i.push(`${l.title||n} is required`),o&&l.type==="number"){const s=parseFloat(o);isNaN(s)?i.push(`${l.title||n} must be a valid number`):(l.min!==void 0&&s<l.min&&i.push(`${l.title||n} must be at least ${l.min}`),l.max!==void 0&&s>l.max&&i.push(`${l.title||n} must be at most ${l.max}`))}}),{valid:i.length===0,errors:i}}buildShortcodeString(t,e,i){let n=`[${t.name}`;return Object.entries(e).forEach(([l,o])=>{var r,a;if(o==null||o==="")return;const s=(a=(r=t==null?void 0:t.attributes)==null?void 0:r[l])==null?void 0:a.default;if(!(s!==void 0&&s===o)){if(typeof o=="boolean"){o&&(n+=` ${l}="true"`);return}n+=` ${l}="${o}"`}}),t.hasContent?(n+="]",n+=i+`[/${t.name}]`):t.type==="inline"?n+="/]":n+="]",n}insertShortcode(t,e,i,n){const l=this.preserver.generateBlockId(),o={type:"shortcode",tagName:t.name,shortcodeName:t.name,shortcodeType:t.type,params:this.buildParamsString(i,t),attributes:i,content:n,original:e,isClosing:t.hasContent,isSelfClosing:t.hasContent===!1,shortcodeConfig:t};this.preservedBlocks.set(l,o),t.type==="inline"?this.insertInlineShortcode(l,t,e,o):this.insertBlockShortcode(l,t,e,o)}buildParamsString(t,e=null){return Object.entries(t).map(([i,n])=>{var o,s;if(n==null||n==="")return"";const l=(s=(o=e==null?void 0:e.attributes)==null?void 0:o[i])==null?void 0:s.default;return l!==void 0&&l===n?"":typeof n=="boolean"?` ${i}="${n?"true":"false"}"`:` ${i}="${n}"`}).join("")}insertBlockShortcode(t,e,i,n){const l="shortcodeBlock",o=t||`shortcode_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,s=this.editor.state.schema.nodes[l].create({shortcodeName:e.name,params:n.params||"",attributes:n.attributes||{},placeholderId:o},this.editor.state.schema.nodes.paragraph.create());this.preservedBlocks.has(o)||this.preservedBlocks.set(o,{type:"shortcode",tagName:e.name,shortcodeName:e.name,shortcodeType:"block",params:n.params||"",attributes:n.attributes||{},content:"",original:i,isClosing:!0,isBlock:!0});const r=this.editor.state.tr,a=r.selection;r.replaceSelectionWith(s),r.setMeta("addToHistory",!0),this.editor.view.dispatch(r),e.cssTemplate&&this.applyShortcodeCSS(o,e,n.attributes),setTimeout(()=>{const c=this.editor.state.selection.from;this.editor.chain().focus().setTextSelection(c+1).run()},100)}applyShortcodeCSS(t,e,i){const n=this.shortcodeRegistry.generateCSS(e.name,i);if(!n)return;let l=`shortcode-css-${t}`,o=document.getElementById(l);o||(o=document.createElement("style"),o.id=l,document.head.appendChild(o));const s=`
                .preserved-block[data-block-id="${t}"] .preserved-block-content {
                    ${n}
                }
            `;o.textContent=s}removeShortcodeCSS(t){const e=document.getElementById(`shortcode-css-${t}`);e&&e.remove()}enhanceShortcodeBlocks(){this.preservedBlocks.forEach((t,e)=>{if(t.type==="shortcode"&&this.shortcodeRegistry){const i=this.shortcodeRegistry.get(t.tagName);i&&(t.shortcodeConfig=i,t.shortcodeType=i.type||"block",t.isBlock=t.shortcodeType==="block")}})}applyAllShortcodeCSS(){this.enhanceShortcodeBlocks(),this.preservedBlocks.forEach((t,e)=>{t.type==="shortcode"&&t.shortcodeConfig&&t.shortcodeConfig.cssTemplate&&this.applyShortcodeCSS(e,t.shortcodeConfig,t.attributes||{})})}insertInlineShortcode(t,e,i,n){this.editor.commands.insertContent({type:"preservedInline",attrs:{blockId:t,blockType:"shortcode",blockContent:i,blockData:n}}),e.cssTemplate&&setTimeout(()=>{const l=document.querySelector(`[data-block-id="${t}"]`);if(l){const o=this.shortcodeRegistry.generateCSS(e.name,n.attributes||{});o&&(l.style.cssText+=`; ${o}`)}},0)}setupInlineShortcodeEventDelegation(){this.editorElement&&(this.inlineShortcodeClickHandler&&this.editorElement.removeEventListener("click",this.inlineShortcodeClickHandler),this.inlineShortcodeClickHandler=t=>{const e=t.target;if(e&&e.classList&&e.classList.contains("preserved-inline"),e&&e.matches&&e.matches('span[data-preserved-inline="true"][data-block-id]')){t.preventDefault(),t.stopPropagation();const n=e.getAttribute("data-block-id");this.reconstructInlineShortcodeBlock(e,n)?this.editInlineShortcode(n):n&&this.preservedBlocks.has(n)&&this.editInlineShortcode(n);return}const i=e.closest&&e.closest('span[data-preserved-inline="true"][data-block-id]');if(i){t.preventDefault(),t.stopPropagation();const n=i.getAttribute("data-block-id");this.reconstructInlineShortcodeBlock(i,n)?this.editInlineShortcode(n):n&&this.preservedBlocks.has(n)&&this.editInlineShortcode(n)}},this.editorElement.addEventListener("click",this.inlineShortcodeClickHandler))}reconstructInlineShortcodeBlock(t,e){const i=t.getAttribute("data-block-data");if(i)try{const n=JSON.parse(i);if(n.tagName||n.shortcodeName){const l=n.tagName||n.shortcodeName;if(this.shortcodeRegistry){this.shortcodeRegistry.ensureInitialized();const o=this.shortcodeRegistry.get(l);o&&(n.shortcodeConfig=o)}}return this.preservedBlocks.set(e,n),!0}catch(n){return!1}return!1}editInlineShortcode(t){const e=this.preservedBlocks.get(t);if(!e)return;if(!e.shortcodeConfig&&this.shortcodeRegistry){const n=e.tagName||e.shortcodeName;if(n){this.shortcodeRegistry.ensureInitialized();const l=this.shortcodeRegistry.get(n);if(l)e.shortcodeConfig=l;else if(e.shortcodeConfig={name:n,title:n.charAt(0).toUpperCase()+n.slice(1),description:`Edit ${n} shortcode`,type:e.shortcodeType||"inline",hasContent:!0,attributes:{}},e.params){const o=/([\w-]+)\s*=\s*"([^"]*)"/g;let s;for(;(s=o.exec(e.params))!==null;)e.shortcodeConfig.attributes[s[1]]={type:"text",title:s[1].charAt(0).toUpperCase()+s[1].slice(1),default:s[2]}}}}if(!e.shortcodeConfig)return;const i=e.shortcodeConfig;if(e.params&&i.bbcodeAttribute){const n=e.params.match(/^\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s"'\/\]]+))/);if(n){const l=n[1]||n[2]||n[3];e.attributes||(e.attributes={}),e.attributes[i.bbcodeAttribute]||(e.attributes[i.bbcodeAttribute]=l)}}this.showShortcodeEditForm(i,e,t)}showShortcodeEditForm(t,e,i,n=null){const l=Object.entries(t.attributes),o=l.length>0,s=`
                <div class="shortcode-edit-form-container">
                    <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                        <h3 class="shortcode-modal-title" style="margin: 0 0 8px; color: #333; display: flex; align-items: center; gap: 10px;">
                            ${t.icon?`<span class="shortcode-modal-icon">${t.icon}</span>`:""}
                            Edit ${t.title}
                        </h3>
                        <p style="margin: 0; color: #666; font-size: 14px;">${t.description}</p>
                        <p style="margin: 5px 0 0; color: #888; font-size: 12px;">Type: ${t.type}</p>
                    </div>
                    
                    <form class="shortcode-edit-form" style="margin-bottom: 20px;">
                        ${o?l.map(([r,a])=>`
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #333; font-size: 14px;">
                                    ${a.title||r.charAt(0).toUpperCase()+r.slice(1)}
                                    ${a.required?'<span style="color: #e74c3c;">*</span>':'<span style="color: #888; font-weight: normal;">(optional)</span>'}
                                </label>
                                ${this.renderShortcodeEditField(r,a,e.attributes[r])}
                                ${a.description?`<small style="color: #666; font-size: 12px; margin-top: 4px; display: block;">${a.description}</small>`:""}
                            </div>
                        `).join(""):'<p style="color: #666; font-style: italic;">This shortcode has no configurable attributes.</p>'}
                        
                        ${t.hasContent&&t.type!=="block"?`
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #333; font-size: 14px;">Content</label>
                                <textarea name="content" placeholder="Enter content..." style="
                                    width: 100%;
                                    min-height: 80px;
                                    padding: 8px;
                                    border: 1px solid #ddd;
                                    border-radius: 4px;
                                    font-family: inherit;
                                    resize: vertical;
                                ">${e.content||""}</textarea>
                            </div>
                        `:""}
                    </form>
                </div>
            `;this.createModal("Edit Shortcode",s,r=>{const a=r.querySelector("input, textarea, select");a&&a.focus(),r.querySelectorAll(".page-picker-btn").forEach(p=>{p.addEventListener("click",u=>{u.preventDefault();const g=p.dataset.attributeName,m=r.querySelector(`.page-picker-field[data-attribute-name="${g}"]`),w=m.querySelector(`input[name="${g}"]`),y=m.querySelector(".page-picker-display");window.EditorProPagePicker&&window.EditorProPagePicker.show(w.value,f=>{w.value=f,y.value=f,fetch(`${window.GravAdmin.config.base_url_relative}/task:pageInjectData`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`admin-nonce=${window.GravAdmin.config.admin_nonce}&routes[]=${encodeURIComponent(f)}`}).then(k=>k.json()).then(k=>{if(k.data&&k.data[0]&&k.data[0].status==="success"){const b=k.data[0].data;y.value=`${b.title} (${b.route})`,w.setAttribute("data-title",b.title)}}).catch(k=>{y.value=f})})})}),r.querySelectorAll(".page-picker-display").forEach(p=>{p.addEventListener("click",u=>{const m=u.target.closest(".page-picker-field").querySelector(".page-picker-btn");m&&m.click()})}),r.querySelectorAll(".page-picker-field").forEach(p=>{const u=p.querySelector('input[type="hidden"]'),g=p.querySelector(".page-picker-display");u.value&&fetch(`${window.GravAdmin.config.base_url_relative}/task:pageInjectData`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`admin-nonce=${window.GravAdmin.config.admin_nonce}&routes[]=${encodeURIComponent(u.value)}`}).then(m=>m.json()).then(m=>{if(m.data&&m.data[0]&&m.data[0].status==="success"){const w=m.data[0].data;g.value=`${w.title} (${w.route})`,u.setAttribute("data-title",w.title)}})})},()=>{},[{text:"Delete",style:"danger",callback:()=>{this.deleteInlineShortcode(i)}},{text:"Cancel",style:"secondary",callback:()=>{}},{text:"Update Shortcode",style:"primary",callback:r=>{if(n){const a=this.extractShortcodeFormData(r,t,e);n(a)}else t.type==="inline"?this.updateInlineShortcode(t,e,i,r):this.updateBlockShortcode(t,e,i,r)}}])}extractShortcodeFormData(t,e,i){const n=t.querySelector(".shortcode-edit-form"),l={};Object.entries(e.attributes).forEach(([r,a])=>{if(a.type==="page"){const c=n.querySelector(`input[name="${r}"]`);if(c){l[r]=c.value;const d=c.getAttribute("data-title");d&&!a.skipTitleAttribute&&(l.title=d)}}else if(a.type==="checkbox"){const c=n.querySelector(`input[name="${r}"]`);c&&(l[r]=c.checked)}else{const c=n.querySelector(`[name="${r}"]`);c&&(l[r]=c.value)}});let o=i.content||"";if(e.hasContent){const r=n.querySelector('[name="content"]');r&&(o=r.value)}const s=this.buildParamsString(l);return{tagName:e.name,params:s,attributes:l,content:o,type:"shortcode",shortcodeConfig:e}}renderShortcodeEditField(t,e,i){const n=`
                width: 100%;
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-family: inherit;
                font-size: 14px;
            `,o=i!=null&&i!==""?i:"";switch(e.type){case"select":const s=e.options||[],r=Array.isArray(s)?s.map(c=>`
                                <option value="${c}" ${c===o?"selected":""}>${c}</option>
                            `).join(""):Object.entries(s).map(([c,d])=>`
                                <option value="${c}" ${c===o?"selected":""}>${d}</option>
                            `).join("");return`
                        <div style="position: relative;">
                            <select name="${t}" style="
                                ${n}
                                appearance: none;
                                -webkit-appearance: none;
                                -moz-appearance: none;
                                padding-right: 36px;
                                cursor: pointer;
                                background-color: #fff;
                                border: 1px solid #ddd;
                            ">
                                ${r}
                            </select>
                            <span style="
                                position: absolute;
                                right: 12px;
                                top: 50%;
                                transform: translateY(-50%);
                                pointer-events: none;
                                color: #666;
                                font-size: 10px;
                                display: flex;
                                flex-direction: column;
                                line-height: 10px;
                            ">
                                \u25BC
                            </span>
                        </div>
                    `;case"color":return`
                        <input type="color" name="${t}" value="${o||"#000000"}" style="${n} height: 40px;">
                    `;case"number":return`
                        <input type="number" name="${t}" value="${o}" 
                               ${e.min!==void 0?`min="${e.min}"`:""} 
                               ${e.max!==void 0?`max="${e.max}"`:""} 
                               ${e.step!==void 0?`step="${e.step}"`:""}
                               style="${n}">
                    `;case"checkbox":const a=o===!0||o==="true";return`
                        <div class="editor-pro-toggle" data-checked="${a}" style="display: flex; align-items: center; padding: 8px 0; cursor: pointer;">
                            <input type="checkbox" name="${t}" ${a?"checked":""} style="display: none;">
                            <div class="toggle-track" style="
                                width: 44px;
                                height: 24px;
                                background-color: ${a?"#4a7dff":"#ccc"};
                                border-radius: 12px;
                                position: relative;
                                transition: background-color 0.2s;
                                margin-right: 10px;
                                flex-shrink: 0;
                            ">
                                <div class="toggle-thumb" style="
                                    width: 20px;
                                    height: 20px;
                                    background-color: white;
                                    border-radius: 50%;
                                    position: absolute;
                                    top: 2px;
                                    left: ${a?"22px":"2px"};
                                    transition: left 0.2s;
                                    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
                                "></div>
                            </div>
                            <span style="color: #333; font-size: 14px; user-select: none;">${e.label||"Enable"}</span>
                        </div>
                    `;case"textarea":return`
                        <textarea name="${t}" placeholder="${e.placeholder||""}" style="
                            ${n}
                            min-height: 60px;
                            resize: vertical;
                        ">${o}</textarea>
                    `;case"page":return`
                        <div class="page-picker-field" data-attribute-name="${t}">
                            <input type="hidden" name="${t}" value="${o}" />
                            <input type="text" 
                                   class="page-picker-display" 
                                   value="${o}" 
                                   placeholder="${e.placeholder||"Click to select a page"}" 
                                   readonly
                                   style="${n} cursor: pointer; background-color: #f5f5f5;">
                            <button type="button" 
                                    class="btn btn-sm page-picker-btn" 
                                    data-attribute-name="${t}"
                                    style="margin-top: 8px;">
                                Select Page
                            </button>
                        </div>
                    `;default:return`
                        <input type="text" name="${t}" value="${o}" 
                               placeholder="${e.placeholder||""}" style="${n}">
                    `}}updateInlineShortcode(t,e,i,n){var g,m,w,y;const l=n.querySelector(".shortcode-edit-form"),o=new FormData(l),s=this.validateShortcodeForm(t,o);if(!s.valid){alert(`Please correct the following errors:
`+s.errors.join(`
`));return}const r={};Object.entries(t.attributes).forEach(([f,k])=>{const b=o.get(f);b!==null&&b!==""&&(k.type==="checkbox"?r[f]=l.querySelector(`[name="${f}"]`).checked:r[f]=b)});const a=t.hasContent&&o.get("content")||"",c=this.buildShortcodeString(t,r,a);e.attributes=r,e.content=a,e.original=c,e.params=this.buildParamsString(r),t.type==="inline"&&t.hasContent===!1&&(e.isSelfClosing=!0);try{if(this.preservedBlocks&&i){const f={...e,attributes:r,content:a,original:c,params:this.buildParamsString(r,t)};this.preservedBlocks.set(i,f)}}catch(f){}const d=((m=(g=this.editor)==null?void 0:g.view)==null?void 0:m.dom)||this.editorElement||document.querySelector(".tiptap"),h=[`[data-block-id="${i}"]`,`[data-preserved-inline="true"][data-block-id="${i}"]`,`span.preserved-inline[data-block-id="${i}"]`,`.shortcode[data-block-id="${i}"]`],p=d.querySelectorAll(h.join(", "));if(p.length===0&&d.querySelectorAll('[data-preserved-inline="true"]').forEach((k,b)=>{b<3}),p.forEach((f,k)=>{var C,x;const b=(x=(C=window.EditorPro)==null?void 0:C.pluginSystem)==null?void 0:x.renderShortcodeForEditor(e);f.innerHTML=b,f.title=c;try{const v={type:"shortcode",tagName:e.tagName||t.name,attributes:r,params:this.buildParamsString(r,t),content:a,original:c,isSelfClosing:e.isSelfClosing!==!1,shortcodeType:e.shortcodeType||t.type||"inline",isBlock:!1,isInline:!0};f.setAttribute("data-block-data",JSON.stringify(v)),f.setAttribute("data-block-type","shortcode"),f.setAttribute("data-block-id",i),f.setAttribute("data-preserved-inline","true")}catch(v){}if(t.cssTemplate){const v=this.shortcodeRegistry.generateCSS(t.name,r);v&&(f.style.cssText+=`; ${v}`)}}),d.querySelectorAll(`span[data-shortcode-inline="true"][data-placeholder-id="${i}"]`).forEach(f=>{const k=this.buildParamsString(r).trim(),b=this.preserver.normalizeShortcodeParams(k.replace(/^\s+/,"")),C=btoa(unescape(encodeURIComponent(b)));f.setAttribute("data-params",b),f.setAttribute("data-params-base64",C),f.setAttribute("data-attributes",JSON.stringify(r||{})),f.textContent=c;const x={type:"shortcode",tagName:e.tagName||t.name,attributes:r,params:b,content:a,original:c,isSelfClosing:e.isSelfClosing,shortcodeType:e.shortcodeType||t.type};f.setAttribute("data-block-data",JSON.stringify(x))}),this.editor){let f=!1,k=null;if(this.editor.state.doc.descendants((b,C)=>{if(b.type.name==="preservedInline"&&b.attrs.blockId===i)return f=!0,k=C,!1}),f&&k!==null){const b=this.editor.state.tr,C=((y=(w=window.EditorPro)==null?void 0:w.pluginSystem)==null?void 0:y.renderShortcodeForEditor(e))||c;b.setNodeMarkup(k,null,{blockId:i,blockType:"shortcode",blockContent:C,blockData:{type:"shortcode",tagName:t.name,attributes:r,params:this.buildParamsString(r,t),content:a,original:c,isSelfClosing:e.isSelfClosing!==!1,shortcodeType:"inline",isBlock:!1,isInline:!0}}),this.editor.view.dispatch(b)}}this.updateTextarea()}deleteInlineShortcode(t){this.preservedBlocks.delete(t),this.removeShortcodeCSS(t);const e=document.querySelector(`[data-block-id="${t}"]`);e&&e.remove(),this.updateTextarea()}editBlock(t){var l,o,s;const e=this.preservedBlocks.get(t);if(!e)return;if(e.type==="shortcode"&&e.shortcodeConfig){this.showShortcodeEditForm(e.shortcodeConfig,e,t);return}if(e.type==="shortcode"){const r=(s=(o=(l=window.EditorPro)==null?void 0:l.pluginSystem)==null?void 0:o.shortcodeRegistry)==null?void 0:s.get(e.tagName);if(r){e.shortcodeConfig=r,this.showShortcodeEditForm(r,e,t);return}this.showGenericShortcodeEditor(e.tagName,e.params,e.attributes,(a,c)=>{e.params=a,e.attributes=c,e.isSelfClosing?e.original=`[${e.tagName}${a?" "+a:""} /]`:e.original=`[${e.tagName}${a?" "+a:""}]${e.content||""}[/${e.tagName}]`,this.forceEditorUpdate()});return}const i=e.type==="html"?"HTML":e.type==="twig"?"Twig":"Block",n=`
                <div class="form-group">
                    <label for="block-content">${i} Content</label>
                    <textarea id="block-content" rows="10" style="font-family: monospace; width: 100%; box-sizing: border-box;">${e.original||""}</textarea>
                </div>
            `;this.createModal(`Edit ${i}`,n,r=>{const a=r.querySelector("#block-content").value;if(a!==e.original){e.content=a,e.original=a;const c=document.querySelector(`[data-block-id="${t}"]`);if(c){const d=c.querySelector(".preserved-block-content");d&&(e.type==="shortcode"&&e.isClosing?d.innerHTML=a:d.textContent=a)}e.type==="shortcode"&&e.shortcodeConfig&&e.shortcodeConfig.cssTemplate&&this.applyShortcodeCSS(t,e.shortcodeConfig,e.attributes),this.updateTextarea()}})}editRawBlock(t){const{state:e}=this.editor;let i=null,n=null;if(e.doc.descendants((r,a)=>{if(r.type.name==="rawBlock"&&r.attrs.blockId===t)return i=a,n=r,!1}),!n)return;const{language:l,content:o}=n.attrs,s=`
                <div class="form-group">
                    <label for="raw-content">Raw ${l.toUpperCase()} Code</label>
                    <textarea id="raw-content" rows="15" style="font-family: monospace; width: 100%; box-sizing: border-box;">${o||""}</textarea>
                </div>
            `;this.createModal(`Edit Raw ${l.toUpperCase()} Code`,s,r=>{const a=r.querySelector("#raw-content").value;if(a!==o){const c=this.editor.state.tr;c.setNodeMarkup(i,null,{...n.attrs,content:a}),this.editor.view.dispatch(c);const d=this.preservedBlocks.get(t);d&&(d.content=a,d.original=a),this.updateTextarea()}})}editShortcodeBlock(t,e,i){var c,d,h;const{shortcodeName:n,params:l,attributes:o}=e.attrs,s=(h=(d=(c=window.EditorPro)==null?void 0:c.pluginSystem)==null?void 0:d.shortcodeRegistry)==null?void 0:h.get(n);if(!s){this.showGenericShortcodeEditor(n,l,o,(p,u)=>{const g=i.state.tr;g.setNodeMarkup(t,null,{shortcodeName:n,params:p,attributes:u}),i.view.dispatch(g),this.updateTextarea()});return}let r={...o||{}};if(l&&s.bbcodeAttribute){const p=l.match(/^\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s"']+))\s*$/);if(p){const u=p[1]||p[2]||p[3];r[s.bbcodeAttribute]||(r[s.bbcodeAttribute]=u)}}const a={type:"shortcode",tagName:n,params:l,attributes:r,shortcodeConfig:s};this.showShortcodeEditForm(s,a,null,p=>{const u=i.state.tr,g=i.state.doc.nodeAt(t);u.setNodeMarkup(t,null,{...g.attrs,shortcodeName:p.tagName,params:p.params,attributes:p.attributes}),i.view.dispatch(u),this.updateTextarea()})}showGenericShortcodeEditor(t,e,i,n){const l=`
                <div class="form-group">
                    <label for="shortcode-name">Shortcode Name</label>
                    <input type="text" id="shortcode-name" class="form-control" value="${P(t)}" disabled />
                    <small class="form-text text-muted">This shortcode is not registered in the system.</small>
                </div>
                <div class="form-group">
                    <label for="shortcode-params">Parameters</label>
                    <input type="text" id="shortcode-params" class="form-control" value="${P(e||"")}" 
                           placeholder='e.g., label="Click me" color="blue" size="large"' />
                    <small class="form-text text-muted">Enter parameters as key="value" pairs separated by spaces.</small>
                </div>
                <div class="form-group">
                    <label>Parsed Attributes (read-only)</label>
                    <div class="well" style="background: #f5f5f5; padding: 10px; border-radius: 4px;">
                        ${Object.keys(i||{}).length>0?Object.entries(i).map(([o,s])=>`<div><strong>${P(o)}:</strong> ${P(s)}</div>`).join(""):"<em>No attributes parsed</em>"}
                    </div>
                </div>
            `;this.createModal(`Edit Shortcode: [${t}]`,l,o=>{const r=o.querySelector("#shortcode-params").value.trim(),a={};if(r){const c=/([\w-]+)\s*=\s*(?:"([^"]*)"|'([^']*)'|([^\s]+))/g;let d;for(;(d=c.exec(r))!==null;){const h=d[2]!==void 0?d[2]:d[3]!==void 0?d[3]:d[4];a[d[1]]=h}}n(r,a)},()=>{})}addChildShortcodeBlock(t,e,i,n){var a,c;if(!n||n.length===0){alert("No child shortcodes available for this parent.");return}const l=(c=(a=window.EditorPro)==null?void 0:a.pluginSystem)==null?void 0:c.shortcodeRegistry;if(!l){alert("Shortcode registry not available.");return}if(n.length===1){const d=n[0],h=l.get(d);if(!h){alert(`Child shortcode configuration for "${d}" not found.`);return}this.insertChildShortcode(t,e,i,h);return}const o=n.map(d=>l.get(d)).filter(Boolean);let s="";o.forEach(d=>{s+=`
                    <div class="shortcode-option" data-shortcode="${d.name}">
                        <div class="shortcode-option-content">
                            <h4>${d.title}</h4>
                            <p>${d.description||"No description available."}</p>
                        </div>
                    </div>
                `});const r=`
                <div class="form-group">
                    <label>Select child shortcode to add:</label>
                    <div class="shortcode-options">
                        ${s}
                    </div>
                </div>
            `;this.createModal("Add Child Shortcode",r,d=>{const h=d.querySelector(".shortcode-option.selected");if(!h)return alert("Please select a shortcode to add."),!1;const p=h.getAttribute("data-shortcode"),u=l.get(p);u&&this.insertChildShortcode(t,e,i,u)},()=>{}),setTimeout(()=>{const d=document.querySelectorAll(".shortcode-option");d.forEach(h=>{h.addEventListener("click",()=>{d.forEach(p=>p.classList.remove("selected")),h.classList.add("selected")})})},100)}insertChildShortcode(t,e,i,n){const l=typeof t=="function"?t():t;if(l===void 0){alert("Unable to determine parent position. Please try again.");return}const o=i.state.doc.nodeAt(l);if(!o||o.type.name!=="shortcodeBlock"){alert("Parent shortcode not found. It may have been moved or deleted.");return}const s={};n.attributes&&Object.entries(n.attributes).forEach(([c,d])=>{d.default&&(s[c]=d.default)});const r=`shortcode_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;this.preservedBlocks.set(r,{type:"shortcode",tagName:n.name,shortcodeName:n.name,shortcodeType:"block",params:"",attributes:s,content:"",original:`[${n.name}][/${n.name}]`,isClosing:!0,isBlock:!0});let a=l+1;if(o.content.size===0)a=l+1;else{let c=l+1;o.content.forEach((d,h)=>{d.type.name==="shortcodeBlock"&&(c=l+1+h+d.nodeSize)}),a=c}if(i.commands.insertChildShortcodeBlock)i.commands.insertChildShortcodeBlock(l,n.name,s);else{const c=i.state.schema.nodes.shortcodeBlock.create({shortcodeName:n.name,params:"",attributes:s,placeholderId:r},i.state.schema.nodes.paragraph.create());i.chain().focus().insertContentAt(a,c).run()}setTimeout(()=>{i.chain().focus().setTextSelection(a+1).run()},100),this.updateTextarea()}deleteBlock(t){const e=this.preservedBlocks.get(t);if(!e)return;const i=e.type==="shortcode"?"Shortcode":e.type==="html"?"HTML":e.type==="twig"?"Twig":"Block",n=`
                <div class="form-group">
                    <p>Are you sure you want to delete this ${i.toLowerCase()}?</p>
                    <p><strong>This action cannot be undone.</strong></p>
                </div>
            `;this.createModal(`Delete ${i}`,n,l=>{this.preservedBlocks.delete(t),this.removeShortcodeCSS(t);const o=document.querySelector(`[data-block-id="${t}"]`);o&&o.remove(),this.updateTextarea()},()=>{})}editGravImage(t){const e=this.preservedBlocks.get(t);if(!e||e.type!=="grav-image")return;const i=prompt("Edit Grav image actions (JSON format):",JSON.stringify(e.actions,null,2));if(i!==null)try{const n=JSON.parse(i);e.actions=n;const l=new URLSearchParams;Object.entries(n).forEach(([o,s])=>{l.set(o,s)}),e.queryString="?"+l.toString(),e.original=`![${e.alt}](${e.imagePath}${e.queryString})`}catch(n){alert("Invalid JSON format")}}resolveImagePath(t){var i,n;const e=(n=(i=this.pathMappings)==null?void 0:i.images)==null?void 0:n[t];return e?{resolved:e.resolved,original:e.original,dataSrc:e.data_src||e.original}:{resolved:t,original:t,dataSrc:t}}async resolveGravImagePath(t){try{const e=await this.resolveImageUrl(t);if(e&&typeof e=="string"){const l=new DOMParser().parseFromString(e,"text/html").querySelector("img");if(l)return l.getAttribute("src")}return t}catch(e){return t}}async resolveImageUrl(t){var e,i,n,l;if((!this.adminRoute||!this.adminNonce)&&this.loadAdminContext(),!this.adminRoute||!this.adminNonce)return t;try{const o=`<img src="${t}" alt="" />`,s=new FormData,r=this.pageRoute.startsWith("/")?this.pageRoute:`/${this.pageRoute}`;s.append("route",btoa(r)),s.append("data",JSON.stringify({img:[o],a:[]}));const a=((i=(e=window.GravAdmin)==null?void 0:e.config)==null?void 0:i.current_url)||`${this.adminRoute}/pages`,c=await fetch(`${a}/action:convertUrls/admin-nonce:${this.adminNonce}`,{method:"POST",body:s});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const d=await c.json();if(d.status==="success"&&((l=(n=d.data)==null?void 0:n.images)!=null&&l[o]))return d.data.images[o];throw new Error("Failed to resolve image path")}catch(o){throw o}}resolveLinkPath(t){var i,n;const e=(n=(i=this.pathMappings)==null?void 0:i.links)==null?void 0:n[t];return e?{resolved:e.resolved,original:e.original,dataHref:e.data_href||e.original}:{resolved:t,original:t,dataHref:t}}async resolveLinkUrl(t){var e,i,n,l;if(!this.adminRoute||!this.adminNonce)return t;try{const o=`<a href="${t}">Link</a>`,s=new FormData,r=this.pageRoute.startsWith("/")?this.pageRoute:`/${this.pageRoute}`;s.append("route",btoa(r)),s.append("data",JSON.stringify({img:[],a:[o]}));const a=((i=(e=window.GravAdmin)==null?void 0:e.config)==null?void 0:i.current_url)||`${this.adminRoute}/pages`,c=await fetch(`${a}/action:convertUrls/admin-nonce:${this.adminNonce}`,{method:"POST",body:s});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const d=await c.json();if(d.status==="success"&&((l=(n=d.data)==null?void 0:n.links)!=null&&l[o]))return d.data.links[o];throw new Error("Failed to resolve link path")}catch(o){throw o}}loadAdminContext(){var e,i;const t=this.textarea.closest(".editor-pro-wrapper");t&&(this.adminRoute=t.getAttribute("data-admin-route"),this.adminNonce=t.getAttribute("data-admin-nonce"),this.pageRoute=t.getAttribute("data-page-route"),(!this.adminRoute||!this.adminNonce)&&((e=window.GravAdmin)!=null&&e.config)&&(this.adminRoute=this.adminRoute||((i=window.GravAdmin.config.current_url)==null?void 0:i.replace(/\/pages.*$/,"")),this.adminNonce=this.adminNonce||window.GravAdmin.config.admin_nonce,this.pageRoute=this.pageRoute||window.GravAdmin.config.route))}async resolvePathViaAjax(t,e="both"){if(!this.adminRoute||!this.adminNonce)return{images:{},links:{}};try{const i={};(e==="both"||e==="images")&&(i.img=Array.isArray(t.images)?t.images:[]),(e==="both"||e==="links")&&(i.a=Array.isArray(t.links)?t.links:[]);const n=new FormData;n.append("route",btoa(`/${this.pageRoute}`)),n.append("data",JSON.stringify(i));const l=await fetch(`${window.location.origin}${this.adminRoute}/action:convertUrls/admin-nonce:${this.adminNonce}`,{method:"POST",body:n});if(l.ok)return(await l.json()).data||{images:{},links:{}}}catch(i){}return{images:{},links:{}}}cleanupTrailingBreakParagraphs(t){if(!t||typeof t!="string")return t;const i=["data-shortcode-block","data-raw-block","data-preserved-block","data-summary-delimiter",'class="shortcode-block"','class="raw-block"'].map(n=>n.startsWith("class=")?`[^>]*${n.replace('class="','class="[^"]*').replace('"','[^"]*"')}`:`[^>]*${n}`).join("|");return t=t.replace(new RegExp(`<p>(?:\\s*<br[^>]*class="ProseMirror-trailingBreak"[^>]*>\\s*)*<\\/p>\\s*(?=<div(?:${i}))`,"g"),""),t=t.replace(new RegExp('(?<=<\\/div>)\\s*<p>(?:\\s*<br[^>]*class="ProseMirror-trailingBreak"[^>]*>\\s*)*<\\/p>',"g"),""),t=t.replace(/<p>(?:\s*<br[^>]*class="ProseMirror-trailingBreak"[^>]*>\s*)*<\/p>(?:\s*<p>(?:\s*<br[^>]*class="ProseMirror-trailingBreak"[^>]*>\s*)*<\/p>)+/g,""),t=t.replace(/<p>\s*<br[^>]*class="ProseMirror-trailingBreak"[^>]*>\s*<\/p>/g,""),t}removeUnnecessaryParagraphs(t){if(!t||typeof t!="string"||(t=t.trim(),!t))return t;const e=t.match(/^<p>(.*?)<\/p>$/s);if(e){const n=e[1].trim(),l=/<(?:div|section|article|aside|header|footer|nav|main|figure|blockquote|pre|ul|ol|li|dl|dt|dd|table|thead|tbody|tfoot|tr|td|th|h[1-6])\b/i.test(n),o=t.includes("</p>")&&t.lastIndexOf("</p>")!==t.indexOf("</p>");if(!l&&!o&&n)return n}if(t.match(/^(<p>.*?<\/p>)+$/s)){const n=t.replace(/<\/?p>/g,"");if(!/<(?:div|section|article|aside|header|footer|nav|main|figure|blockquote|pre|ul|ol|li|dl|dt|dd|table|thead|tbody|tfoot|tr|td|th|h[1-6])\b/i.test(n)&&n.trim())return t.replace(/<\/p>\s*<p>/g,`
`).replace(/<\/?p>/g,"")}return t}fixEmptyTableCells(t){if(!t||typeof t!="string")return t;const i=new DOMParser().parseFromString(t,"text/html");return i.querySelectorAll("td, th").forEach(l=>{if(!l.innerHTML.trim()){const s=i.createElement("p");l.appendChild(s)}}),i.body.innerHTML}fixEmptyTableCellsInEditor(){if(!this.editor)return;const{state:t,dispatch:e}=this.editor.view,{doc:i,schema:n}=t,l=t.tr;i.descendants((o,s)=>{if((o.type.name==="tableCell"||o.type.name==="tableHeader")&&o.content.size===0){const r=n.nodes.paragraph.create();l.insert(s+1,r)}}),l.docChanged&&e(l)}createCodeMirrorCompatibility(){typeof window.Editor=="undefined"&&(window.Editor={editors:jQuery?jQuery():[]});const t={doc:{replaceSelection:e=>{const i=/!\[([^\]]*)\]\(([^)]+?)(?:\s+"([^"]*)")?\)/;if(i.test(e)){const o=e.match(i);if(o){const[s,r,a,c]=o;this.resolveImageUrl(a).then(d=>{const u=new DOMParser().parseFromString(d,"text/html").querySelector("img"),g=u?u.getAttribute("src"):a;this.pathMappings.images||(this.pathMappings.images={}),this.pathMappings.images[a]={resolved:g,original:a,data_src:a,html:d},this.editor.commands.setImage({src:g,alt:r||"","data-src":a,title:c||""}),this.updateTextarea()}).catch(d=>{this.editor.commands.setImage({src:a,alt:r||"","data-src":a,title:c||""}),this.updateTextarea()});return}}const{from:n,to:l}=this.editor.state.selection;this.editor.chain().focus().deleteRange({from:n,to:l}).insertContent(e).run(),this.updateTextarea(),setTimeout(()=>{const o=new Event("input",{bubbles:!0});this.textarea.dispatchEvent(o)},0)},getValue:()=>this.textarea.value,setValue:e=>{this.textarea.value=e;const i=new Event("input",{bubbles:!0});this.textarea.dispatchEvent(i)}},getValue:()=>this.textarea.value,setValue:e=>{this.textarea.value=e;const i=new Event("input",{bubbles:!0});this.textarea.dispatchEvent(i)},getCursor:()=>{const{from:e}=this.editor.state.selection;return e},setCursor:e=>{this.editor.commands.setTextSelection(e)},focus:()=>{this.editor.commands.focus()}};if(typeof jQuery!="undefined"&&jQuery(this.textarea).length){const e=jQuery(this.textarea);if(e.data("codemirror",t),e.attr("name")==="data[content]"&&window.Editor&&window.Editor.editors){let i=!1;window.Editor.editors.each(function(){this===e[0]&&(i=!0)}),i||(window.Editor.editors=window.Editor.editors.add(e))}jQuery(document).off("click.media-insert").on("click.media-insert","[data-dz-insert]",i=>{i.preventDefault(),i.stopImmediatePropagation();const l=jQuery(i.currentTarget).closest(".dz-preview").find(".dz-filename").text();if(l){const o=encodeURI(l),s=o.split(".").slice(0,-1).join("."),a=o.match(/\.(jpe?g|png|gif|svg|webp|avif|mp4|webm|ogv|mov)$/i)?`![${s}](${o} "${s}")`:`[${decodeURI(o)}](${o})`;t.doc.replaceSelection&&t.doc.replaceSelection(a)}return!1})}}}window.EditorPro=window.EditorPro||{},window.EditorPro.pluginSystem=new fe,window.EditorPro.registerPlugin=function(E){window.EditorPro.pluginSystem.register(E)},window.EditorPro.registerShortcode=function(E){return window.EditorPro.pluginSystem.registerShortcode(E)},window.EditorPro.getShortcodeRegistry=function(){return window.EditorPro.pluginSystem.getShortcodeRegistry()};function we(){document.querySelectorAll('textarea[data-grav-field="editor-pro"]').forEach((t,e)=>{if(!t.dataset.editorProInitialized)try{new be(t),t.dataset.editorProInitialized="true"}catch(i){}})}function ie(){var E;try{Q=he(),W=pe(),ee=ue(),te=me(),Z=de(),K=(E=window.TiptapRawBlock)==null?void 0:E.RawBlock,J=ce()}catch(t){W=null,Z=null,K=null,J=null}we()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{X(ie)}):X(ie);function ve(){}})();
//# sourceMappingURL=editor-pro.min.js.map
